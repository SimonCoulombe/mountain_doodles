<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="author" content="Nathan Lauster">
<meta name="dcterms.date" content="2023-06-27">
<meta name="description" content="Taking a systematic look at how to set housing targets aimed at counteracting restrictive municipal housing policies, and what that means for Vancouver.">

<title>Mountain Doodles - Housing targets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../../css/styles.css">
<meta property="og:title" content="Mountain Doodles - Housing targets">
<meta property="og:description" content="Taking a systematic look at how to set housing targets aimed at counteracting restrictive municipal housing policies, and what that means for Vancouver.">
<meta property="og:image" content="https://doodles.mountainmath.ca/posts/2023-06-27-housing-targets/index_files/figure-html/housing-targets-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="1200">
<meta property="og:image:width" content="2400">
<meta name="twitter:title" content="Mountain Doodles - Housing targets">
<meta name="twitter:description" content="Taking a systematic look at how to set housing targets aimed at counteracting restrictive municipal housing policies, and what that means for Vancouver.">
<meta name="twitter:image" content="https://doodles.mountainmath.ca/posts/2023-06-27-housing-targets/index_files/figure-html/housing-targets-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="1200">
<meta name="twitter:image-width" content="2400">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountain_doodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Housing targets</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Housing targets</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountain_doodles/blob/main/posts/2023-06-27-housing-targets/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          Taking a systematic look at how to set housing targets aimed at counteracting restrictive municipal housing policies, and what that means for Vancouver.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">affordability</div>
                <div class="quarto-category">Vancouver</div>
                <div class="quarto-category">zoning</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jens von Bergmann </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              MountainMath
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Nathan Lauster </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              UBC, Department of Sociology
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 27, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p style="text-align:center;">
<i>(Joint with Nathan Lauster and cross-posted at <a href="https://homefreesociology.com/2023/06/27/housing-targets/" target="_blank">HomeFreeSociology</a>)</i>
</p>
<p>Municipalities in BC are required to submit <a href="https://www2.gov.bc.ca/gov/content/housing-tenancy/local-governments-and-housing/policy-and-planning-tools-for-housing/housing-needs-reports">Housing Needs reports</a>, and integrate these into Official Community Plans and Regional Growth Strategies in something resembling housing targets. The <a href="https://www.bclaws.gov.bc.ca/civix/document/id/bills/billsprevious/3rd42nd:gov43-1">BC Housing Supply Act</a> now sharpens this process and adds some <a href="https://homefreesociology.com/2022/11/24/new-premier-new-housing-policy/">teeth</a>, effectively enabling the province to define housing targets, accompanied by new provincial enforcement mechanisms, where the province <a href="https://news.gov.bc.ca/releases/2023HOUS0059-000851">selects municipalities</a> not meeting housing need. Left unstated are the details of precisely how we should go about calculating housing needs or housing targets.</p>
<p>It’s most useful to think of this question in two parts:</p>
<ol type="1">
<li>how much overall housing is needed, and</li>
<li>how much non-market housing (or cash supplements) is needed to ensure everyone has access to housing.</li>
</ol>
<p>Setting housing targets for municipalities in BC is chiefly about the first. Non-market housing and housing supplements are generally the responsibility of higher levels of government. But overall targets and non-market housing are connected as part of a broader housing system, and ideally work together. Building more housing of all sorts <a href="https://www.sciencedirect.com/science/article/pii/S0094119023000414">reduces pressures and need for specifically non-market housing</a>, and building non-market housing counts toward overall housing needed as well as having a <a href="https://www.sciencedirect.com/science/article/pii/S0094119022001048?via%3Dihub">stronger impact on affordability at the lower end of the market than building market housing alone</a>.</p>
<p>In this post we focus on setting overall housing targets for municipalities, but we’ll revisit non-market need.</p>
<section id="why-do-we-need-overall-housing-targets" class="level1">
<h1>Why do we need overall housing targets?</h1>
<p>Municipalities have generally adopted very restrictive policies when it comes to new housing that to a large degree <a href="https://doodles.mountainmath.ca/blog/2023/02/06/a-brief-history-of-vancouver-planning-development-regimes/">remove key market mechanisms from the process of housing provision</a>. Supply is not enabled to rise in response to rising demand, but rather must first go through a complicated, uncertain, expensive, and lengthy municipal approvals process. What’s more, evidence suggests the process tends to grow increasingly complicated, uncertain, expensive, and lengthy over time. Strong targets work against this tendency, providing a mechanism that tells municipalities how much housing they “need” to approve and see built within specific time windows. Ideally strong targets push municipalities toward simpler, more certain, cheaper, and faster approval processes.</p>
<p>We take it for granted that overall housing targets should be put in place to solve the problems created by municipalities restricting housing. This sets up a relatively simple conceptual approach for how to establish targets. Where would we be if municipalities weren’t restricting housing?</p>
<p>We can break this counterfactual question down into three interrelated parts: How much extra housing could have been built in the past had we not held it back? How many more people would have arrived or stayed if we had built that extra housing? How much cheaper would housing be if we had built that extra housing?</p>
<p>Unfortunately, we can’t easily answer these questions about a past that never was. But we can lay out a procedure for building up answers to related questions in the present, and look at possibilities for extending them into the future. And that’s how we should be constructing housing targets.</p>
</section>
<section id="how-should-we-construct-targets" class="level1">
<h1>How should we construct targets?</h1>
<p>How much extra housing could be built now if municipalities weren’t holding it back? This is our most relevant measure of housing shortfall. To provide a rough answer, we can look at how the costs of constructing housing currently relate to the price new housing can fetch on the market. The difference between the two (price - costs) constitutes a “wedge” providing an indicator of how much extra housing could profitably be built. As more housing gets built, it should drive up supply and drive down price. As prices decline toward costs, the wedge approaches zero. At the point where the wedge equals zero, we can be pretty sure municipal approval processes aren’t holding back new housing, because developers wouldn’t find it profitable to build anyway (elsewhere in the literature, the point where the wedge equals zero is also known as the <a href="https://www.nber.org/system/files/working_papers/w14193/w14193.pdf">Minimum Profitable Production Cost</a>).</p>
<p>But how fast new supply drives down price depends upon how much demand it meets. We need estimates of demand elasticity. Measurements of demand elasticity provide a way to estimate at least partial answers to our second and third questions. How many more people would stay or come to Vancouver if we had a bunch of extra housing? And how much cheaper would housing be if we had a bunch of extra housing? These questions are interrelated: we can’t really answer one without the other.</p>
<p>Of note, all of our answers for questions about the present will also relate to our historical counterfactual questions, but the questions aren’t quite the same. After all, building standards have tightened and it’s now more expensive to build housing. We can consider the rise in building standards as accompanying, and perhaps even part of the rise complicated, uncertain, expensive, and lengthy municipal approval processes. But to the extent newer standards result in better quality, more accessible, and more sustainable housing, we don’t want to get rid of them. Also, building out more gradually over time would have allowed buildings to depreciate, resulting in a more balanced price distribution throughout the housing spectrum. This can’t be fixed retroactively, the best time to build housing was yesterday, but the second best time is now.</p>
<section id="estimating-current-housing-shortfall" class="level2">
<h2 class="anchored" data-anchor-id="estimating-current-housing-shortfall">Estimating current housing shortfall</h2>
<p>To estimate current housing shortfall we focus on the type of housing that we can expect to be most effective in adding housing: multifamily apartment buildings. These also happen to be the type of housing most restricted by municipalities. While we could (and should) add single family homes by subdividing existing single family lots or stratifying them into row/townhouses, the main contribution of growth in housing will have to come from apartments. And while we are generally more concerned about rental than ownership housing, our data on rental is simply not good enough to use for this kind of analysis. Here we focus on prices, with the understanding that people trade off owning vs renting and ownership, and rental affordability moves in tandem in the medium to long term.</p>
<p>We estimate housing shortfall in three steps that together address our questions above, providing a relatively simple conceptual approach.</p>
<ol type="1">
<li>Estimate the <em>wedge</em> between the price new housing fetches and what it costs to build, including land but assuming no or little restrictions on density or location.</li>
<li>Estimate the demand elasticity to price, that is the shape of the demand curve.</li>
<li>Estimate the housing shortfall, that is the amount of housing needed until the <em>wedge</em> is competed away.</li>
</ol>
<p>When the rubber hits the road it will get a little more complicated, but let’s take a look how this could be done for some Metro Vancouver municipalities.</p>
<section id="estimating-the-wedge" class="level3">
<h3 class="anchored" data-anchor-id="estimating-the-wedge">Estimating the wedge</h3>
<p>CMHC analysts have <a href="https://eppdscrmssa01.blob.core.windows.net/cmhcprodcontainer/sf/project/archive/research_5/rr_supply_constraints_increased_prices_mar_12.pdf">estimated the wedge</a> for overall CMAs and municipalities within them based on 2018 prices. In their analysis the cost includes developer profit, but no land component. Glaeser suggests that around 20% of the sale price should be land cost in an unregulated market, so we apply this ratio to the wedge estimates from the report to obtain the “excess price” of housing. The idea here is that the optimum density is such that when everything is said and done the purchase price of the land makes up 20% of the sale price of the new housing built on top.</p>
<p><img src="index_files/figure-html/excess-price-1.png" width="1200"></p>
<p>North Vancouver here combines the District and the City. Of note, this suggests that Surrey builds housing roughly in line with demand. But the more centrally located municipalities of Vancouver, North Vancouver, Richmond and Burnaby, are under-building with respect to demand. This speaks to not just the overall housing shortage, but also the spatial misallocation of housing in the region, <a href="https://doodles.mountainmath.ca/blog/2023/06/20/metro-vancouver-planning-regimes/">both of which are to a large extent promoted by Metro Vancouver regional planning</a>.</p>
</section>
<section id="demand-elasticity" class="level3">
<h3 class="anchored" data-anchor-id="demand-elasticity">Demand elasticity</h3>
<p>To translates our wedge estimates into current housing shortfall estimates we need to assess the demand elasticity of price. For BC overall CMHC has estimated a demand elasticity of -0.5, so all else being equal for every 1% of increase in housing supply prices fall by 2%, the inverse demand elasticity. Ideally one would try to get more detailed estimates for Vancouver, but the reality is that the shape of the demand curve is difficult to estimate and comes with large uncertainties, suggesting we should probably report ranges rather than point estimates. We add estimates using demand elasticities between -0.7 to -0.3 that roughly cover the range seen in the literature. Combining this with housing stock estimates this gives us estimates of the current (2018) housing shortfall, which should be interpreted as the number of dwelling units needed to compete away the excess cost.</p>
<p>There are some potential issues with these estimates, for example housing demand is not homogeneous, and given how far prices are from equilibrium of Minimum Profitable Production Cost our extrapolation may be off. Moreover, current construction tends to cater to the higher end of the market, we expect that to change as we slide down the demand curve, in which case we will see less fancy, and thus cheaper, construction, which increases the wedge and deepens the range of price effects we would see. We believe that using a broad range of demand elasticities should cover this and other uncertainties in this process. This gets us to the current housing shortfall, which to no surprise is concentrated in the central parts of the region, in particular the City of Vancouver.</p>
<p><img src="index_files/figure-html/housing-shortfall-1.png" width="1200"></p>
<p>We note that our simple estimate of a shortfall of 250k housing units for Metro Vancouver stacks up pretty well against other relevant estimates. For instance, the <a href="https://doodles.mountainmath.ca/blog/2022/10/03/still-short-suppressed-households-in-2021/">suppressed household estimate we calculated suggests a shortage of between 130k to 200k dwellings for Metro Vancouver</a> looking at household maintainer rates for existing residents alone, but not including those outside the region. To put it differently, we would anticipate many more people moving into their own households instead of doubling up with others if more housing were available, but we would also expect more people remaining in or arriving to Vancouver.</p>
<p>Regardless, these estimates are pegged to the present, and housing can’t be created instantly. To transform our estimates into housing targets we need to set a goal for some point in the future. But housing demand will likely grow in that time frame, necessitating more housing. This leads us to thinking not just about our current shortfall, but also about future shortfalls. How do we plan ahead?</p>
<p>One option is to benchmark against business as usual development, adding more on top. We see this with the <a href="https://assets.cmhc-schl.gc.ca/sites/cmhc/professional/housing-markets-data-and-research/housing-research/research-reports/2022/housing-shortages-canada-solving-affordability-crisis-en.pdf?rev=88308aef-f14a-4dbb-b692-6ebbddcd79a0">CMHC housing target for BC of an additional 570k units over the next 10 years</a> needed to bring affordability back in line with 2003-2004 levels. On first pass, our estimated shortfall of 250k households in Metro Vancouver fits pretty well with this target, insofar as Metro Vancouver contains over half the population of BC. But the fit isn’t perfect, and given that this is a different measure, speaking to a distinct affordability standard already considered unacceptable across the rest of Canada, and calculated out 10 years into the future, we shouldn’t expect it to be. How might we come up with our own housing target?</p>
</section>
</section>
<section id="estimating-future-housing-demand" class="level2">
<h2 class="anchored" data-anchor-id="estimating-future-housing-demand">Estimating future housing demand</h2>
<p>This is where we have to make some assumptions. How will the demand for housing grow in the future, say over the next 10 years? For the purposes if this post we take a very rough shortcut and piggy-back off of <a href="http://www.metrovancouver.org/services/regional-planning/PlanningPublications/Metro_Vancouver_Growth_Projections_Tables.pdf">Metro Vancouver projected household growth</a>. As we <a href="https://doodles.mountainmath.ca/blog/2023/06/20/metro-vancouver-planning-regimes/">discussed in our last post</a>, Metro Vancouver’s methods underlying projected household growth systematically underestimate demand, and we remedy this by assuming that they underestimate demand in line with the size of our current housing shortfall above. After all, the same growth management strategies baked into the Metro Vancouver projections is exactly what leads to our current housing shortfall.</p>
<p>So to get to projections of future housing demand we scale Metro household projections up by the ratio of the current shortfall to the existing dwelling stock. This may over-estimate demand a bit since traditionally Metro Vancouver fell short of meeting their household targets, but it may also underestimate demand insofar as Metro Vancouver projections are set to worsen the housing shortage. Also of note, Metro Vancouver projections are based on households, even though they mislabel them as “dwelling units”. To get to dwelling targets we add another 5% to allow for moving vacancies and other frictions.</p>
<p><img src="index_files/figure-html/housing-targets-1.png" width="1200"></p>
<p>Here we break out the current shortfall estimated above, the current Metro Vancouver projections, our scaling up of Metro Vancouver projections by estimated shortfall to current stock, plus a factor to convert Metro Vancouver’s (mislabelled) household projections into dwelling projections. And voilà! Housing Targets!</p>
<p>This is all pretty rough and we have given up estimating the extent of our uncertainties here. Adding to those we already discussed we now add uncertainties in Metro Vancouver projections, and uncertainties how to adjust them for their methodological flaws. Since 2018 prices have climbed significantly, but so have construction costs. Incomes have also increased, as have interest rates. It would be worthwhile to redo this analysis for today’s conditions, while also paying more attention to compositional effects that lead to some curious quirks in the CMHC report. But that goes beyond the scope of a blog post.</p>
<p>For now this gives a baseline for planning to work with. It’s probably not realistic to expect half a million new dwelling units across Metro Vancouver, built in the places where people want to live. It takes time for the construction labour force to adjust, and redevelopment is contingent on properties selling. But it gives us a 10-year target to work toward.</p>
</section>
<section id="non-market-housing" class="level2">
<h2 class="anchored" data-anchor-id="non-market-housing">Non-market housing</h2>
<p>To close this section we note that we are talking about overall numbers, and using market mechanisms to estimate housing targets. People living in non-market housing don’t enter in the <em>excess price</em> metric we calculate as our wedge (renters enter implicitly, though not directly). But non-market housing is counted as part of the overall housing supply, and thus enters into our housing targets. The <em>excess price</em> metric implies that prices for new housing would fall by roughly 50% in Metro Vancouver, more in some sub-regions and less in others, and while these price reductions and related rent reductions would be expected to propagate in some way through the entire housing spectrum, it is not clear how exactly this would transform the lower end of the market. Nor is it clear the lower end of the market could meet everyone’s needs. We expect there would likely still be people left in inadequate or unaffordable housing, where dedicated non-market housing or cash supplements should be directed. But we also expect that alleviating overall housing shortages <a href="https://www.nytimes.com/2022/06/14/headway/houston-homeless-people.html">makes this work a lot easier to do</a>.</p>
<p>Ideally after addressing how much overall housing is needed, we’d return to the second part of our question to ask how much non-market housing is needed to insure everyone has access to housing. We have some ideas for how to go about this, involving calculating the effects of meeting overall targets on rent distributions by housing type, and drawing upon household characteristics to figure out what proportion of households wouldn’t find needs met by these new distributions. But that involves a lot more work and assumptions, and we’ll leave it for another post.</p>
<p>For now we’ll note that the work and assumptions involved in jointly assessing overall housing targets and specifically non-market housing targets point toward a persistent shortcoming in many current housing needs assessments. A lot of housing needs estimates simply look at how the need of the current population is met by the available housing. Sometimes assessments are pegged to household income brackets and look at how many households in each bracket face housing struggles. This is useful for understanding how people are doing in the current housing environment, but only of limited use when coming up with housing targets, where projection into the future includes people not currently resident in the region and involves a lot of moving parts operating within a broader and interconnected housing system.</p>
</section>
</section>
<section id="upshot" class="level1">
<h1>Upshot</h1>
<p>Setting defensible housing targets is hard, but necessary under our <a href="https://homefreesociology.com/2023/02/07/a-brief-history-of-vancouver-planning-development-regimes/">current planning and development regime</a>. If we’re going to essentially <a href="https://doodles.mountainmath.ca/blog/2023/02/06/a-brief-history-of-vancouver-planning-development-regimes/">restrict all new multi-family housing by default, only allowing it after lengthy, expensive, and uncertain discretionary processes</a>, then we really need targets to ensure we’re still building enough housing. In short, housing is good and we need it. We approach the construction of overall targets as a means of preventing planning from restricting the housing we need.</p>
<p>Here in Metro Vancouver, defensible housing targets suggest we need a lot more housing. Looking forward, we’ll need a lot more housing just to keep things from getting worse. And we’ll need a lot more than that in order to make things better. We might not be able to hit our targets, but we should aim high. The more housing we build, both market and non-market, the better things will get.</p>
<p>Of course our targets hinge on our values as <a href="https://homefreesociology.com/2021/02/26/human-rights-yimbyism/">human rights YIMBYs</a> that housing is good, that people have a right to it, that allowing people to gather together in cities is good, and that new neighbours bring their own kind of amenity. Others may have different values, and consequently arrive at different targets. For instance, some people believe cities, acting as either private corporations or miniature states, have a right to exclude people to <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2281955">maximize utility</a> for their current shareholders/property owners/citizens. This kind of thinking <a href="https://doodles.mountainmath.ca/blog/2023/06/20/metro-vancouver-planning-regimes/">has become entrenched within current procedures</a> in our planning and development regimes even as technocratic language obscures the underlying values argument. We can look around at access to housing across the region and see where our current procedures lead.</p>
<p>In short: Housing is good, actually. Our targets should reinforce that point, making it simpler and easier to add housing, especially in places where people want to live. In the long term we want to get away from targets and return to a housing system with ample outright capacity. Housing targets are a bridge to get us there from our current planning regime. We will still need projections, but their role will transition to give rough ranges of what to expect to ensure we have enough outright capacity, and make smart decisions around infrastructure planning.</p>
<p>As usual, the code for this post is <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2023-06-27-housing-targets/index.Rmarkdown">available on GitHub</a> for anyone to reproduce or adapt for their own purposes.</p>
<section id="update-additional-scenario-on-effective-cost-assumptions-september-25-2023" class="level2">
<h2 class="anchored" data-anchor-id="update-additional-scenario-on-effective-cost-assumptions-september-25-2023">Update (additional scenario on effective cost assumptions, September 25, 2023)</h2>
<p>One caveat on our analysis above is that we added in a sizable land component to the marginal cost of housing. This may not be necessary, in a market where the amount of housing is not constrained by municipal regulation (maybe where municipalities even encourage more housing!) a developer could build up until the marginal (social) cost of production, including profit, equals the the price the housing sells for. The additional “land component” of 20% was added rather ad-hoc, with the implicit understanding that when we are far away from equilibrium developers would not just build one more floor but many, and the effective marginal cost of adding these floors is higher than the marginal cost of adding just one floor. This could also capture costs associated with externalities of increasing population density, which also increases the cost of providing services that may not be captured at the current level of DCC/DCLs (assuming for simplicity those are set properly to cover only the current incremental cost of new construction). Lastly this accounts for risk, where developers may opt to build below the economically optimal height to avoid running the risk of not being able to recover all their costs if it turns out that prices are lower than anticipated at the time of completion.</p>
<p>The 20% estimate is probably at the high end of the range of what could reasonably be expected here. To complement our previous estimates we re-run the analysis where we assume supply can be effectively added at 10% above current marginal cost of supply.</p>
<p>Under this scenario, we start out with a wedge that is ~10% larger.</p>
<p><img src="index_files/figure-html/excess-price2-1.png" width="1200"></p>
<p>This in turn gives significantly higher estimates of current shortfall.</p>
<p><img src="index_files/figure-html/housing-shortfall2-1.png" width="1200"></p>
<p>When spacing this out over 10 years this leads to again significantly higher 10 year targets, with higher baselines but also higher correction to the projection housing demand.</p>
<p><img src="index_files/figure-html/housing-targets2-1.png" width="1200"></p>
<p>Assuming supply can be effectively added at the current marginal cost would locate more than half of BC’s current dwelling shortfall in Metro Vancouver, and accordingly finds a higher dwelling shortfall especially in the more expensive cities within Metro Vancouver. This is probably a more realistic estimate of targets to return the market to a condition where the total amount of housing is not overly constrained by municipal restrictions limiting new housing construction.</p>
<details>
<summary>
Reproducibility receipt
</summary>
<pre><code>## [1] "2023-09-25 22:31:07 PDT"</code></pre>
<pre><code>## Local:    master /Users/jens/Documents/R/mountaindoodles
## Remote:   master @ origin (https://github.com/mountainMath/doodles.git)
## Head:     [164fe57] 2023-09-26: update (some of the) dead links in Metro Vancouver regimes post where Metro Vancouver website changed.</code></pre>
<pre><code>## R version 4.3.0 (2023-04-21)
## Platform: aarch64-apple-darwin20 (64-bit)
## Running under: macOS Ventura 13.6
## 
## Matrix products: default
## BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib 
## LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## time zone: America/Vancouver
## tzcode source: internal
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] mountainmathHelpers_0.1.4 cancensus_0.5.6          
##  [3] lubridate_1.9.2           forcats_1.0.0            
##  [5] stringr_1.5.0             dplyr_1.1.2              
##  [7] purrr_1.0.1               readr_2.1.4              
##  [9] tidyr_1.3.0               tibble_3.2.1             
## [11] ggplot2_3.4.2             tidyverse_2.0.0          
## 
## loaded via a namespace (and not attached):
##  [1] sass_0.4.5       utf8_1.2.3       generics_0.1.3   blogdown_1.18   
##  [5] stringi_1.7.12   hms_1.1.3        digest_0.6.31    magrittr_2.0.3  
##  [9] timechange_0.2.0 evaluate_0.20    grid_4.3.0       bookdown_0.34   
## [13] fastmap_1.1.1    jsonlite_1.8.4   fansi_1.0.4      scales_1.2.1    
## [17] jquerylib_0.1.4  cli_3.6.1        rlang_1.1.1      munsell_0.5.0   
## [21] withr_2.5.0      cachem_1.0.8     yaml_2.3.7       tools_4.3.0     
## [25] tzdb_0.3.0       colorspace_2.1-0 vctrs_0.6.2      R6_2.5.1        
## [29] git2r_0.32.0     lifecycle_1.0.3  pkgconfig_2.0.3  pillar_1.9.0    
## [33] bslib_0.4.2      gtable_0.3.3     glue_1.6.2       xfun_0.39       
## [37] tidyselect_1.2.0 rstudioapi_0.14  knitr_1.42       htmltools_0.5.5 
## [41] rmarkdown_2.23   compiler_4.3.0</code></pre>
</details>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2023,
  author = {von Bergmann, Jens and Lauster, Nathan},
  title = {Housing Targets},
  date = {2023-06-27},
  url = {https://doodles.mountainmath.ca/posts/2023-06-27-housing-targets},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von, and Nathan Lauster. 2023. <span>“Housing
Targets.”</span> <em>MountanDoodles</em> (blog). June 27, 2023. <a href="https://doodles.mountainmath.ca/posts/2023-06-27-housing-targets">https://doodles.mountainmath.ca/posts/2023-06-27-housing-targets</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodles\.mountainmath\.ca");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mountainmath/mountain_doodles" data-repo-id="R_kgDOLuoDtA" data-category="Blog posts" data-category-id="DIC_kwDOLuoDtM4Cetfc" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark_dimmed">
</div> <!-- /content -->




</body></html>