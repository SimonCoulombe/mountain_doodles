<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="author" content="Nathan Lauster">
<meta name="dcterms.date" content="2021-07-25">
<meta name="description" content="Zoning bylaws restrict the size and frontage of lots, preventing lots from getting subdivided. The opportunity cost of freezing City of Vancouver land use in RS zoned areas in amber is enormous, it amounts to around $40 billion from preventing 2:1 lots splits, and an additional $100 billion from preventing further subdivision beyond that.">

<title>Mountain Doodles - Lots of Opportunity: Estimating the Zoning Tax in Vancouver</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/plain" cookie-consent="tracking">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Mountain Doodles - Lots of Opportunity: Estimating the Zoning Tax in Vancouver">
<meta property="og:description" content="Zoning bylaws restrict the size and frontage of lots, preventing lots from getting subdivided. The opportunity cost of freezing City of Vancouver land use in RS zoned areas in amber is enormous, it amounts to around $40 billion from preventing 2:1 lots splits, and an additional $100 billion from preventing further subdivision beyond that.">
<meta property="og:image" content="https://doodletest.netlify.app/posts/2021-07-25-lots-of-opportunity-estimating-the-zoning-tax-in-vancouver/index_files/figure-html/zoning-tax-2-1-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="1152">
<meta property="og:image:width" content="1536">
<meta name="twitter:title" content="Mountain Doodles - Lots of Opportunity: Estimating the Zoning Tax in Vancouver">
<meta name="twitter:description" content="Zoning bylaws restrict the size and frontage of lots, preventing lots from getting subdivided. The opportunity cost of freezing City of Vancouver land use in RS zoned areas in amber is enormous, it amounts to around $40 billion from preventing 2:1 lots splits, and an additional $100 billion from preventing further subdivision beyond that.">
<meta name="twitter:image" content="https://doodletest.netlify.app/posts/2021-07-25-lots-of-opportunity-estimating-the-zoning-tax-in-vancouver/index_files/figure-html/zoning-tax-2-1-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="1152">
<meta name="twitter:image-width" content="1536">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountain_doodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Lots of Opportunity: Estimating the Zoning Tax in Vancouver</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Lots of Opportunity: Estimating the Zoning Tax in Vancouver</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountain_doodles/blob/main/posts/2021-07-25-lots-of-opportunity-estimating-the-zoning-tax-in-vancouver/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          Zoning bylaws restrict the size and frontage of lots, preventing lots from getting subdivided. The opportunity cost of freezing City of Vancouver land use in RS zoned areas in amber is enormous, it amounts to around $40 billion from preventing 2:1 lots splits, and an additional $100 billion from preventing further subdivision beyond that.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">affordability</div>
                <div class="quarto-category">Assessment Data</div>
                <div class="quarto-category">density</div>
                <div class="quarto-category">land use</div>
                <div class="quarto-category">Vancouver</div>
                <div class="quarto-category">zoning</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jens von Bergmann </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              MountainMath
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Nathan Lauster </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              UBC, Department of Sociology
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 25, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p style="text-align:center;">
<i>(Joint with Nathan Lauster and cross-posted at <a href="https://homefreesociology.com/2021/07/25/lots-of-opportunity-estimating-the-zoning-tax-in-vancouver/" target="_blank">HomeFreeSociology</a>)</i>
</p>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TLDR</h2>
<p>We estimate the land value lost by lot subdivision restrictions in the RS (single-family) zoned lands of Vancouver. These restrictions, also known as the <em>zoning tax</em>, subsidize hoarding of land for the wealthy at the cost of those who wouldn’t mind sharing. We conservatively estimate the overall cost of preventing splitting of lots at $43 billion, or an average of 37% of existing lot land value. Alternative formulations enabling deeper subdivisions raise our zoning tax estimates to $146 billion. We provide examples of what subdivision could look like, tally up non-conforming lots by zone, and discuss some of the implications.</p>
<p>The zoning tax is real, and it is enormous. The exact amount of the zoning tax is hard to pin down because we are so far away from the equilibrium of where people would stop subdividing land or air parcels if they were allowed to do so.</p>
</section>
<section id="lots-of-potential" class="level2">
<h2 class="anchored" data-anchor-id="lots-of-potential">Lots of Potential</h2>
<p>How much land do you have to buy in order to buy a house?</p>
<p>Theoretically this could vary a great deal, running from tiny lots (hosting tiny houses) up to large estates. Historically the latter (often farms) were surveyed; subdivided, and sold off into the smaller lots around most urban areas, setting in place the landscape we see today. Prior to zoning, increments of the 66 foot-long chains of surveyors tended to set lot sizes (one chain by ten chains makes an acre), but these could be further subdivided and sold off by land owners (half a chain by two chains remains a pretty normal lot size in Vancouver). Zoning regulations, and specifically subdivision regulations, imposed firm limits on how small lots were allowed to go, generally setting minimum parcel sizes and frontages. This prevented land from being further subdivided, or split up into smaller lots. It also kept out poorer folks from more exclusive neighbourhoods (in many cases as <a href="https://searcharchives.vancouver.ca/westmount-park-subdivision-superb-side-2">advertised</a>).</p>
<p>In effect zoning forces some people to buy more land than they might otherwise want, making their housing more expensive, but also making the neighbourhood more exclusive. At the same time, and because you can’t really do much with it, zoning depresses the price of land ($ per square foot) on large indivisible lots relative to smaller lots. In other words, we make it difficult for two less rich households to compete with one very rich household for the same plot of land. Accordingly we subsidize the lifestyles and exclusiveness of landed wealth and we pay for it by reducing opportunities for everyone less wealthy.</p>
<p>Just how much is this subsidy costing us?</p>
<p>Most estimates of the size of the subsidy come from the field of Economics, where it’s understood slightly differently: as a tax. Following <a href="https://www.nber.org/system/files/working_papers/w8835/w8835.pdf">Glaeser &amp; Gyourko (2002)</a>, it’s often referred to as a <em>zoning tax</em>. Economists (correctly) tend to see this tax as lowering general welfare in cities. But it’s also a tax placed upon potential transactions between prospective buyers who don’t need all the land on offer and current land owners, who would be able to sell their land for more if it were subdividable. A <a href="https://www.nber.org/papers/w28993">new NBER working paper by Joseph Gyourko and Jacob Krimmel</a> tries to quantify the <em>zoning tax</em>, that is the loss in affordability due to restrictive zoning, in single-family zoned areas across multiple US metros. Below we attempt to quantify the same figure, which we can also understand as a subsidy for the lifestyles of the very rich, for Vancouver.</p>
<p>Why is this called a <em>zoning tax</em>? The basic idea is that as land gets more expensive people tend to use land more intensively. This can happen in several ways, via subdivision of land, subdivision of air parcels (stratification), and sharing of existing land. Zoning restricts all of these. Restrictions on minimum lot size, minimum lot frontage, as well as minimum setbacks renders subdivision of land at some point unfeasible. Restrictions on height, FSR, number of units and stratas restricts subdivision of air parcels or stratification. Definitions of family and restrictions of number of unrelated people per household in zoning bylaws restricts sharing of land and the homes on them.</p>
<p>It’s possible, of course, that these restrictions don’t matter much. If they only operate to replicate what people want and can afford to buy anyway (maybe everyone’s a wealthy gardener!), then they may produce little in the way of a tax or subsidy. Put differently, if these restrictions just curb some rare outliers there is not much aggregate economic and social loss associated with such regulation. But when the regulations become hard constraints limiting the trade-offs most people might be happy to make they can incur enormous economic (and social) losses. The <em>zoning tax</em> (a.k.a. <em>landed wealth subsidy</em>) offers one estimate of the selective losses and gains on offer.</p>
</section>
<section id="binding-constraints" class="level2">
<h2 class="anchored" data-anchor-id="binding-constraints">Binding constraints</h2>
<p>How can we tell if the zoning restrictions in Vancouver are hard constraints limiting what people would do otherwise? There are a number of ways. The size of new houses in Vancouver RS (“single family”) zoning gives one view into this. Here is a graph of the GFA (gross floor area, the total floor space used for living) and the FSR (the ratio of GFA to lot size) for City of Vancouver single family homes by year built.</p>
<p><img src="index_files/figure-html/fsr-gfa-1.png" width="768"></p>
<p>This list is somewhat biased in that it does not show the distributions of GFA and FSR for all homes built in a give year, but only for those that are still standing. This biases the floor area of older homes upwards, as smaller homes are more likely to have been torn down and replaced. GFA measures the size of the house, FSR is what is restricted by zoning regulation. Initially the FSR ceiling was set at 0.6 FSR, but this was fairly recently extended to 0.75 as visible in the data. There were also numerous changes of what does or does not count toward FSR.</p>
<p>Initially the GFA followed a fairly narrow band, we built homes to fit families and needs were similar. This led to a broad span in FSR as lot size varied. We notice how starting in the 1960 the size of homes increased, and by the mid 1970s the range of FSR narrowed considerably, approaching the legal limit. What changed is that the land economics incentivized people to maximize floor space, the FSR range narrowed and the GFA range widened, depending on lot size. The FSR constraints, and with it land sharing constraints, became binding and the zoning became dysfunctional.</p>
</section>
<section id="zoning-tax" class="level2">
<h2 class="anchored" data-anchor-id="zoning-tax">Zoning tax</h2>
<p>In this post we want to explore the zoning tax as different evidence of a hard constraint, in this case the constraint on sharing land by sub-dividing. Gyourko and Krimmel look at the extensive and intensive margin values of land, which is to say they compare the average land value per square foot of large and small lots near one another. They argue that these two should be the same in an unregulated market. In other words, if the intensive margin is higher than the extensive margin, a landowner could subdivide and sell off some land, or buyers could team up and split the land. But <a href="https://vancouver.ca/home-property-development/zoning-and-land-use-policies-document-library.aspx">zoning</a> and <a href="https://vancouver.ca/your-government/subdivision-bylaw-5208.aspx">subdivision</a> bylaws prevent these moves.</p>
<p>There are of course other things aside from zoning that may prevent subdivision. If land is already parcelled and built out like Vancouver one can’t always just sell off a few extra square feet so that someone else can build a house on it. But pretty much any Vancouver lot could easily be subdivided into two or more parcels and built on individually. A quick <a href="https://www.google.com/maps/place/Tokyo,+Japan/@35.5811282,139.6738449,159m/data=!3m1!1e3!4m5!3m4!1s0x605d1b87f02e57e7:0x2e01618b22571b89!8m2!3d35.6761919!4d139.6503106">look at Tokyo</a> shows how zero setback single family homes can be built on very small parcels and result in a varied, refreshingly quirky, and dense urban form. Essentially, this is the “zoning tax” we are after. The difference in land value that would result from allowing lots in Vancouver to subdivide into two (or more) parcels.</p>
</section>
<section id="how-to-measure-the-zoning-tax" class="level2">
<h2 class="anchored" data-anchor-id="how-to-measure-the-zoning-tax">How to measure the zoning tax?</h2>
<p>To determine the zoning tax we have to estimate land values of parcels of different sizes. And use that to estimate the extensive and intensive margins. We can use this to estimate the zoning tax. We can then take the result and validate it by checking in on some non-conforming lots that pre-date or have otherwise been enabled to elide zoning laws.</p>
<p>To facilitate estimating land values we will take a shortcut by piggy-backing off of BC Assessment land value estimates. That’s quite problematic as we may well just pick up artifacts in the BC Assessment algorithm, so it requires some validation to make sure that we don’t produce nonsense. But if the zoning tax is large, then we should be able to easily detect it using any half-way decent land value estimation mechanism, including the one employed by BC Assessment.</p>
<p>To start off let’s take a look at the subject of our study: RS lots in the City of Vancouver. To clean things up a little we removed parcels that are parks, schools or other non-single family land use. We colour the parcels by their minimum lot size mandated by zoning, lots can’t be subdivided if one of the resulting parts falls below this limit.</p>
<p><img src="index_files/figure-html/rs-parcels-1.png" width="768"></p>
<p>Apart from minimum lot area, minimum frontage is another way we limit subdivisions, and often this constraint is stronger than the minimum area. In practice it does not matter that much though; most parcels can’t be subdivided because that would violate both of these zoning constraints.</p>
<p>Next we need to estimate the extensive and intensive margins of land. To do this we take a group of roughly comparable lots with different lot sizes and compare their land values. For our pool of “roughly comparable” lots we will take a string of adjacent lots along one side of a block and remove corner lots (proxied as lots with only one neighbour). To “compare” land values in relation to lot size we regress log land value on log area, so effectively we estimate <span class="math display">\[
LV = c\cdot A^\beta,
\]</span> where <code>\(LV\)</code> is the land value, <code>\(A\)</code> is the lot area, <code>\(c\)</code> is a constant depending on the group of parcels, and <code>\(\beta\)</code> is the scaling exponent that describes the relationship. The choice of using log land value and log area is informed by general considerations of how people value things, we will have to check in the data how well it fits these model assumptions.</p>
<p><img src="index_files/figure-html/comparable-lots-1.png" width="768"></p>
<p>We see (randomly coloured) groups of “comparable” lots, with corner lots (in dark grey) removed. Removing corner lots not only removes issues around small general price differences between corner vs interior lots, it also deals with issues when the corner lot is on a busy arterial and the price difference can be substantial.</p>
<p>This grouping is not perfect, but it is easy to do and does a good enough job for making our comparisons.</p>
<p>Next we take a look at how land values and areas relate in some of our comparison groups. We will select groups that have at least 8 parcels after throwing out corner lots, and ask there to be a variation in lot size of at least a factor of 1.25 within the group so that estimates are more robust and not just picking up noise generated by parcels of almost equal size, leaving us with the following 1,534 clusters across the city.</p>
<p><img src="index_files/figure-html/analysis-lots-1.png" width="768"></p>
<p>To understand how the land values relate to lot areas within these groups we take a random sample of 32 such groups and fit our model to each group.</p>
<p><img src="index_files/figure-html/analysis-test-1.png" width="768"></p>
<p>The fits aren’t perfect, but generally pretty good. Some groups have their lot areas cluster at the extreme values, others have them distributed throughout. The slopes of these lines, the exponent <code>\(\beta\)</code> in our model, are generally quite similar, which is encouraging. This indicates that our model seems to make sense and fits the data reasonably well. The big caveat here is that this may well just be recovering assumptions baked into the BC Assessment model that estimates the land values in the first place, we will have to validate this against actual transaction prices further down in this post.</p>
<p>We fit a random intercept model that estimates a fixed slope and we allow to intercept to vary across comparable groups, acknowledging that land values differ broadly across different regions of the city, as well as between arterial and residential lots, or lots abutting parks. This gives us a slope (or exponent in our original model) of 0.544 with confidence interval [0.5393,0.5479].</p>
<p><img src="index_files/figure-html/model-result-1.png" width="768"></p>
<p>The part of the plot that we are most interested in is toward the lower left. The median Vancouver RS lot size is 402m^2, what’s the opportunity cost of preventing this lot from getting subdivided? That’s easy to check. This is asking what value we lose by preventing a lot from getting split into two. It’s most easily expressed as a share of current land value. <code>\begin{eqnarray} OC(A) &amp;=&amp; \frac{2\cdot LV(A/2)-LV(A)}{LV(A)} &amp;=&amp; 2^{1-\beta}-1 \end{eqnarray}</code></p>
<p>which comes out at 37%. In other words, the zoning tax that’s preventing RS lots from getting subdivided in half stands at 37% of current land value. Aggregated over all residential RS lots in the City of Vancouver the zoning tax comes out at $46bn.</p>
<p><img src="index_files/figure-html/zoning-tax-2-1-1.png" width="768"></p>
<p>However, some parcels are already below the current minimum area requirements, so maybe we should exclude those from the zoning tax calculation and assume they are already sufficiently subdivided.</p>
<p>Excluding those currently non-conforming lots, but keeping the conditionally conforming, the zoning tax estimate gets reduced to $43bn.</p>
</section>
<section id="what-would-subdivision-look-like" class="level2">
<h2 class="anchored" data-anchor-id="what-would-subdivision-look-like">What would subdivision look like?</h2>
<p>In Vancouver we have several examples of homes on lots well below the minimum lot size. Examples that show what exactly subdividing a typical Vancouver lot would look like, and what the effects would be.</p>
<p>To start off, let’s look at a group of properties in the north-east of the city close to the PNE on the south side of Dundas Street between Slocan and Kaslo.</p>
<p><img src="index_files/figure-html/comparable-example-1.png" width="768"></p>
<p>The coloured properties are the “comparables” in our cluster, two of the properties are 24 foot wide, half the 48 foot width of all the others. The lots are zoned RS-1(A), so while the 48 foot wide lots are wider than the minimum frontage of 30 foot required by the zoning bylaw, they can’t be subdivided into two 24 foot lots. At 2,928 square feet the narrow lots are also just shy of the 3,000 square foot minimum area limit.</p>
<p>The two properties in red sold recently, the larger one in October 2019 for $1.55M, the smaller one in September 2020 for $1.28M. The assessed land values pegged at July 2020 are $1.45M and $1.01M, respectively, with both having building values estimated around $150k. Eyeballing streetview photos this seems reasonable, although an exact attribution is difficult to make without an in-depth assessment. Which highlights a major shortcoming of our methods, but this should not prevent us from getting the ballpark estimate right.</p>
<p><a href="https://www.bcassessment.ca/Property/Info/QTAwMDAwMlFLVA=="><img src="images/015-385-027.png" style="width:48%;"></a> <a href="https://www.bcassessment.ca/Property/Info/QTAwMDAwMlFLWA=="><img src="images/015-385-035.png" style="width:48%;"></a></p>
<p>If we take the land value estimates at face value, the larger lot valued at $1.45M could turn into two lots valued at $1.01M if we allowed it to be subdivided, totalling $2.02M. This amounts to a 39% increase in land value. This is consistent with our overall estimate of a zoning tax share of 37% of existing value for preventing lots from being subdivided.</p>
<p>Another <a href="https://bylaws.vancouver.ca/consolidated/10492.PDF">interesting example is (former) 3582 McGill Street which got rezoned from RS-1 category C to RS-1 caregory A in 2012</a>, reducing it’s minimum frontage requirements from 50 to 30 feet and minimum lot size from 5,000 to 3,000 square feet. The original property had a frontage of 66 feet and an area of 7973 square feet, each of which provided a binding constraint preventing subdivision before the rezoning, but both allow for subdivision after rezoning to category A.</p>
<p>The process of reclassifying from one subdivision schedule to another involves staff time for outreach to neighbours, tallying of their positions (for and against), and detailing of relevant policies and precedents. Then it comes before City Council, who make their final decision with a <a href="https://council.vancouver.ca/20120516/documents/ptec3.pdf">recommendation report from planning staff</a>. Since no neighbours were opposed (only 3 of 25 nearby neighbours asked to comment responded at all), the McGill reclassification was successful. This allowed the original property to get subdivided into two separate ones of roughly equal size, 3586 and 3592 McGill Street. We can watch this redevelopment in the building values for the site with PID 015-717-577 getting split into properties 028-985-630 and 028-985-648.</p>
<p><img src="index_files/figure-html/mcgill-subdivision-1.png" width="768"></p>
<p>We notice how the assessed values of each subdivision is initially lower than the original combined land value, but the sum of the assessed values of the subdivided lots is larger than the original one. This is what we would expect, if there wasn’t a value gain by splitting the lots, the developer would not have split them. Here we should remember that we are not actually observing land values directly, but using BC Assessment estimates.</p>
</section>
<section id="non-conforming-lots" class="level2">
<h2 class="anchored" data-anchor-id="non-conforming-lots">Non-conforming lots</h2>
<p>Just how many lots in Vancouver are already non-conforming? That’s a tricky question, especially when it comes to frontage, as the city dataset on that is messy and it’s somewhat ambiguous how to count frontage for corner lots. To make it even trickier, Vancouver has two kinds of conforming. There is <strong>outright</strong> conforming with subdivision classification in zoning. There there is <strong>conditional</strong> conforming, dependent upon the approval of the director of planning (or appointed officer) on a case-by-case basis. As it turns out, four combinations of zoning district and subdivision category have area and frontage limits that can be lowered somewhat, <strong>conditional</strong> on approval from the planning department.</p>
<p>Overall we estimate there are 4,062 lots, or 6% of all lots that don’t conform to either area (816) or frontage (2,695) or both (551) requirements, even granting each lot conditional approval of lowered limits if applicable.</p>
<p>Additionally, there are 1,405 properties that don’t conform with the <em>outright</em> requirements but satisfy the <em>conditional</em> ones. We can break this down by zoning and subdivision category.</p>
<p><img src="index_files/figure-html/non-conforming-overview-1.png" width="768"></p>
<p>Things are particularly awkward in RS-7, RS-1A and RS-2, where the <em>outright</em> minimum frontage requirements are 40 foot and the minimum area requirement is 4,800 square feet, but the director of planning may <em>conditionally</em> lower them down to 30 foot frontage and 3,000 square feet. The result is that the majority of properties in each of these zones only complies with the <em>conditional</em> requirements, begging the question why the City of Vancouver insists on this kind of case-by-case zoning in these areas.</p>
<p>Non-conforming lots can be found all over the City of Vancouver, but conditionally-conforming lots cluster in the four zoning and subdivision areas that have conditional subdivision zoning.</p>
<p><img src="index_files/figure-html/non-conforming-map-1.png" width="768"></p>
</section>
<section id="repeated-subdivisions" class="level2">
<h2 class="anchored" data-anchor-id="repeated-subdivisions">Repeated subdivisions</h2>
<p>So far we have looked at allowing each lot to subdivide once, but we could go further and ask what would happen if we allowed our standard 33 foot by 122 foot lot to be split into four 16 by 60 foot lots, halving the frontage and upgrading the alleyways to allow independent homes. This would require us to rethink how we deal with some aspects of how we organize services like power cables, sewer lines, size of our fire trucks and garbage pickup. But these are hardly insurmountable challenges and many parts of the world have figured out how to deal with them. To deal with edge cases in this scenario we will set the minimum frontage at 15’ and the minimum depth at 55’, or a minimum lot size of 825 square feet.</p>
<p>Comparing our current zoning to one that allows for this “quadruple subdivision” on standard lots yields a zoning tax of $146bn, substantially more than our initial estimate. Despite this massive overall lift in land values, individual lots are estimated to be priced between $519k and $1.26M at the 5th and 95th percentile.</p>
<p><img src="index_files/figure-html/repeated-zoning-tax-lot-prices-1.png" width="768"></p>
<p>This kind of subdivision has the potential, if fully realized, to have a sizable number of lots around $500k, while currently the entry price for a buildable lot in the City of Vancouver sits around $1M.</p>
<p><img src="index_files/figure-html/repeated-zoning-tax-map-1.png" width="768"></p>
</section>
<section id="broad-and-narrow-rezoning" class="level2">
<h2 class="anchored" data-anchor-id="broad-and-narrow-rezoning">Broad and Narrow Rezoning</h2>
<p>Our zoning tax estimates are based on comparing the land value of relatively scarce small lots (generally not allowed) with larger lots (generally mandated). If restrictions on subdivision were lifted, these two prices would move toward one another (per square foot) as small lots became more common and larger lots more scarce, eventually erasing the differential. As such, estimates of the zoning tax would eventually move toward zero if constraints on subdivision were lifted all across the City. On the other hand, if constraints were selectively lifted in one place, then another (as occurs with spot zoning), we’d expect to see price differentials remain.</p>
<p>Put slightly differently, the zoning tax estimates are based on the current situation and are based on the premise of making small changes. Yet lifting restrictions on subdivisions across the city is everything but a small change. It has the potential to dramatically alter the availability of small lots, which in turn could lower prices for small lots and change the zoning tax calculus. The effect on the prices of larger lots is more complex, but this would lower the overall zoning tax estimate. At the same time it would increase affordability making the lifting of restrictions a win-win situation, with a trade-off between the total zoning tax unlocked and affordability.</p>
<p>In practice, subdivision would be a gradual process even if allowed all across the city. Depending on the value of the structure on a given lot, subdivision will not be economically feasible as it generally requires demolition (or equally expensive, relocation) of the existing structure. And while <a href="https://mountainmath.ca/teardowns">Vancouver has a lot of single family structures that are at the end of their economic life span</a>, turnover is usually conditional on a property transaction. In summary, one would expect the transition to smaller lots to be gradual, even if the ability to subdivide is likely to accelerate trends in sales and redevelopment.</p>
</section>
<section id="subdivision-versus-stratification" class="level2">
<h2 class="anchored" data-anchor-id="subdivision-versus-stratification">Subdivision versus Stratification</h2>
<p>Subdivision of parcels is not the only way to unlock the zoning tax. Subdivision of air parcels, a.k.a. stratification (condos), is an alternative to subdivision of land that is similarly suited to unlock the zoning tax. We did not explicitly model air parcel subdivision mostly to keep things simple, but one should expect similar effects. On top of this, stratification makes it easier to subdivide even further, when lot sizes become so small that fee-simple structures become less feasible. One could even go further and consider assemblies in order to achieve buildings with more efficient (and accessible) layouts.</p>
<p>In practice we might want to allow all of these, subdivision of land as well as subdivision of air space of single lots as well as assemblies. Tokyo shows how larger buildings can nicely co-exist with zero-setback single detached homes and result in a delightfully varied streetscape.</p>
<p>At the same time, we likely want to change our rules on setbacks and FSR. The examples of <a href="https://www.google.com/maps/@49.2628963,-123.2080346,3a,30y,7.15h,92.74t/data=!3m6!1e1!3m4!1sJPF9OxbAu5K5WD2JcZcuog!2e0!7i16384!8i8192">16 foot wide lots</a> that we have show that current rules can still result in viable homes on half-sized regular lots, but at the latest when we subdivide further to also allow front/back subdivisions on top of that we need to increase FSR and make dramatic changes to front and back yard in order to achieve functional homes. The same is true if we allow stratified 4-plexes on regular lots with all family-sized units. If this happens, land values may increase further, rendering our zoning tax figure of $146bn an under-estimate.</p>
</section>
<section id="upshot" class="level2">
<h2 class="anchored" data-anchor-id="upshot">Upshot</h2>
<p>The exact amount of the zoning tax is hard to pin down because we are so far away from the equilibrium of where people would stop subdividing land or air parcels if they were allowed to do so. But it is clear that the zoning tax is real, and it is enormous. At the lot level the zoning tax materializes as a subsidy for hoarding of land paid for by lost opportunities for those willing to share land via smaller lots or stratification. Collectively the zoning tax quantifies (a portion of) the problems with City of Vancouver land use policies, pushing up housing prices and forcing people into long commutes.</p>
<p>As usual, the code for this post is <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2021-07-25-lots-of-opportunity-estimating-the-zoning-tax-in-vancouver/index.Rmarkdown">available on GitHub</a> for anyone to reproduce or adapt for their own purposes.</p>
<details>
<summary>
Reproducibility receipt
</summary>
<pre><code>## [1] "2021-07-25 13:30:03 PDT"</code></pre>
<pre><code>## Local:    master /Users/jens/Google Drive/R/mountaindoodles
## Remote:   master @ origin (https://github.com/mountainMath/doodles.git)
## Head:     [77951fa] 2021-07-25: fix og image url</code></pre>
<pre><code>## R version 4.1.0 (2021-05-18)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] mountainmathHelpers_0.1.3 mapdeck_0.3.4            
##  [3] sf_1.0-0                  VancouvR_0.1.6           
##  [5] forcats_0.5.1             stringr_1.4.0            
##  [7] dplyr_1.0.7               purrr_0.3.4              
##  [9] readr_1.4.0               tidyr_1.1.3              
## [11] tibble_3.1.2              ggplot2_3.3.3            
## [13] tidyverse_1.3.1          
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.7         lubridate_1.7.10   class_7.3-19       assertthat_0.2.1  
##  [5] digest_0.6.27      utf8_1.2.1         R6_2.5.0           cellranger_1.1.0  
##  [9] backports_1.2.1    reprex_2.0.0       evaluate_0.14      e1071_1.7-7       
## [13] httr_1.4.2         blogdown_1.4       pillar_1.6.1       rlang_0.4.11      
## [17] readxl_1.3.1       rstudioapi_0.13    jquerylib_0.1.4    rmarkdown_2.8     
## [21] urltools_1.7.3     htmlwidgets_1.5.3  triebeard_0.3.0    munsell_0.5.0     
## [25] proxy_0.4-26       broom_0.7.6        compiler_4.1.0     modelr_0.1.8      
## [29] xfun_0.24          pkgconfig_2.0.3    htmltools_0.5.1.1  tidyselect_1.1.1  
## [33] bookdown_0.22      fansi_0.5.0        crayon_1.4.1       dbplyr_2.1.1      
## [37] withr_2.4.2        grid_4.1.0         jsonlite_1.7.2     gtable_0.3.0      
## [41] lifecycle_1.0.0    DBI_1.1.1          git2r_0.28.0       magrittr_2.0.1    
## [45] units_0.7-2        scales_1.1.1       KernSmooth_2.23-20 cli_3.0.1         
## [49] stringi_1.7.3      fs_1.5.0           xml2_1.3.2         bslib_0.2.5.1     
## [53] ellipsis_0.3.2     generics_0.1.0     vctrs_0.3.8        tools_4.1.0       
## [57] glue_1.4.2         hms_1.1.0          yaml_2.2.1         colorspace_2.0-1  
## [61] classInt_0.4-3     rvest_1.0.0        knitr_1.33         haven_2.4.1       
## [65] sass_0.4.0</code></pre>
</details>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2021,
  author = {von Bergmann, Jens and Lauster, Nathan},
  title = {Lots of {Opportunity:} {Estimating} the {Zoning} {Tax} in
    {Vancouver}},
  date = {2021-07-25},
  url = {https://doodletest.netlify.app/posts/2021-07-25-lots-of-opportunity-estimating-the-zoning-tax-in-vancouver},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von, and Nathan Lauster. 2021. <span>“Lots of
Opportunity: Estimating the Zoning Tax in Vancouver.”</span>
<em>MountanDoodles</em> (blog). July 25, 2021. <a href="https://doodletest.netlify.app/posts/2021-07-25-lots-of-opportunity-estimating-the-zoning-tax-in-vancouver">https://doodletest.netlify.app/posts/2021-07-25-lots-of-opportunity-estimating-the-zoning-tax-in-vancouver</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodletest\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mountainmath/mountain_doodles" data-repo-id="R_kgDOLuoDtA" data-category="Blog posts" data-category-id="DIC_kwDOLuoDtM4Cetfc" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark_dimmed">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>