<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="dcterms.date" content="2019-08-01">
<meta name="description" content="A closer look at the the Regional Growth Strategy and population projections">

<title>Mountain Doodles - On Vancouver population projections</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/plain" cookie-consent="tracking">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Mountain Doodles - On Vancouver population projections">
<meta property="og:description" content="A closer look at the the Regional Growth Strategy and population projections">
<meta property="og:image" content="https://doodletest.netlify.app/posts/2019-08-01-on-vancouver-population-projections/index_files/figure-html/projections_vs_actual-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1536">
<meta name="twitter:title" content="Mountain Doodles - On Vancouver population projections">
<meta name="twitter:description" content="A closer look at the the Regional Growth Strategy and population projections">
<meta name="twitter:image" content="https://doodletest.netlify.app/posts/2019-08-01-on-vancouver-population-projections/index_files/figure-html/projections_vs_actual-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1536">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountaindoodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">On Vancouver population projections</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">On Vancouver population projections</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountaindoodles/blob/main/posts/2019-08-01-on-vancouver-population-projections/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          A closer look at the the Regional Growth Strategy and population projections
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">cancensus</div>
                <div class="quarto-category">cmhc</div>
                <div class="quarto-category">Vancouver</div>
                <div class="quarto-category">cansim</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jens von Bergmann </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 1, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Metro Vancouver’s population is growing. For planning purposes we want to understand how our population will be growing. For that we need projections.</p>
<p>Here we need to carefully distinguish two related but distinct types of population projections.</p>
<ul>
<li>projections of population demand, and</li>
<li>projections of population growth.</li>
</ul>
<p>Projecting demand, or even just estimating current population demand, is complex. Demand is a function of a variety of factors, most importantly jobs, and amenities, as well as home prices and rents (in relation to incomes and wealth). Jobs and amenities, relative to other areas, determine the attractiveness of a region to in-migration (and the dissuasion to out-migration). Natural growth (birth minus deaths) is only a small factor in Metro Vancouver’s growth.</p>
<p>This <em>attractiveness</em> of a region sets an abstract upper limit for population demand. Actual population growth up to the abstract upper limit depends on the amount of available housing (relating to population demand via <em>households</em>). This is where we have to remember that demand is a function of price, and the abstract upper limit on population demand is built on the assumption that people can find housing at an acceptable price. In reality, the population demand is curbed through market prices for market housing, and waitlists for non-market housing. This is how population demand and population growth meet.</p>
<p>For planning purposes, defining demand through current market prices is tautological and not very useful. After all, population projections are often used to limit the amount of permitted housing. Which leaves us with the question: What is the cost of housing we should estimate population demand at?</p>
<p>For market housing, a good, albeit somewhat abstract, answer is <a href="http://realestate.wharton.upenn.edu/wp-content/uploads/2017/03/802.pdf">Glaeser’s <em>Minimum Profitable Production Cost</em> (MPPC)</a>, that is the cost to add housing to a given market, which depends on construction cost (which will rise with density and could use some refinement), augmented by municipal service charges and possibly other charges, for example charges aimed to maintain livability, the cost of land (usually taken to be 20% of construction cost and service charges), and a developer profit. While the MPPC in Vancouver is high, the price of market housing is even higher than that. In the media this is often described as elevated <em>land values</em>. Land values of a housing unit is the residual value that buyers are willing to pay above what it costs to construct the unit (including development charges). That differential is negotiated through supply and demand of market housing.</p>
<p>Demand for non-market housing is, by definition, not negotiated through price. The distribution of non-market housing is done via eligibility criteria and waitlists. Demand can be approximated by the length of the waitlist, although that will generally be a substantial under-estimate in real life situations where wait list tend to be so long that many eligible households don’t even bother applying.</p>
<section id="a-look-at-population-demand-in-vancouver-and-calgary" class="level2">
<h2 class="anchored" data-anchor-id="a-look-at-population-demand-in-vancouver-and-calgary">A look at population demand in Vancouver and Calgary</h2>
<p>It is safe to say that Vancouver’s amenity value is comparatively high, but it is hard to quantify that. Quantifying the job market is much easier. For comparison we choose Calgary, also a city with high amenity value, although probably not quite as high even though it often features high in livability surveys. However, at this time Calgary facing a very different jobs market from Vancouver.</p>
<p>Calgary has a healthy existing housing supply to accommodate mild population growth with a primary market rental vacancy rate of 3.9% and a private condo rental vacancy rate of 2.7%. At the same time Calgary is continuing to add new housing units at a good pace with apartment building starts for the first six months of 2019 only 2.5% below the corresponding 10 year average and completions and apartment units under construction up by 15.9% and 14.0%, respectively.</p>
<p>Economic indicators in Calgary are slowly improving, but current economic conditions show a relatively high unemployment rate of 7.0%, above the Canadian average of 5.5%. At the same time, Calgary has a job vacancy rate of 2.5%, below the Canadian average of 3.1%. That means that unless economic conditions change we expect that on balance people to move away from Calgary over the long term.</p>
<p>This means that Calgary’s housing market likely has a bit of a buffer at this point so that population demand and population growth are roughly the same right now, which simplifies things.</p>
<p>In Vancouver on the other hand, population demand and population growth are quite different. Vancouver’s unemployment rate sits at 4.0% while the job vacancy rate of the economic region is 4.9%. The current population can’t fill the existing jobs, and with current primary and secondary market rental vacancy rates at an anemic 1.0% and 0.3%, respectively, there is no way for people wanting to fill those jobs to move into the region. Current population demand is significantly higher than population growth. Dwelling growth becomes a hard cap on population growth.</p>
<p>The silver lining in this desperate situation is that apartment building starts in the first half of 2019 is a whopping 102.7% above the corresponding 10 year average and completions and apartment units under construction are up by 41.9% and 78.1%, respectively. One should note however that at current rates at fairly high completions it would take about 15 months to complete the number of dwelling units needed to make room for the 26,537 workers (at a healthy average rate of 1.3 workers per dwelling unit, and completely ignoring the need for moving vacancies) to bring Vancouver’s job vacancy rate down to the Canadian average. And that’s not accounting for jobs created through continued economic growth or knock-on effects of the economic activity associated with adding these workers and filling the jobs. Thus it will take a while to clear the backlog of undersupply, let alone catch up with latent demand due to delayed household formation, overcrowded households and bring the rental vacancy rate up to healthy levels.</p>
<p>In clearing the backlog, Vancouver’s prices and rents will have to adjust to meet this demand, with recent demand side measures like the City of Vancouver Empty Homes Tax and the vacancy tax component of the provincial Speculation and Vacancy Tax helping ensure that properties get occupied and thus aiding the process of price and rent adjustments.</p>
<p>This means that at least for the shorter term future Vancouver will have to arrange itself with a significant gap between population demand and population growth, and the associated market selection mechanism sorting out who gets to come/stay and who gets pushed or shut out of market housing, and our non-market mechanisms selecting how gets to occupy non-market housing units.</p>
</section>
<section id="planning-for-growth" class="level2">
<h2 class="anchored" data-anchor-id="planning-for-growth">Planning for growth</h2>
<p>In our highly regulated building environment, population projections (and dwelling projections) are turned into a high-stakes game. In Vancouver, we rely on the <strong>Metro Vancouver Regional Growth Strategy (RGS)</strong> to set population and dwelling growth targets, and distribute the growth across the municipalities within the region. Those targets are then used as a guideline for how much new construction to permit.</p>
<p>At the metro level, there are three possible outcomes:</p>
<ol type="1">
<li>The RGS overestimates population demand and we permit more housing than needed.</li>
<li>The RGS correctly estimates population demand and we permit exactly as much housing as needed.</li>
<li>The RGS underestimates population demand and/or we permit too little housing.</li>
</ol>
<p>In the first case, developers will simply stop building excess housing since providing housing in excess of demand becomes unprofitable fast. The second case essentially never happens, projections are always wrong. The third case is the case of a housing shortage, which leads to people getting shut out of the region, price growth for ownership and rental housing, and a dampening of the economy due to labour shortages.</p>
<p>The costs for under-estimating growth are high (while the cost to over-estimate growth is low). Time to take a more careful look at the RGS.</p>
</section>
<section id="benchmarking-the-rgs" class="level2">
<h2 class="anchored" data-anchor-id="benchmarking-the-rgs">Benchmarking the RGS</h2>
<p>To illustrate this we can look at the (now dated) <a href="https://vancouver.ca/files/cov/metro-vancouver-regional-growth-strategy.pdf">population projections by the Metro Vancouver Regional District, (now just called Metro Vancouver) from 2010</a>.</p>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<p>The projections call for a slowing of the growth in the region over the years. In the beginning, dwelling growth exceeds population growth to account for shrinking household size, but curiously the model has almost identical dwelling and population growth rates for 2031 to 2041. Unfortunately there is no further explanation how the model was derived, but this seems to assume that household size stabilizes by the 2031-2041 period and all latent demand has been dealt with. Employment is projected to rise at a slightly slower rate than population, probably reflecting the shrinking portion of the population in the work force as the share of seniors continues to increase and the entry time in the labour market continues to get delayed due to increasing levels of education.</p>
<p>Long term projections are hard, so let’s focus on the short term until 2021. And interpolate values for the 5 year intervals given by census years that allow us to check how the projections held up. For simplicity, we will assume the growth rates to be constant within each interval, the exact way we interpolate does not make much of the difference for what follows. Projections are always bound to be different from actual numbers anyway, what this post focuses on is the relative difference between the three metrics.</p>
<p>The Regional Growth Strategy was updated in 2017, and it is a worthwhile exercise to check how the updated projections compare.</p>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="864"></p>
<p>We see that the updated projections sport slightly higher growth rates, and also remove the assumption of a stop to shrinking household size for the 2031-2041 period.</p>
</section>
<section id="how-to-measure-population-dwellings-and-employment" class="level2">
<h2 class="anchored" data-anchor-id="how-to-measure-population-dwellings-and-employment">How to measure population, dwellings and employment</h2>
<p>To understand population demand we need to at least measure population, dwellings and jobs/employment.</p>
<p>The question how to measure these metrics is surprisingly less straight-forward than it seems. Ideally we want high-frequency data so we can closely monitor how our region is changing. Annual data is probably good enough for that. StatCan has a number of annual tables at the CMA level that can inform on employment and population growth, although the employment tables are based on place of residence and not place of work. Which makes a difference when there are changes in net commute patterns for Metro Vancouver. The census also counts population and employment, although one needs to adjust for the census undercounts.</p>
<p>StatCan does not have good tables on the number of dwelling units, although CHSP data is starting to use administrative data to count residential properties. Folding in unit counts for each property gets us closer to dwelling units, but this still fails to account for some informal dwellings, like non-authorized secondary suites. BC Stats has annual estimates of dwelling units that can also be used. The census has (private) dwelling counts, but they generally under-count as the census inevitably misses dwelling units, as we also need to account for collective dwellings.</p>
<p>Finer geography data, so data for municipalities within Metro Vancouver, are harder to get from the annual StatCan tables, although BC Stats has population estimates (and projections) at the municipal level, and custom tabulations are available at least for the larger municipalities. Census data is available on municipal and sub-municipal geographies, but the numbers still need to be adjusted for undercounts and net commute flows.</p>
<p>Sorting out these details takes more effort than what we are willing to spent on this post. We will focus on growth rates and differences over given time periods, what’s most important is to choose consistent metrics for this. Differences stemming from the particular choice of metric tend to divide out this way, and we will ignore related issues for this post as they are smaller than the effects we are interested in.</p>
<p>The RGS is unfortunately a bit vague on how exactly the base estimates were derived, stating that dwelling counts (just private or private and collective?) are based on the census, and population and employment (not jobs) estimates are derived from the census and were adjusted for census undercounts (probably via a custom-tabulation at the sub-metro level?).</p>
</section>
<section id="comparing-metrics" class="level2">
<h2 class="anchored" data-anchor-id="comparing-metrics">Comparing metrics</h2>
<p>Population counts at the metropolitan level are easily available from StatCan table 17-10-0135 that is already adjusted for census undercounts, but is anchored on July 1st, almost two months after the census. For Metro Vancouver, that came out at 2,188,743, quite close to the 2,195,000 from the Regional Growth Strategy.</p>
<p>Next up is the number of dwellings, those <em>should</em> be straight-up census numbers, but the RGS had 848,000 dwelling units and the 2006 census counted 870,992 private dwellings, not including collective dwellings. It’s unclear to me why these differ so dramatically.</p>
<p>Employment counts are harder than they should be. Moreover, employment is probably not the most relevant metric, it would be better to count jobs. Which is even harder. As the RGS employment estimates are based on the census, we can query the employment variable by place of work geography. We get a total employment of 1,113,465 people in Metro Vancouver, compared to 1,158,000 from the RGS.</p>
<p>The match is reasonably good, although our census numbers don’t include the census undercount yet. Undercounts are only available for the place of residence, not the place of work geography, but that difference will have a negligible effect. An alternative is to use Labour Force Survey data that is available annually, but only considers place of residence instead of place of work. For 2006 that estimate comes out as 1,139,800 for the (unadjusted) employment in Metro Vancouver in May 2006.</p>
<p>To move forward, we will focus on the growth of our measures rather than the absolute numbers, as differences in sources and methods tend to divide out that way. As this is something that should be monitored on an ongoing basis we will be relying on the annual StatCan tables for population and employment estimates, rather than the census estimates.</p>
<p>However, when we need finer regional breakup we are confined to census estimates.</p>
</section>
<section id="checking-in-with-2011-data" class="level2">
<h2 class="anchored" data-anchor-id="checking-in-with-2011-data">Checking in with 2011 data</h2>
<p>The 2011 Census data gives us the first reality check of the data. We use the baseline 2011 estimates from the updated Metro Vancouver Regional Growth Strategy from 2017 as another point of comparison.</p>
<p>We compare the annual growth rates for the 2006-2011 timeframe as projected by Metro Vancouver in 2011 to the original 2006 base line and updated 2011 base lines, to the “actual” change based on Census (for private dwellings) and annual StatCan tables (for population and employment). Calling these “actual” is a bit ambitious, as we are glossing over details as we have explained above, but we will run with this for now.</p>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="864"></p>
<p>What this shows is that population came in roughly as projected, whereas employment fell a bit short (which should not be surprising considering financial crisis hit in that time window). What’s a real head-scratcher is the change in dwellings, where projections came a bit short of the actual, and the two Regional Growth Strategy baseline differ significantly. This points to a change in methods in the RGS.</p>
<p>We can also look at how our population, dwelling and employment estimates line up with the 2006 and 2011 baseline estimates from Metro Vancouver.</p>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<p>This shows that the Metro Vancouver Regional Growth Strategy did a decent job at projecting jobs and population, but came in systematically short of their dwelling targets. The smaller differences aren’t concerning and expected when using different metrics, but it would be prudent to better understand the apparent dwelling shortfall in the RGS. It would be good to better understand exactly how Metro Vancouver derives their estimates and projections.</p>
</section>
<section id="checking-in-with-2016-data" class="level2">
<h2 class="anchored" data-anchor-id="checking-in-with-2016-data">Checking in with 2016 data</h2>
<p>The 2016 census gives us another opportunity to check the projections against the data. We can use the projections from the original and the updated Growth Strategy and compare them to our estimates based on Census data and annual tables.</p>
<p><img src="index_files/figure-html/projections_vs_actual-1.png" width="768"></p>
<p>We see that the population grew faster than projected off the 2006 baseline, but a bit slower than projected off the 2011 baseline. Dwellings consistently grew slower than projected while employment consistently outperformed projections.</p>
<p>Another interesting takeaway from the data is to just look at the trend in our “Actual” data.</p>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
<p>This shows that dwelling growth slowed somewhat after 2011, while population growth slightly increased and employment growth increased dramatically, recovering from the slower growth during the economic slowdown around 2008.</p>
</section>
<section id="regional-breakdown" class="level2">
<h2 class="anchored" data-anchor-id="regional-breakdown">Regional breakdown</h2>
<p>Another aspect of the Metro Vancouver Regional Growth Strategy is the regional allocation of the growth. Here we are working exclusively with the updated Growth Strategy. For this we can’t get away with using annual population and employment data any more but have no choice but go with census data. This means we have to worry about census undercounts, but this is where things get tricky. Those estimates aren’t easily available at the municipal level, and one would expect significant regional variation that simply using metro estimates isn’t particularly informative. BC Stats has custom population estimates at the municipal level that include the census undercount, and StatCan probably has custom estimates as well. We will skip over this detail, the difference in census coverage rates between the census years should not impact our results by much.</p>
<p>Moreover, we can’t lazily assume that place of residence and place of work (roughly) coincides like we did when looking at the Metro level, we will have to be careful about how we count employment. Again, a custom tabulation would be helpful for this, but we will make due with adjusting employment numbers by net commuter flow between municipalities, recognizing that we are missing flows between municipalities with fewer than 20 commuters.</p>
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
<p>Again, projections are just projections, and our census numbers do not account for census undercounts, although most of these will divide out when taking differences. And our employment estimates, especially for smaller municipalities, should be taken with caution because our commute flow data dropped flows below 20 commuters. Thus it makes more sense to focus on the more populous municipalities.</p>
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" width="768"></p>
<p>The City of North Vancouver is the only municipality that exceeded its projections on all three metrics. The City of Vancouver, Surrey, New Westminister and Burnaby all exceeded their employment projections, while at the same time falling short of their dwelling (and their population) projections. All of the other larger municipalities, with the exception of Maple Ridge, came in below their projections on all three metrics.</p>
<p>Unfortunately Metro Vancouver did not detail how they arrived at their projections, so it is difficult to read too much into this discrepancy. But it provides a good opportunity to re-evaluate the metrics and assumptions they are based on. What we do see is a very good correspondence between dwelling and population growth, as is to be expected.</p>
<p>Of particular interest is the relationship between these metrics, in particular the one between dwellings and population. It can be useful to break down population change into population change due to change in dwelling units, population change due to change in household size and population change due to change in the rate of unoccupied dwelling units <a href="https://doodles.mountainmath.ca/blog/2017/02/10/2016-census-data/">as we have explained before</a>, with each component <a href="https://censusmapper.ca/maps/988?index=0#9/49.2158/-123.3023">mapped out across Canada</a>.</p>
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" width="768"></p>
<p>Generally we expect population to grow slower than dwellings due to shrinking household size, but this is not always the case as the data shows. For example, household size increase in the City of North Vancouver, and the increase was large just enough to make up for a slight increase in dwellings not occupied by usual residents. Maple Ridge and the District of Langley on the other hand experienced a slight drop in household size, but this was more than made up for by a drop in dwellings not occupied by usual residents. New Westminster saw both, an increase in household size and a drop in dwellings not occupied by usual residents, which boosted the ratio. Our interactive map makes it easy to explore the reasons for these census ratios <a href="https://censusmapper.ca/maps/988?index=0#9/49.2158/-123.3023">in the case of the population in private households only</a> as well as <a href="https://censusmapper.ca/maps/596#9/49.2526/-123.1437">in a more complex visualization for the entire population</a> (which slightly changes the interpretation for Maple Ridge, presumably due to an increase in collective dwellings).</p>
<p>We should point out that for Electoral A there has been a significant number of reclassification from collective to private dwellings within parts of UBC student housing that register as unoccupied by usual residents in the census, as well as significant new construction, both of which add to “unoccupied” dwellings and drag down the ratios from the census shown in the graph above.</p>
<p>To quantify the relationship between population and dwelling growth rates we can fit a simple linear model to the RGS targets, as well as to growth rates derived from census data.</p>
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" width="768"></p>
<p>Census data gives a better fit than to the RGS projections, with an adjusted <em>R<sup>2</sup></em> of 0.849 for census data and 0.776 for the RGS. This points to room for refinement. One should be able to improve the model fit by accounting for collective dwellings, as well as number of units completed in the months before census day for each of the census years, <a href="https://doodles.mountainmath.ca/blog/2017/04/03/joyce-collingwood/">which has a noticeable impact on the number of unoccupied units as we have explained before</a>. A more detailed understanding of the number of bedrooms of the added (and lost) dwelling units, as well as tenure, is <a href="https://doodles.mountainmath.ca/blog/2019/04/20/a-bedroom-is-a-bedroom/">a great predictor of household size</a>, information on the mix of bedrooms should give another significant boost to improve the model fit. Lastly, we need to recognize that change in wealth is another measure, as change in wealth is generally associated with consumption of more housing (and shrinking household size).</p>
<p>The takeaway is that the relationship between new dwelling units and population growth is very predictable, and in our supply constrained market we find that population growth is constrained by dwelling growth.</p>
</section>
<section id="planning-for-the-region" class="level2">
<h2 class="anchored" data-anchor-id="planning-for-the-region">Planning for the region</h2>
<p>Dwelling growth in our region is highly regulated. The Regional Growth Strategy is only a guiding document, but it is often used as a plan that allocates growth to the region overall and distributes it within the region.</p>
<p>We have already seen that there are significant latent population pressures, partially due to dwelling growth targets set out by the Growth Strategy not being met, and partially by these targets likely being too low. Here we want to focus on how the Growth Strategy is distributing that growth, and how that might relate to people’s preferences.</p>
<p>We have already seen above that the projections assume stronger growth in some of the outlying regions than in some of the central regions. To bring this out more, we compare the projected growth in the City of Vancouver to the rest of Metro Vancouver.</p>
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" width="768"></p>
<p>The Regional Growth Strategy is projecting that the City of Vancouver will grow slower than the rest of the region. This makes sense if we assume that, on balance, people would rather live further out than they do right now. But I all evidence points toward the opposite being true, that is that people would, on balance, rather live in the City of Vancouver than in more outlying municipalities. Allocating growth in direct opposition to people’s preferences serves to drive up prices and rents in the central areas, and to drive low income people out. Which is <a href="https://doodles.mountainmath.ca/blog/2017/09/26/evolution-of-the-income-distribution/">exactly what we have seen when looking at income data</a> where incomes have rising much faster in the City of Vancouver than in Metro Vancouver overall, with the higher income brackets growing faster and low income brackets dropping faster in the City of Vancouver.</p>
</section>
<section id="upshot" class="level2">
<h2 class="anchored" data-anchor-id="upshot">Upshot</h2>
<p>The last two sections illustrate two main dangers of an overly restrictive planning regimen.</p>
<ul>
<li>When planners don’t manage to hit their dwelling targets, or set their dwelling targets too low, we end up with higher population pressures and hit labour market constraints.</li>
<li>When planners don’t manage to allocate the growth within the region according to people’s preferences, it will create artificial price gradients and push people out of their preferred areas and lengthen commutes.</li>
</ul>
<p>Both of these outcomes have strong negative consequences for individuals, as well as the for the region overall. This is why it is very important that planners pay close attention to early warning signals of dwelling shortages as well as within-region location preferences.</p>
<p>More transparent models would also be helpful, especially given how high the stakes are when the dwelling targets are set too low. It would be helpful if planners, maybe in conjunction with economists, could explain better what consequences different planning scenarios may likely have for the region, so the politicians and the general public can make better decisions on how the region should grow.</p>
<p>In our highly regulated environment it is prudent to develop better metrics that can be updated regularly and that help inform of region-wide housing shortages, as well as more localized housing shortages within the region. Recently <a href="https://twitter.com/LausterNa">Nathan Lauster</a> and I set out to <a href="https://doodles.mountainmath.ca/blog/2019/06/12/simple-metrics-for-deciding-if-you-have-enough-housing/">draw up an outline of how such metrics could be constructed</a>, a task we are planning on following up on with more concrete metrics and code that implement them.</p>
<p>As usual, the code for the analysis is <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2019-08-01-on-vancouver-population-projections.Rmarkdown">available on GitHub</a>.</p>
<!-- ## Growth without projections -->
<!-- It should be noted that there is an alternative model how to do this, one can simply let the market respond flexibly to population pressures and build as many dwelling units as it wants. Sometimes the market will build too many dwelling units in locations that people don't really want to live, resulting in lower prices and possibly financial losses for the developer. And building activity in that location will slow down. Sometimes the market will build too few units in a location and prices will rise, resulting in higher than expected gains for developers and building activity in that location will increase. In this model, the role of municipal and regional planning would be to facilitate the activity of developers by ensuring that adequate services are provided, that enough park space and other public services are available to accommodate the growth. This model greatly simplifies the planning process, as it only needs to respond to development activity and does not need to rely on projections. -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2019,
  author = {von Bergmann, Jens},
  title = {On {Vancouver} Population Projections},
  date = {2019-08-01},
  url = {https://doodletest.netlify.app/posts/2019-08-01-on-vancouver-population-projections},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2019" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von. 2019. <span>“On Vancouver Population
Projections.”</span> <em>MountanDoodles</em> (blog). August 1, 2019. <a href="https://doodletest.netlify.app/posts/2019-08-01-on-vancouver-population-projections">https://doodletest.netlify.app/posts/2019-08-01-on-vancouver-population-projections</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodletest\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>