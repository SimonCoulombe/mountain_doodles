<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="author" content="Nathan Lauster">
<meta name="dcterms.date" content="2022-05-17">
<meta name="description" content="The Broadway Plan is coming before council, time for a review of what’s being proposed, which parts are good and which might need work, and how that fits into the historical context.">

<title>Mountain Doodles - On Broadway</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/plain" cookie-consent="tracking">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Mountain Doodles - On Broadway">
<meta property="og:description" content="The Broadway Plan is coming before council, time for a review of what’s being proposed, which parts are good and which might need work, and how that fits into the historical context.">
<meta property="og:image" content="https://doodletest.netlify.app/posts/2022-05-17-on-broadway/index_files/figure-html/broadway_zoning_history-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="1152">
<meta property="og:image:width" content="1536">
<meta name="twitter:title" content="Mountain Doodles - On Broadway">
<meta name="twitter:description" content="The Broadway Plan is coming before council, time for a review of what’s being proposed, which parts are good and which might need work, and how that fits into the historical context.">
<meta name="twitter:image" content="https://doodletest.netlify.app/posts/2022-05-17-on-broadway/index_files/figure-html/broadway_zoning_history-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="1152">
<meta name="twitter:image-width" content="1536">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountaindoodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">On Broadway</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">On Broadway</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountaindoodles/blob/main/posts/2022-05-17-on-broadway/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          The Broadway Plan is coming before council, time for a review of what’s being proposed, which parts are good and which might need work, and how that fits into the historical context.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">zoning</div>
                <div class="quarto-category">Vancouver</div>
                <div class="quarto-category">Transportation</div>
                <div class="quarto-category">affordability</div>
                <div class="quarto-category">density</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jens von Bergmann </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              MountainMath
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Nathan Lauster </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              UBC, Department of Sociology
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 17, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p style="text-align:center;">
<i>(Joint with Nathan Lauster and cross-posted at <a href="https://homefreesociology.com/2022/05/17/on-broadway/" target="_blank">HomeFreeSociology</a>)</i>
</p>
<p>We have finally found some time to take a closer look at the <a href="https://vancouver.ca/home-property-development/broadway-plan.aspx">Broadway Plan</a>. There are many good things to say about the plan, it adds housing in an amenity and job rich area about to get a new subway line. It promises to not just undo the downzoning the city imposed on parts of the area in the 1970s but enables a bit more housing to make up for lost time.</p>
<p>The plan also tacks heavily against the displacement risk to renters in the established rental apartment areas by both 1) limiting the redevelopment potential in those areas and 2) increasing the strength of tenant relocation and right of return policies, a hard-learned lesson from the redevelopment activity around Metrotown in neighbouring Burnaby. In short, overall there’s a lot to like.</p>
<p>In this post we want to accomplish several somewhat diverse goals</p>
<ol type="1">
<li>Provide some code to improve the data analysis in the plan that uses census data,</li>
<li>Place the Broadway plan more firmly into context of historical zoning changes in that corridor, and</li>
<li>Interrogate the decision to limit development potential in the existing low-density areas, which we have argued in the past <a href="https://doodles.mountainmath.ca/blog/2019/02/21/planned-displacement/">make for ideal sites to concentrate development becaues of their low displacement implications</a>.</li>
</ol>
<section id="the-broadway-corridor" class="level2">
<h2 class="anchored" data-anchor-id="the-broadway-corridor">The Broadway Corridor</h2>
<p>The Broadway Plan document chooses to use census tracts as the basis for census data for the Broadway Plan, and to track changes in the corridor since 2001. This is a fairly coarse geography choice since census tracts are rather large and extend quite a bit beyond the outlined area. Dissemination area data is available for all censuses since 2001 and is much better suited to approximate the corridor. If only data on population, households or dwellings is required, then dissemination block data can give even better estimates.</p>
<p><img src="index_files/figure-html/combind_census_data-1.png" width="768"></p>
<p>We will get different census estimates for the Broadway Corridor depending on which of these we choose. The Census Tract based geography is quite coarse and will likely skew the estimates, the other two are probably better choices. To understand the difference let’s take a quick look at population estimates.</p>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>As we would expect, the number of people in the Broadway Corridor depends on the level of geography we chose to approximate the region, and the differences are noticeable. Close observers will note that in addition to the Broadway Plan area, the CT level includes additional parts of Kitsilano and Olympic Village, while the DA level mostly adds Olympic Village, largely accounting for differences in estimates and the larger jump in DA level post-Olympics. If we want to understand the population in a particular year instead of comparing it on a stable region across years we can do better and approximate the region by using the census geography for just that year instead of resorting to using a harmonized geography.</p>
<p>However, these differences matter less when looking at rates, or at change over time as the following graph on the growth during the inter-census periods between 2001 and 2021 demonstrates.</p>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>These estimates are quite close and indicate that the damage from using a coarse Census Tract based approximation is probably not too large. But the inclusion of Olympic Village, in particular, likely boosts growth estimates in recent years.</p>
</section>
<section id="historical-zoning" class="level2">
<h2 class="anchored" data-anchor-id="historical-zoning">Historical zoning</h2>
<p>Using maps we’ve assembled from archival research for the <a href="https://zoning.sociology.ubc.ca/">Metro Vancouver Zoning Project</a>, we can put together an historical comparison of how zoning along the Broadway Corridor has changed. This won’t catch all the change, and as we’ll discuss in a minute, that’s an important caveat! Nor have we fully back-coded our historical data to match with our most recent data, refining and harmonizing what our zoning codes are actually allowing. But we can still get a glimpse of some of the changes that have occurred just by looking at the maps.</p>
<p>From the start, the Broadway Plan area mixed industrial uses to the North, with Apartment and Commercial districts in the middle (especially along Broadway), and Low-Density Single Family and Duplex Zoning to the South. The overall story emphasizes a history of experimentation with this mix, encouraged by de-industrialization but also constrained by reactionary moves to downzone and pull back, preserving single-family, duplex, and low-rise areas from change.</p>
<p><img src="index_files/figure-html/broadway_zoning_history-1.png" width="768"></p>
<section id="industrial-expansion-and-contraction" class="level3">
<h3 class="anchored" data-anchor-id="industrial-expansion-and-contraction">Industrial Expansion and Contraction</h3>
<p>The biggest visible change probably concerns Industrial zoning. There was an initial expansion, from the <a href="https://bylaws.vancouver.ca/consolidated/3575.PDF">modernization of the zoning by-law in 1956</a> to 1963, when <a href="https://bylaws.vancouver.ca/zoning/zoning-by-law-district-schedule-i-1.pdf">Industrial zoning</a> swept into the formerly residential zone to the NE of Cambie and Broadway. Only Jonathan Rogers Park remained zoned residential, though a few old houses were grandparented in and have now stuck around long enough to be <a href="https://council.vancouver.ca/20220518/documents/pspc1appendixA.PDF#page=61">considered heritage</a>.</p>
<p>After this initial expansion, we can see a gradual contraction of Industrial zones along False Creek. The contraction occurred in line with broader North American trends toward urban de-industrialization. Vancouver was notable mostly for its success in shifting so much former industrial land over to a mixture of residential and commercial use. South False Creek was probably the biggest example of this as a coordinated process along the Broadway Corridor, with the area given its own zone between 1974 and 1976, and supported across multiple levels of government as an experiment in residential mixing (with decidedly <a href="https://vancouver.ca/files/cov/false-creek-south-fact-sheet.pdf#page=3">mixed results</a>). But this area isn’t actually included in Broadway land use planning, so we’ll set it aside. One of the last big industrial areas to turn over to residential in the Broadway land use planning area was an old brewery on the western edge, tucked between 10th and 12th, which became <a href="https://www.arbutuswalkliving.com/">Arbutus Walk</a> in the 1990s.</p>
</section>
<section id="expanding-apartment-options" class="level3">
<h3 class="anchored" data-anchor-id="expanding-apartment-options">Expanding Apartment Options</h3>
<p>Mid-Century planners looked to enable an update and expansion to Vancouver’s increasingly built-out apartment districts after the modernization of the Zoning Code in 1956. This was roughly in line with planner Harland Bartholomew’s expectations that the initial zoning plan would only last for <a href="https://homefreesociology.com/2021/02/04/bartholomews-dot-destiny/">about thirty years</a>. Mid-century planners gradually edged the low-rise apartment RM-3 districts outward through the 1960s and early 1970s. This was coupled with an effort to enable towers as a new built form throughout old RM-3 zones via a change to maximum heights in 1961. Correspondingly, towers began to pop up in Kitsilano, Fairview, and Mount Pleasant.</p>
</section>
<section id="reactionary-downzoning" class="level3">
<h3 class="anchored" data-anchor-id="reactionary-downzoning">Reactionary Downzoning</h3>
<p>The 1970s brought in a new party strongly opposed to the proliferation of these new towers: TEAM. They took over council in 1973, installed a new planner, and began downzoning, especially across Kitsilano and Mount Pleasant, shifting high-rise RM-3 lands down to low-rise RM-4 districts. Only the RM-3 surrounding Granville remained. As a result, many of the old towers built from the mid-1960s to the early 1970s could no longer be re-built today, ranging from the apartment buildings near 2nd &amp; Vine in Kitsilano to the Senior’s Housing built for the Lutheran Church across from City Hall at Yukon &amp; 10th (the latter also featured as Stop Four in our <a href="https://homefreesociology.com/2021/03/05/virtual-vancouver-zoning-tour/">Virtual Zoning Tour</a>). In effect, the reactionary downzoning of the 1970s actively forbid the kinds of heights only now being re-enabled by the Broadway Plan today.</p>
<p>We see the old TEAM’s housing legacy, on the whole, as decidedly mixed; balancing downzoning of denser forms with support for low-rise variety and adding housing to former industrial lands (see <a href="https://viewpointvancouver.ca/2022/01/20/revising-history-with-sam-sullivan-the-team-era/">Gordon Price &amp; Sam Sullivan</a> for a less charitable view). But regardless of the old TEAM’s legacy, if you think we’ve got more than enough housing now, then the newly resurrected <a href="https://dailyhive.com/vancouver/colleen-hardwick-team-mayoral-candidate">TEAM for a Livable Vancouver Party</a> might be for you. If you don’t think we’ve got enough housing today, well… we’d probably have a lot more older and more affordable housing now if we hadn’t downzoned so much of the Broadway Corridor fifty years ago.</p>
<p>Looking forward, we can and should start building the housing we think people will want some thirty years into the future. That’s what the Broadway Plan aims to start enabling. As a reminder, we also want there to be a “some thirty years into the future” for people to live in, which the Broadway Skytrain expansion will help insure to the extent it gets people where they need to go without greenhouse gas emission. And we need people to live near the Skytrain for that to work.</p>
</section>
</section>
<section id="proposed-zoning-changes" class="level2">
<h2 class="anchored" data-anchor-id="proposed-zoning-changes">Proposed zoning changes</h2>
<p>While the plan at this stage does not provide the legal text for zoning changes, it does lay out in some detail how it envisions zoning to change in various areas. These changes are the last point we’ll address.</p>
<section id="conditional-rules" class="level3">
<h3 class="anchored" data-anchor-id="conditional-rules">Conditional rules</h3>
<p>It’s not clear from the plan how much the actual zoning rules will rely on conditional vs outright zoning. And if the plan envisions to rezone the area, or if it’s just left as a guiding document and every single development will require a council decision to move forward like in the Cambie corridor.</p>
<p>For Multiplexes and Townhouses (11.2), as well as Low-rise Apartments (11.3), the proposed rules in <a href="https://council.vancouver.ca/20220518/documents/pspc1appendixA.PDF#page=276">section 11</a> of the Broadway Plan do seem to be sufficiently clear in the density that’s allowed, a clear improvement over general practice in Vancouver to regulate multi-family housing via conditional zoning (or rezoning) only. However, when it comes to Mid to High-Rise Apartments (11.4), Mixed-use High-rise (11.6), Mixed-use Residential (11.7), Office (11.8), Industrial/Employment (11.9), or Transit Integration (11.10) areas no clear guidance on height and FSR is given. Others, like the Mixed-use Low-rise (11.5), while clearly intended for housing purposes refers to existing zoning documents that only allow housing conditionally. This continued over-reliance on conditional zoning and planner discretion in the process will server to further feed into Vancouver’s climate of speculation and developer concentration that planners have fostered for many decades now.</p>
</section>
<section id="inclusionary-zoning" class="level3">
<h3 class="anchored" data-anchor-id="inclusionary-zoning">Inclusionary zoning</h3>
<p>The plan has fairly aggressive inclusionary zoning requirements, which we are guessing have been tested by the housing economics group to ensure that projects are marginally viable. However, there seem to be no contingencies built into the plan to allow for market prices and rents to fall. If that were to happen (an outcome many would welcome), the projects allowed in the plan will most likely become unviable and development will pause until prices climb back up. We believe this is a major shortcoming of the plan. Even if falling market prices and rents aren’t a direct goal of the plan, maybe because of its limited geographic scope, it should be explicitly allowed by the plan. The plan should probably be amended to allow for the possibility of falling prices and rents. It’s worth noting that another way to insure we continue to build through any downturns, of course, might be to <a href="https://www.policynote.ca/financing-public-housing/">get government involved in building</a>, but this, too, remains beyond the Plan.</p>
</section>
</section>
<section id="low-density-areas" class="level2">
<h2 class="anchored" data-anchor-id="low-density-areas">Low density areas</h2>
<p>A final part of the plan worth interrogating is how it deals with the low-density areas within the corridor. These are the remaining areas in yellow in our historical map. We support the move to protect and slow down development in the existing rental apartment areas, but a more balanced approach would offset these protections by <a href="https://doodles.mountainmath.ca/blog/2019/02/21/planned-displacement/">allowing more density in the areas with minimal displacement risk</a>. Even more disappointing is how these zones that allow higher and lower density apartments are delineated. They don’t follow planning patterns like proximity to subway stations, or jobs and amenities. Instead they’re simply based on continuing forward existing exclusionary and fairly arbitrary historic zoning patterns. In that sense they are largely backward-looking rather than forward-looking, baking in exclusionary decisions made by planners long-dead.</p>
<p>Just to illustrate this problem, consider Fairview South - Area C. <img src="images/FSOC.png" class="img-fluid" alt="FSOC"></p>
<p>Planners think the FSOB area just to the north is good for up to 6.5 FSR, with 20 storey towers conditionally allowed on some sites, but the highlighted FSOC areas only allow for a maximum of 6 storeys 2.7 FSR rental buildings. As an example, let’s take a look at the existing built form around the leftmost of the two FSOC areas looking north toward the FSOB.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/FSOC_left2.png" class="img-fluid figure-img"></p>
<figcaption>FSOC map view</figcaption>
</figure>
</div>
<p>We notice that just across from the FSOC area on the north side of 14th Ave there are existing 13 storey buildings. These combine a rental building constructed in 1972 (thanks 1960s upzoning!) with an additional infill rental building <a href="https://cd1-bylaws.vancouver.ca/CD-1(661).pdf">enabled in 2017 via spot-zoning</a>. But now, 50 years and a subway line later, planners think only six storey rental buildings make sense across the street. It’s really hard to interpret this as anything but deference to decisions made by planners many decades ago of where to draw the fairly arbitrary lines delineating higher density from lower density zones, an act that seems more akin to religion than to planning.</p>
</section>
<section id="upshot" class="level2">
<h2 class="anchored" data-anchor-id="upshot">Upshot</h2>
<p>While this post devotes quite a bit of space to what we feel are some of the weak points in the Broadway Plan, overall it is a vast improvement over the status quo. While it can’t undo all the damage done by the downzoning of much of the corridor in the 1970s, it does revert back to allowing buildings that could be built before the downzoning and adds more options. Allowing more people to live in a jobs and amenity rich area close to a new subway line is good.</p>
<p>Protecting existing renters is good too, and we are happy to see that planners are avoiding some of the mistakes that were made in Metrotown.</p>
<p>The plan also takes a cautious step toward more predictable outright zoning, at least for the lower density parts of the plan, which is welcome.</p>
<p>We are hoping that our concerns around the ability to dynamically adapt inclusionary requirements to changing market conditions can be incorporated at the bylaw stage of the plan, planners should include contingencies that allow for falling market prices or rents.</p>
<p>Our concerns about low-density areas, and how the delineation between planning areas are chosen, are painful reminders of how planning can become too focused on historical (right or wrong) paradigms and stay disconnected from the physical and economic realities. Hopefully the Vancouver Plan can do a better job at re-imagining our city from a forward-pointing rather than backward-looking perspective, and undo some of the arbitrary zoning divisions in the current Broadway Plan.</p>
<p>To sum up, one thing the Broadway Plan does well is tack against exclusions of existing renters by “the invisible hand of the market.” One improvement would be to also tack against “the invisible hand of planners past,” keeping our eyes more firmly fixed on securing a more inclusive future.</p>
<p>As usual, the code for this post is <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2022-05-17-on-broadway/index.Rmarkdown">available on GitHub</a> for anyone to replicate or adapt for their own purposes.</p>
<details>
<summary>
Reproducibility receipt
</summary>
<pre><code>## [1] "2022-05-17 13:45:38 PDT"</code></pre>
<pre><code>## Local:    master /Users/jens/Documents/R/mountaindoodles
## Remote:   master @ origin (https://github.com/mountainMath/doodles.git)
## Head:     [14741e8] 2022-05-17: broadway post</code></pre>
<pre><code>## R version 4.2.0 (2022-04-22)
## Platform: aarch64-apple-darwin20 (64-bit)
## Running under: macOS Monterey 12.3.1
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] mountainmathHelpers_0.1.4 sf_1.0-7                 
##  [3] tongfen_0.3.5             cancensus_0.5.1          
##  [5] forcats_0.5.1             stringr_1.4.0            
##  [7] dplyr_1.0.8               purrr_0.3.4              
##  [9] readr_2.1.2               tidyr_1.2.0              
## [11] tibble_3.1.7              ggplot2_3.3.6            
## [13] tidyverse_1.3.1          
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.8.3       lubridate_1.8.0    class_7.3-20       assertthat_0.2.1  
##  [5] digest_0.6.29      utf8_1.2.2         R6_2.5.1           cellranger_1.1.0  
##  [9] backports_1.4.1    reprex_2.0.1       e1071_1.7-9        evaluate_0.15     
## [13] httr_1.4.2         blogdown_1.9       pillar_1.7.0       rlang_1.0.2       
## [17] readxl_1.4.0       rstudioapi_0.13    jquerylib_0.1.4    rmarkdown_2.13    
## [21] munsell_0.5.0      proxy_0.4-26       broom_0.8.0        compiler_4.2.0    
## [25] modelr_0.1.8       xfun_0.30          pkgconfig_2.0.3    htmltools_0.5.2   
## [29] tidyselect_1.1.2   bookdown_0.26      fansi_1.0.3        crayon_1.5.1      
## [33] tzdb_0.3.0         dbplyr_2.1.1       withr_2.5.0        grid_4.2.0        
## [37] jsonlite_1.8.0     gtable_0.3.0       lifecycle_1.0.1    DBI_1.1.2         
## [41] git2r_0.30.1       magrittr_2.0.3     units_0.8-0        scales_1.2.0      
## [45] KernSmooth_2.23-20 cli_3.3.0          stringi_1.7.6      fs_1.5.2          
## [49] xml2_1.3.3         bslib_0.3.1        ellipsis_0.3.2     generics_0.1.2    
## [53] vctrs_0.4.1        tools_4.2.0        glue_1.6.2         hms_1.1.1         
## [57] fastmap_1.1.0      yaml_2.3.5         colorspace_2.0-3   classInt_0.4-3    
## [61] rvest_1.0.2        knitr_1.38         haven_2.5.0        sass_0.4.1</code></pre>
</details>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2022,
  author = {von Bergmann, Jens and Lauster, Nathan},
  title = {On {Broadway}},
  date = {2022-05-17},
  url = {https://doodletest.netlify.app/posts/2022-05-17-on-broadway},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2022" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von, and Nathan Lauster. 2022. <span>“On
Broadway.”</span> <em>MountanDoodles</em> (blog). May 17, 2022. <a href="https://doodletest.netlify.app/posts/2022-05-17-on-broadway">https://doodletest.netlify.app/posts/2022-05-17-on-broadway</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodletest\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>