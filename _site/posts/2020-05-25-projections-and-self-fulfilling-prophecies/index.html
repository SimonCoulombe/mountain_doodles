<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="author" content="Nathan Lauster">
<meta name="dcterms.date" content="2020-05-25">
<meta name="description" content="Housing and population growth are endogenous in high-demand areas. Which gives cities the tools to exclude people, but should they? Deciding how to grow is a values question, not a technocratic one.">

<title>Mountain Doodles - Projections and self-fulfilling prophecies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/plain" cookie-consent="tracking">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Mountain Doodles - Projections and self-fulfilling prophecies">
<meta property="og:description" content="Housing and population growth are endogenous in high-demand areas. Which gives cities the tools to exclude people, but should they? Deciding how to grow is a values question, not a technocratic one.">
<meta property="og:image" content="https://doodletest.netlify.app/posts/2020-05-25-projections-and-self-fulfilling-prophecies/index_files/figure-html/cov-vs-metro-pop-growth-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1536">
<meta name="twitter:title" content="Mountain Doodles - Projections and self-fulfilling prophecies">
<meta name="twitter:description" content="Housing and population growth are endogenous in high-demand areas. Which gives cities the tools to exclude people, but should they? Deciding how to grow is a values question, not a technocratic one.">
<meta name="twitter:image" content="https://doodletest.netlify.app/posts/2020-05-25-projections-and-self-fulfilling-prophecies/index_files/figure-html/cov-vs-metro-pop-growth-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1536">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountaindoodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Projections and self-fulfilling prophecies</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Projections and self-fulfilling prophecies</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountaindoodles/blob/main/posts/2020-05-25-projections-and-self-fulfilling-prophecies/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          Housing and population growth are endogenous in high-demand areas. Which gives cities the tools to exclude people, but should they? Deciding how to grow is a values question, not a technocratic one.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">cancensus</div>
                <div class="quarto-category">cmhc</div>
                <div class="quarto-category">Vancouver</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jens von Bergmann </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              MountainMath
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Nathan Lauster </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              UBC, Department of Sociology
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 25, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p style="text-align:center;">
<i>(Joint with Nathan Lauster and cross-posted at <a href="https://homefreesociology.com/2020/05/25/projections-and-self-fulfilling-prophecies/" target="_blank">HomeFreeSociology</a>)</i>
</p>
<p>When people want to live in your city, how many should you let in? On the one hand, this is a moral question. Do you have an obligation to people who don’t already live here? On the other hand, it’s a moot question. At least in Canada, cities don’t have the power to control migration.</p>
<p>BUT WAIT! Cities DO have power over how many new dwellings to allow. This actually changes our moral question a bit. Cities can’t keep people out, but because they have power over dwellings, municipalities can control how many people get to remain in. As a result, if you don’t allow any new dwellings when people want to live in your city then rich people will generally outbid poor people for the housing that’s left.</p>
<p>It may be the case that municipal politicians are fine with rich folk replacing the poor folk in their cities while their own housing rapidly appreciates in price. Why let any new housing get built? “No thanks, we’re full!” But they can’t always SAY this. Especially in cities full of renters that generally support progressive and inclusive values.</p>
<p>So what to do? Two paths are readily available. One: transform the moral question (“isn’t it terrible that developers make money off building housing?”) Two: turn the moral question into a narrow technocratic one instead. Let’s explore this latter option a bit more, because it’s really interesting and sits well within our wheelhouse (mathematician and demographer).</p>
<p>Here in the City of Vancouver, a new motion was just launched, titled <a href="https://council.vancouver.ca/20200527/documents/pspc4.pdf">Recalibrating the Vancouver Housing Strategy</a> (RVHS). There are some good initiatives in this motion, but the main thrust and motivation is to turn the moral question of how many people get to remain in Vancouver into the narrow technocratic question of how do we forecast population growth? As any demographer can tell you, this can be tricky, especially when it comes to forecasting for municipalities. But there’s a naive kind of work-around some people use when they don’t follow demographic techniques and concerns very closely and don’t want to think too hard about the question at hand. They simply turn the population forecast into a projection forward from how a city grew in the past.</p>
<p>This is a neat trick! Especially if you’re in a city that’s limited new dwellings in the past and thereby kept its population growth to a minimum and you want to keep it that way. “The evidence suggests we haven’t been growing very fast, so we shouldn’t add much more housing.” With a little bit of hand-waving, the number of dwellings allowed by the city is reimagined as something that can be tailored to meet the forecast rather than the central determinative factor of the forecast.</p>
<p>Is this the kind of thing that could happen in Vancouver? Before we get into the motion, let’s just quickly look at Vancouver’s recent past. We know prices and rents rose rapidly through 2016 (and beyond), which is pretty good evidence that we didn’t add enough housing for the people who wanted to live here all by itself. But how did the City of Vancouver grow relative to the rest of the region? It grew more slowly. (“No thanks! We’re full!”) Did we lose poor people and replace them with rich people as a result? Yap, this is <a href="https://doodles.mountainmath.ca/blog/2017/09/26/evolution-of-the-income-distribution/">exactly what has happend in the City of Vancouver, which has lost lower and middle income people, and gained high-income people, at a faster pace than the surrounding Metro area.</a></p>
<p><img src="../../posts/2017-09-26-evolution-of-the-income-distribution/index_files/figure-html/2005-2015_rel_change-1.png" class="img-fluid"></p>
<section id="the-motion" class="level2">
<h2 class="anchored" data-anchor-id="the-motion">The Motion</h2>
<p>Now let’s get back to that RVHS motion, starting with <a href="https://council.vancouver.ca/20200527/documents/pspc4.pdf#page=2">part A</a>:</p>
<blockquote class="blockquote">
<p>THAT Council direct staff to revisit the Housing Vancouver Strategy targets to align with historical and projected population growth based on census data.</p>
</blockquote>
<p>This is a vague statement. There are, of course, many ways to “align” something (Dungeons and Dragons fans may be immediately reminded of the nine different alignments readily found therein). There are also many ways to project population growth. These often rely upon multiple sources of data. Birth rates, death rates, age structure, labour market statistics, and net migration rates serve as typical baseline sources of information for demographers, and are usually gathered from all manner of data (e.g.&nbsp;vital statistics, surveys, policy-based immigration projections, etc.) rather than simply historical census data. So how is the author of this particular motion imagining more specific alignments and projections? The answer can probably be found in the <em>WHEREAS</em> <a href="https://council.vancouver.ca/20200527/documents/pspc4.pdf">sections 4 and 5</a>:</p>
<blockquote class="blockquote">
<p>Population growth has been consistent at approximately 1% per annum over the past 20 years according to Statistics Canada census data. Based on this historical trend, a similar growth rate for the coming decade would amount to a population increase of around 66,000. In the City of Vancouver, the average household size is 2.2 individuals per dwelling unit (or “home”);</p>
</blockquote>
<blockquote class="blockquote">
<p>The target of 72,000 new homes across Vancouver in the next 10 years multiplied by 2.2 would mean a population increase of 158,400 - more than twice the historical rate. A projected historical rate of population growth would imply instead a need for roughly 30,000 new housing units over the coming decade;</p>
</blockquote>
<p>We’ve left the refined techniques of demography behind here, as well as the determinative forces of births, deaths, and moves. Indeed, people pretty much disappear and their dwellings get only scare-quotes as <em>homes</em>. But let’s follow the math we do get and try and understand what projecting past trends means in terms of numbers (leaving aside if we agree that things went splendid and we should just keep going the same way). Let’s try and reproduce the estimation of new housing units assuming we hold the 20 year trends in the two mentioned metrics, population and household size, constant.</p>
<p>The 1% annual growth rate roughly checks out, although there have been variations.</p>
<p><img src="index_files/figure-html/cov-vs-metro-pop-growth-1.png" width="768"></p>
<p>And population in the City has grown consistently at a lower rate than overall Metro Vancouver population. In fact, if the City of Vancouver had grown at the same rate as Metro Vancouver over those 20 years, Vancouver would have had roughly 60,000 more people within city limits in 2016. But maybe people would just rather live farther out in the surrounding suburbs? Again, there are variations, but overall that is not what the price and rent data tell us.</p>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>People want to live in Vancouver. But they often settle for living farther out, based on the specifics of what they want and can afford. The competition for the limited number of dwellings in Vancouver drives up prices here relative to surrounding municipalities.</p>
<p>So what to make of the close relationship between population growth and dwelling units added? It’s a real relationship.</p>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<p>The motion, as presented, seems to suggest that this close relationship is evidence that we’re projecting population growth really well, thereby allowing almost perfectly enough new housing to meet population needs. Is this what we’re doing? Well, no. In fact, the amount of new housing allowed sets a cap on population growth that can only be exceeded by increasing household size (which in many cases cities have also made illegal)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> or decreasing the number of empty dwellings.</p>
<p>There is broad support for decreasing the number of empty dwellings, and both the City of Vancouver and the Province of British Columbia have put in place taxes on vacant properties and their owners to do just that. Have they succeeded? Quite possibly! But compared to other municipalities, Vancouver’s vacancies (as recorded in the Census) <a href="https://homefreesociology.com/2019/08/19/running-on-empties/">looked relatively normal</a> prior to the new taxes, despite persistent rumours of some <a href="https://doodles.mountainmath.ca/blog/2020/01/27/mythical-oversupply/">mythical oversupply</a>. After the new taxes, <a href="https://vancouver.ca/files/cov/empty-homes-tax-annual-report.pdf#page=5">administrative</a> <a href="https://news.gov.bc.ca/files/SVT_Consultation_All.pdf#page=84">data</a> reveals there aren’t many taxable units left vacant at all (~1%).</p>
<p>What about household size? The motion suggests imposing a constant for Vancouver, expecting 2.2 people per household. But household size is not staying constant. It’s <a href="https://www150.statcan.gc.ca/n1/pub/11-630-x/11-630-x2015008-eng.htm">falling all across Canada</a>, due to a combination of forces (aging of the population, declining childbearing, changes in partnership, the rise of people living alone). We also know that as people get richer, they tend to occupy more space. And, as pointed out above, Vancouver’s been getting richer.</p>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>As we see, household size in the City of Vancouver has continuously declined over the years, a trend that has significant impact on the relationship between housing and population growth. Sticking with the bad assumption that past population growth should be predictive of future housing needs, we can see that we’re still going to need more housing per person than in the past. Projecting these trends forward, lazily anchored at the 2016 census data, gives an increase in population in private households of about 67,000 and a corresponding increase in 41,000 households (aka occupied dwelling units). And that is not yet accounting for the increase in population in non-private households that Vancouver has experienced, like retirement homes or similar institutional housing.</p>
<p>So if the RVHS motion points us toward a bad way to do population projections, then how should one do it? There are lots of models to look at, but given that people want to live in Vancouver, a key ingredient in any model should be how much housing will be allowed. Conditional on allowing a given amount of housing, we can attempt to forecast how many people will come. But this moves us back from narrow technical questions (which we’re more than happy to continue exploring in depth!) toward the central moral question at hand. How many people are we comfortable allowing to live in Vancouver? Because if we allow more housing, more people will come. And if we allow more housing, we’ll also allow more of those currently at risk of feeling unwanted in Vancouver to stay.</p>
<p>That begs the question: <strong>What would be the problem with allowing more housing?</strong> The last <em>WHEREAS</em> of the RVHS motion holds an answer to that.</p>
<blockquote class="blockquote">
<p>A revised and more accurate understanding of demographic needs and demand will assist in properly planning for the post COVID-19 reality. Setting excessively high targets will pressure the City of Vancouver to grant significant amounts of density at a low price, in an attempt to induce housing construction approaching the HVS targets. This will cost the City of Vancouver potential revenue, and will mean that the City abandons its commitment to having growth pay for itself.</p>
</blockquote>
<p>In short, housing might get cheaper. Which incidentally is quite in line the goals of the Vancouver Housing Strategy.</p>
<p>But there are a couple things here that need a bit more unpacking. First, from the title throughout the motion and showing up here again are mentions of planning for a “post COVID-19 reality.” To put it bluntly, this is odd. These parts of the motion caution us against assuming what comes next will reflect what came before. But, as discussed above, this is exactly the assumption the rest of the motion says we should make, resting as it does upon a very selective reading of Vancouver’s recent population growth. Weird contradiction. But then again, pretty much the same language <a href="https://vancouversun.com/opinion/op-ed/elizabeth-murphy-vancouver-growth-targets-dont-add-up/">has been employed way before COVID-19 was on anyone’s radar</a>, suggesting that COVID-19 has just been tacked on for extra effect.</p>
<p>Second, the notion that “growth pay for itself” sounds quite reasonable, but it’s not clear what that means in practice. In Vancouver, new housing projects pay a variety of municipal fees, DCLs, CACs and additional engineering fees upfront, and annual property taxes thereafter. How much of the overall cost of living in the city should be charged upfront, and how much should be charged over the lifetime of the housing as property taxes? That’s a political question that Vancouver should have a discussion on.</p>
<p>Charging high entry fees keeps prices high, not just of new housing but of all housing. It <strong>encourages treating housing as an investment</strong>, with low holding costs (property taxes) and high barriers to increasing housing even as population pressures keep prices and rents rising.</p>
<p>Charging a lower entry tax and collecting a higher portion as property taxes later can lower the entry point to housing and spreads the costs out over the lifetime of the dwelling unit. This <strong>treats housing as a place to live</strong>, lowering the barriers to new housing construction and asking people to pay for city services and amenities over their time living in the city.</p>
</section>
<section id="the-sort-of-good-parts-of-the-motion" class="level2">
<h2 class="anchored" data-anchor-id="the-sort-of-good-parts-of-the-motion">The (sort of) good parts of the motion</h2>
<p>Let’s end with a few bright notes. There are some good parts to the motion! We like data and Part B asks:</p>
<blockquote class="blockquote">
<p>THAT Council direct staff to provide annual historical data since 2000 on the number of units approved through rezoning, the breakdown of housing types that have been approved, housing starts and net housing completions, and estimated zoned capacity for the City of Vancouver.</p>
</blockquote>
<p>This part of the motion is asking for better data, but it needs refinement. As it is right now it is hard to see what it will accomplish.</p>
<p><strong>Number of units approved through rezoning</strong> is hard to interpret unless it is accompanied by more detail on how many of these units actually got built. Take the approved first version of the Oakridge development for example. A massive number of units got approved, yet the project died when drilling found an aquifer that precluded the project from going forward as approved. Several years later, a different proposal got approved, for the data on approvals to be useful we need to know what happened to those units.</p>
<p>Monthly data on <strong>housing starts</strong> is already easily available, asking the data be reproduced adds zero value and amounts to a waste of staff time.</p>
<p><strong>Net housing completions</strong> is an important number, but very hard to do in Vancouver, given our high reliance on informal housing. It is still worthwhile to try and approximate this, but the motion should be clearer what part staff should focus on beyond the data on completions, demolitions and secondary suite estimates that we already have.</p>
<p><strong>Estimates of zoned capacity</strong> is a great stat to get clarity on. Some vague estimate has been making the rounds for a while after surfacing in a consultant report, with next to no detail how it was derived. Having an estimate with a clear methodology would be a great addition to inform Vancouver housing policies.</p>
<p>Part B is a good and simple ask:</p>
<blockquote class="blockquote">
<p>THAT Council direct staff to clarify whether the Vancouver Housing Strategy targets refer to net housing completions or gross housing completions.</p>
</blockquote>
<p>Part E is mostly redundant:</p>
<blockquote class="blockquote">
<p>THAT Council direct staff to provide detailed inventory data through the Open Data Portal4 of housing starts, development projects anticipated in the pipeline (including form and type of units), and existing zoned capacity (disaggregated by local area) to inform this work.</p>
</blockquote>
<p>The open data portal already has detailed information on housing units in the pipeline. The information could be improved, but this ask is useless unless it specified how. As mentioned before, detailed information on housing starts is already easily available as open data, monthly stats by structural type and intended market, down to the census tract level. It is less helpful than the other parts above and risks directing staff resources away from other project just to replicate what’s already out there.</p>
</section>
<section id="bottom-line" class="level2">
<h2 class="anchored" data-anchor-id="bottom-line">Bottom line</h2>
<p>There’s no way around it. How many dwellings to allow in a city is ultimately a moral question rather than a technocratic one. Given the overwhelming evidence that people want to live in places like Vancouver, population forecasts necessarily reflect first and foremost how many new dwellings we’re willing to allow. In technical terms, it’s silly to imagine we’re meeting the needs of population growth when we’re in fact setting a hard cap on population growth. In moral terms, we come back to the central question: Are we planning for kicking poor people out? Or are we open to inviting more people in?</p>
<p>As usual, the code underlying the stats and graphs is <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2020-05-25-projections-and-self-fulfilling-prophecies.Rmarkdown">available on GitHub</a> for anyone to reproduce or appropriate for their own use. And if you want to read (much) more about how to know if you have enough housing, check our <a href="https://homefreesociology.com/2019/06/12/simple-metrics-for-deciding-if-you-have-enough-housing/">simple metrics post</a>.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>For example the City of of Vancouver only allows at most one kitchen per dwelling unit and limits the number of unrelated individuals sharing a dwelling to 3 (+ 2 boarders or lodgers) to restrict sharing of homes.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2020,
  author = {von Bergmann, Jens and Lauster, Nathan},
  title = {Projections and Self-Fulfilling Prophecies},
  date = {2020-05-25},
  url = {https://doodletest.netlify.app/posts/2020-05-25-projections-and-self-fulfilling-prophecies},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2020" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von, and Nathan Lauster. 2020. <span>“Projections and
Self-Fulfilling Prophecies.”</span> <em>MountanDoodles</em> (blog). May
25, 2020. <a href="https://doodletest.netlify.app/posts/2020-05-25-projections-and-self-fulfilling-prophecies">https://doodletest.netlify.app/posts/2020-05-25-projections-and-self-fulfilling-prophecies</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodletest\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>