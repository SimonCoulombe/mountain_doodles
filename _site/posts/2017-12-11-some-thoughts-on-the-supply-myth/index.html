<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="dcterms.date" content="2017-12-11">
<meta name="description" content="The never ending discussion.">

<title>Mountain Doodles - Some Thoughts on the “Supply Myth”</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/plain" cookie-consent="tracking">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Mountain Doodles - Some Thoughts on the “Supply Myth”">
<meta property="og:description" content="The never ending discussion.">
<meta property="og:image" content="https://doodletest.netlify.app/posts/2017-12-11-some-thoughts-on-the-supply-myth/index_files/figure-html/sd_duplex-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1728">
<meta name="twitter:title" content="Mountain Doodles - Some Thoughts on the “Supply Myth”">
<meta name="twitter:description" content="The never ending discussion.">
<meta name="twitter:image" content="https://doodletest.netlify.app/posts/2017-12-11-some-thoughts-on-the-supply-myth/index_files/figure-html/sd_duplex-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1728">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountaindoodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Some Thoughts on the “Supply Myth”</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Some Thoughts on the “Supply Myth”</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountaindoodles/blob/main/posts/2017-12-11-some-thoughts-on-the-supply-myth/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          The never ending discussion.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">cancensus</div>
                <div class="quarto-category">CensusMapper</div>
                <div class="quarto-category">cmhc</div>
                <div class="quarto-category">Vancouver</div>
                <div class="quarto-category">Empty Homes</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jens von Bergmann </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 11, 2017</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Smarter people than I have already responded to the recent furor about <a href="http://www.kpu.ca/sites/default/files/The%20Housing%20Supply%20Myth%20Report%20John%20Rose.pdf">John Rose’s working paper</a>, which is (part of?) the result of one year of research on affordability by the author, arguing that Vancouver has no supply problem. Most notably Nathan Lauster in a series of blog posts <a href="https://homefreesociology.wordpress.com/2017/11/29/notes-on-the-myth-of-housing-supply/">taking a look at the theoretical framework and methods used</a> and <a href="https://homefreesociology.wordpress.com/2017/11/30/overbuilding-vs-undercounting/">running some numbers himself</a>. I don’t have much to add to the first post, which took the time to highlight some of the useful demand measures that are either already implemented or currently under discussion and makes the point that the idea that we have enough housing in Vancouver, especially enough rental housing, requires an extraordinarily strong argument in the face of sub 1% rental vacancy rates. And the arguments made were weak at best.</p>
<p>The second post digs into some of the census data issues that the working paper had, and introduces construction and demolition data as another measure to contrast and contextualize changes in the census methods, which is interesting. It seems that in the evening blog post writing some of the numbers may have gotten mixed up, which should not distract from the larger critique presented.</p>
<p>In this post I would like to,</p>
<ol type="1">
<li>add some thoughts on “supply”,</li>
<li>put this discussion on a reproducible and transparent footing by providing the code to (re-) produce the results of the working paper,</li>
<li>expand on Lauster’s work on comparing census with completions data, and</li>
<li>digging a bit deeper into the effects of the change in dwelling enumeration between 2001 and 2006.</li>
</ol>
<section id="supply" class="level1">
<h1>Supply</h1>
<p>In the context of housing supply is a word that is stretched quite far these days, denoting anything between the classical economics</p>
<blockquote class="blockquote">
<p>A supply of something is an amount of it which someone has or which is available for them to use. <a href="https://www.collinsdictionary.com/dictionary/english/supply">Oxford English Dictionary</a></p>
</blockquote>
<p>to just meaning an existing (or sometimes an under construction or just permitted) housing unit.</p>
<p>The economics definition is useful because it is clearly defined and there is a strong relationship between the supply-demand balance and prices, on the ownership as well as the rental market.</p>
<section id="ownership" class="level3">
<h3 class="anchored" data-anchor-id="ownership">Ownership</h3>
<p>For the ownership market in Vancouver the interplay of the supply-demand balance with prices has been expertly visualized by <a href="https://twitter.com/YVRHousing">YVR Housing Analyst</a> and is summarized in this tweet</p>
<p><img src="images/yvrhousing_moi.png" class="img-fluid" alt="YVRHousing"> <!--tweet 940663306511048705--></p>
<p>and <a href="http://housing-analysis.blogspot.ca/2017/04/vancouver-teranet-hpi-and-inventory.html">a blog post</a>. The upshot is that price change is driven by months of inventory. (And yes, this is more than just a correlation.)</p>
</section>
<section id="rental-market" class="level3">
<h3 class="anchored" data-anchor-id="rental-market">Rental Market</h3>
<p>I don’t have quite as clean an analysis to offer for the renter market, partially because I only have annual vacancy rate data. But here too we can observe the interplay between supply-demand, measured by the vacancy rate, and year-over-year (nominal) fixed-sample rent increases.</p>
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" width="864"></p>
<p>Here we can clearly see how vacancy rates drive fixed-sample rent increases.</p>
</section>
<section id="supply-in-the-working-paper" class="level2">
<h2 class="anchored" data-anchor-id="supply-in-the-working-paper">Supply in the Working Paper</h2>
<p>The working paper indirectly defines “supply” as a housing unit that is not used as a primary residence. So a housing unit that is for sale and empty, for rent and empty, occupied temporarily by someone (e.g.&nbsp;a student who thinks of their parent’s place as their permanent residence), a vacation property or a unit left empty for shorter periods of time (in between moving) or for longer periods of time, or a newly constructed housing unit that has not been moved in yet. It excludes units for sale if someone still lives in them.</p>
<p>This somewhat unorthodox definition of supply is then put in relation to “affordability” for aspiring owner households, that is the change in home prices. I am not sure that’s a particularly useful way to to approach this. The working paper then looks at the change in “supply” between 2001 and 2016 and the change in “affordability” between these years. The author notes that Vancouver registers as both, strong in increase of “supply” and strong decrease in “affordability”, and concludes that this provides proof against calls for adding “supply” (which in context of this conclusion seems to be re-defined more generally as “housing units”) to aid “affordability”.</p>
</section>
<section id="dwellings-not-occupied-by-usual-residents" class="level2">
<h2 class="anchored" data-anchor-id="dwellings-not-occupied-by-usual-residents">Dwellings, not occupied by usual residents</h2>
<p>This is again all about the evergreen topic of <a href="https://censusmapper.ca/maps/584">private dwellings, not occupied by usual residents</a> that many people, <a href="https://urbanarium.org/city-debate-7-vacancy-tax-will-work-video">including myself</a>, have talked about over the years. Vancouver does have a somewhat elevated rate of these dwelling units, and there are several good measures underway to incentivize a better use of the existing stock. The City of Vancouver has enacted the Empty Homes Tax, and the province is (hopefully?) still mulling over including the <a href="http://www.housingaffordability.org">BC Housing Affordability Fund</a> into it’s upcoming provincial budget.</p>
<p>That said, the rate of private dwelling units that are not occupied by usual residents (or non-primary residences for short) can’t be pushed down to zero. There will always be a base vacancy rate just for moving friction, similar to the unemployment rate or the job vacancy rate never hitting zero. Then there will always be “temporary” residents, with temporary foreign workers and students listing their parent’s residence (or not sticking around for the census after the end of the semester) being examples. Getting a third of these units into use as primary residences would be a worthwhile, yet ambitious goal.</p>
</section>
<section id="why-do-we-add-dwellings" class="level2">
<h2 class="anchored" data-anchor-id="why-do-we-add-dwellings">Why do we add dwellings?</h2>
<p>The author also seems to suggest that the only reason to add dwelling units is to lower prices. While adding dwelling units will under (almost) all realistic conditions lower prices (at least in the sub market in which they are added), that certainly is not the only reason to add dwelling units. Adding dwellings is first and foremost about accommodating people.</p>
<p>There are many people that want to live in our region, some that are currently living here and that have a hard time to find a place to rent, some that want to move here but can’t find adequate housing options. With the rental vacancy rate now for many years below 1% in the region, and a record job vacancy rate that climbed to 4% in the past quarter, the pressure on the existing stock is building. And it’s the lower income people that tend to get pushed out when the higher income people compete for the same stock. As the centre of the region, the City of Vancouver is feeling the strongest pressure, and we have seen how <a href="https://doodles.mountainmath.ca/blog/2017/09/26/evolution-of-the-income-distribution/">low income people get pushed out of the city and people pile on in the top income bracket</a> between the past three censuses. In that time the City of Vancouver has overtaken the City of Toronto in terms of incomes <a href="https://doodles.mountainmath.ca/blog/2017/11/01/medians/">if measured apples-to-apples</a>. The rest of Metro Vancouver has not yet seen that strong of a reaction in the data, but as housing prices and rent increases ripple outward through the region the pressure is building everywhere.</p>
</section>
</section>
<section id="reproducible-and-transparent-numbers" class="level1">
<h1>Reproducible and Transparent Numbers</h1>
<p>The other issue with the paper is the data. We all know that affordability has gotten worse in Vancouver, and the last thing we need is yet another faulty metric to show this. The main metric being used by Rose is net new dwellings by net new households between 2001 and 2016 for several Canadian CMAS. I have a couple of questions about the metric. Why start in 2001 and not, say 1996 or 2006? Why focus on private households and not e.g.&nbsp;family units? After all <a href="https://doodles.mountainmath.ca/blog/2017/12/01/what-s-a-household/">households can be quite complex</a>, especially in Vancouver and Toronto that have high rates of certain types of “advanced roommate” type households and saw the share of adult children living with their parents growing. And why choose “private dwellings occupied by usual residents” (aka private households) instead of “occupied private dwellings”? It is not clear to me why a dwelling unit that’s occupied by a temporary worker should be treated the same way as an empty unit. Or a private dwelling unit that was occupied by one or several students that stuck around until the census after the end of the semester but still think of their parent’s house as their “permanent” residence.</p>
<p>So let’s run the numbers. Unfortunately I don’t have 2001 numbers in CensusMapper, but it’s easy enough to pull the data for the 20 most populous (using 2016 population numbers) CMAs for 2001 and 2016 and perform two subtractions and one division. In the interest of transparency and reproducibility, the code for all graphs is included in the R Notebook that built this post and <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2017-12-11-some-thoughts-on-the-supply-myth.Rmarkdown">lives on GitHub</a> as regular readers probably already guessed.</p>
<p><img src="index_files/figure-html/dw_per_hh_mixed_geos-1.png" width="864"></p>
</section>
<section id="changing-metrics" class="level1">
<h1>Changing metrics</h1>
<p>While it was easy to compute it, the metric itself has two big issues. Nathan Lauster already pointed out one of them, that the <a href="http://www12.statcan.gc.ca/census-recensement/2006/ref/rp-guides/housing-logement-eng.cfm#comparability">census changed the way it counted dwelling units between 2001 and 2006</a>, with the net effect of discovering suites. That adds to the count of dwelling units in 2006 compared to 2001 without new dwellings being produced. At the same time the census would also discover more households, in this case occupied suites, that were already present in 2001 but not counted then. In order to say that this change does not bias the analysis one would have to argue that suites are just as likely to be occupied by usual residents as other building types, which is probably not true. We will dig deeper into this question toward the end of the post.</p>
<p>In the meantime it would probably be prudent to add in data for the intermediate years 2006 and 2011 to see how this plays out over the years. One would expect the effect of the change in methods to be bigger in metropolitan areas with more suites, like in Vancouver.</p>
<p><img src="index_files/figure-html/uo_mixed_geos2-1.png" width="864"></p>
<p>Here we see, as Nathan Lauster already pointed out, that the majority of the change in non-primary residence private dwellings in Vancouver (and some other regions) occurred between 2001 and 2006. Showing the change by using “net new dwellings by net new households” emphasizes that. But we prefer to show things this way, which brings us to the next issue with the metric used in the working paper.</p>
</section>
<section id="changing-cmas" class="level1">
<h1>Changing CMAs</h1>
<p>The other problem with the comparison is that for many CMAs the difference in the count of dwelling units (or of households) is not the same thing as “net new dwellings”. That’s because CMAs aren’t monolithic things that exist through time, they change. CMA boundaries can get adjusted between censuses, and many of the listed CMAs have. Which makes it hard to make sense out of what these numbers actually mean. Comparing across census years is hard <a href="https://doodles.mountainmath.ca/blog/2017/03/22/comparing-censuses/">as we have explained in detail before</a> and typically requires a lot more work than just a little arithmetic with a couple of numbers. For example, the population within Montréal’s 2016 CMA boundaries grew by 4.2% between 2011 and 2016, but if we naively take the populations in the 2016 CMA boundaries in 2016 and compare it to the population in the 2011 CMA boundaries in 2011 we would think it grew by 7.2%.</p>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="864"></p>
<p>We don’t have 2001 data in CensusMapper, which makes it a little more work to pull the proper numbers for all CMAs than we are willing to put in for an evening blog post. But we chose London CMA because of it’s simplicity to work out the effect of using proper boundaries on the metric from Rose’s working paper.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">CMA / Method</th>
<th style="text-align: right;">Net New Dwellings per Net New Household</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">London 2011 boundaries</td>
<td style="text-align: right;">1.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">London mixing boundaries</td>
<td style="text-align: right;">1.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">London 2016 boundaries</td>
<td style="text-align: right;">1.11</td>
</tr>
</tbody>
</table>
<p>The difference is not large, but noticeable. It is not clear to me how this will play out in some of the other regions, but one should probably work this out in detail if one wanted to do this properly.</p>
</section>
<section id="median-multiples" class="level1">
<h1>Median Multiples</h1>
<p>While we are at it, we should probably also look at the “affordability” metric that was used. Median multiples is probably my least favourite among the affordability metrics, but it somehow won’t die. The metric can have some value, but there are lots of issues when using it to compare across regions or time. Among the issues is that household composition <a href="https://doodles.mountainmath.ca/blog/2017/11/01/medians/">can significantly skew the metric</a>, that it is taken at the ecological level and can point in the opposite direction as individual level metrics <a href="https://doodles.mountainmath.ca/blog/2017/10/26/a-first-look-at-vancouver-housing-data/">like we have shown happened in Vancouver</a>, that it ignores tenant households and differences in the share of tenant households, and many more. If one insists on this kind of metric I think family income is probably better suites than household income. It might also make sense to view renter and owner households separately and use separate income numbers for these.</p>
<p>It took a bit of debugging to figure out that the working paper used the average owner-occupied dwelling values by median household incomes as a metric as opposed to average dwelling value by average incomes as it claimed. The metric is a little funky, but here are the results and the code to reproduce it for added transparency so that the next person doesn’t have to go around guessing at how things are computed. In the working paper this was compared against data from Demographia (can’t believe people actually use that data for things other than click bait), so we decided to lend a helping hand and add in the consistent metric for 2016. And we threw in the intermediate years too for added context.</p>
<p><img src="index_files/figure-html/med_multiple-1.png" width="864"></p>
<p>It’s very clear that Vancouver stands out, and we have seen countless graphs of this type before. The changing CMA boundaries over time is much less of an issue for this graph, it could even be considered a feature and not a bug. Growing the CMA will typically deliver an affordability boost as more outlying municipalities tend to have less expensive housing. But metropolitan boundaries are derived from commuting patterns, so it properly adjusts the metropolitan area to the given context each census year (or with a 5 year lag). As a footnote, Metro Vancouver is at a disadvantage here as the existence of the Abbotsford-Mission CMA directly to the east prevents it from growing. We will leave the details of this for another post.</p>
<p>Using more appropriate measure like family income or owner household income will soften the growth in the multiples metric somewhat, as will using median dwelling values instead of averages. For example, just using median multiples <a href="https://censusmapper.ca/maps/897">pegs Vancouver at a ratio of 11 in 2016</a>, using median family incomes to median owner-occupied dwelling values Vancouver <a href="https://censusmapper.ca/maps/944">sits at 8.7</a>. But while the exact ratios depend highly on the metric, the general trends remain the same. Vancouver is an outlier.</p>
</section>
<section id="construction-data" class="level1">
<h1>Construction Data</h1>
<p>One interesting addition of Nathan Lauster that spiked our interest was folding in construction data. In principle that’s a great way to cross check the dwelling growth hypothesis, but we also need demolition data to make this work. And demolition data is in short supply, CANSIM 026-0012 publishes data up to 1999. I seem to remember that i is still collecting that data, but it stopped publishing it due to quality concerns and is thus of little use for our time frame. Lauster took demolition data for the <a href="http://www.metrovancouver.org/services/regional-planning/PlanningPublications/MV_Housing_Data_Book.pdf">Metro Vancouver Housing Data Book</a>.</p>
<p>This is a similar approach as taking in the IMF working paper <a href="https://www.imf.org/external/pubs/ft/wp/2015/wp15128.pdf">Gauging Housing Supply in Canada: A Stock Approach</a> which uses a some more robust methodology for understanding housing stock in relation to households and “excess supply”, which Rose’s working paper may benefit from. In particular the IMF paper takes care to recognize the existence of an “equilibrium or normal vacancy rate” for a given market and “excess occupancy” (or the reverse thereof) that stems from unexpected patterns in household formation, some of which we have <a href="https://doodles.mountainmath.ca/blog/2017/12/01/what-s-a-household/">highlighted earlier</a>.</p>
<p>Let’s first look at City of Vancouver data and see how completions have evolved over time.</p>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>We can average the data over the census periods in question, starting at May in 2001 to April 2016, inclusive. <img src="index_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>We can quickly check how completions have varied across select metro areas and through time.</p>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Next we need to fold in demolitions. For the city of Vancouver we can eyeball the number of demolitions using the Metro Vancouver Housing Databook for the periods of interest. It will be more work to assemble this for other metropolitan areas.</p>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>The difference is the net new dwellings. We should caution that tracking demolitions and additions like suite conversions is hard, so there are quite likely some issue with this kind of data too that are worth exploring further.</p>
<p><img src="index_files/figure-html/net_new-1.png" width="864"></p>
<p>The 2006 to 2016 data is consistent with our suspicion that we are under-counting demolitions, the 2001 to 2006 data is consistent with Nathan Lauster’s observation that the census got a lot better at counting units during that time frame, the census “counted” 18,750 more new units than CMHC minus demolition data did, and chances are good that the gap is bigger if our suspicion is right that we under-count demolitions.</p>
</section>
<section id="single-detached-and-duplex" class="level1">
<h1>Single Detached and Duplex</h1>
<p>To understand better how the change in dwelling enumeration methods has effected the dwelling counts between 2001 and 2006 we can compare the change in single detached and duplex dwelling over the years. First we take a look at the duplex units.</p>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="864"></p>
<p>We can see that the number of duplex units increased significantly in many of the metropolitan areas. As the census reference materials state, this is likely due to homes that were classified as single detached in 2001 being classified as duplexes in 2006. So let’s view this in perspective to single detached homes.</p>
<p><img src="index_files/figure-html/sd_duplex-1.png" width="864"></p>
<p>The number of single family homes has been continuously increasing over the years in all metropolitan areas, with the exception of Vancouver and Victoria. The number of single family homes can increase because of more single family homes getting built, or because the CMA expands between censuses. This decrease in single detached homes in the census counts in Vancouver is well known and generally attributed to the census finding existing suites, so reclassifying a single detached unit as two duplex units, as well as single detached homes being converted to duplexes.</p>
<p>There is a number of variables moving at the same time, so this needs some closer analysis. If we assume for now that all single detached and duplex units are occupied, then the number of single family homes plus half the number of duplex units equals the number of lots with single detached or duplex homes on them.</p>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" width="864"></p>
<p>What we see in Vancouver, and to a lesser extent in Victoria, is that the total number of these lots is decreasing under our assumption. And quite substantially so, by 18,102 in Vancouver and 2,085 in Victoria. There are several possible explanations for this:</p>
<ul>
<li>the number of lots with single detached or duplexes decreased,</li>
<li>the census found homes with more than one suite that will then be classified as “apartment, fewer than five stories”,</li>
<li>there is a big change in units not occupied by usual residents among these,</li>
<li>suites are much more likely to be not occupied by usual residents.</li>
</ul>
<p>It is likely a combinations of all of them, but it seems reasonable to hypothesize that the last option, namely that suites are much more likely to be classified as not occupied by usual residents, is responsible for a bulk of that drop. If it were to account for all of the drop we would have 18,102 suites that are not occupied by usual residents, accounting for almost all of the difference in dwelling growth 2001 to 2006 derived from census vs CMHC construction/demolition data. And this is still ignoring the possibility that the number of lots dedicated to single detached and duplex homes has increased in Metro Vancouver over that time period, which would further narrow the gap.</p>
<p>Another way to cross-check these assumptions is to check how many of these duplex units were owner-occupied vs renter-occupied. In Vancouver duplex units aren’t stratified except maybe in exceptional cases. (What is commonly referred to as “duplex” is classified as “semi-detached” in the census.) That means that we would generally expect at least as many units to be renter-occupied as there are owner-occupied if there was no strong bias for unoccupied suites.</p>
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" width="864"></p>
<p>But of the 112,250 occupied duplex units in Vancouver in 2006 there were 69,115 owner-occupied duplex units and 43,135 tenant-occupied ones. This compares to 28,875 owner-occupied duplex units and 36,730 tenant-occupied ones in 2001. In summary this is strongly suggesting that a very large number of those newly discovered suites were classified as not occupied by usual residents, explaining pretty much all of the gap between CMHC and census dwelling counts, as well as the jump in units not occupied by usual residents.</p>
<p>To erase all doubt, it would be very helpful to have data on the structural type of dwellings that are not occupied by usual residents. In principle that data should be available to StatCan, and I have asked StatCan for it a couple of months ago without success. This probably requires a concerted effort to find out if it is available and obtain it if it is.</p>
</section>
<section id="upshot" class="level1">
<h1>Upshot</h1>
<p>To be useful, Rose’s working paper needs … lots of work.</p>
<ul>
<li>The way the word “supply” is used should get clarified, and ideally moved more in line with standard literature.</li>
<li>The issue with the change in enumeration of dwellings needs to be dealt with, using construction and demolition data is one approach, and understanding the changes in more detail by looking at the structural type variable and ideally by getting information on the structural type of units not occupied by usual residents would help.</li>
<li>The issue with changing CMA boundaries needs to be dealt with, as it stands the “net new dwellings per net new household” metric does not make sense for many CMAs.</li>
<li>Some of the choices made need to be better explained, I suspect that there is no good reason why Rose chose to use “not occupied by usual residents” instead of simply “unoccupied” as the base of his measure, the language in the paper certainly suggests that Rose wanted to use the latter. I may be guessing wrong, but either way it needs better explanation.</li>
<li>A clearer statement of what the paper is trying to show, I am missing a hypothesis that the working paper is trying to reject, and a way to quantify that.</li>
</ul>
<p>Overall I would also appreciate a more transparent work practice that makes it easier to reproduce results and build on it. This post is build from an R Notebook <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2017-12-11-some-thoughts-on-the-supply-myth.Rmarkdown">that lives on GitHub</a> and is easily reproducible. If anyone has a different idea how to analyse the data it should be easy to adapt this for their own purposes. Life is too short for everyone to work on their own walled-off arena and leave everyone else guessing at what they did.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2017,
  author = {von Bergmann, Jens},
  title = {Some {Thoughts} on the {“Supply} {Myth"}},
  date = {2017-12-11},
  url = {https://doodletest.netlify.app/posts/2017-12-11-some-thoughts-on-the-supply-myth},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2017" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von. 2017. <span>“Some Thoughts on the “Supply
Myth".”</span> <em>MountanDoodles</em> (blog). December 11, 2017. <a href="https://doodletest.netlify.app/posts/2017-12-11-some-thoughts-on-the-supply-myth">https://doodletest.netlify.app/posts/2017-12-11-some-thoughts-on-the-supply-myth</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodletest\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>