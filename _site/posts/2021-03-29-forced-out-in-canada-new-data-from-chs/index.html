<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="author" content="Nathan Lauster">
<meta name="dcterms.date" content="2021-03-29">
<meta name="description" content="Taking a deeper look at forced moves using CHS microdata. And how it changed over time.">

<title>Mountain Doodles - Forced Out in Canada: New Data from CHS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/plain" cookie-consent="tracking">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Mountain Doodles - Forced Out in Canada: New Data from CHS">
<meta property="og:description" content="Taking a deeper look at forced moves using CHS microdata. And how it changed over time.">
<meta property="og:image" content="https://doodles.mountainmath.ca/posts/2021-03-29-forced-out-in-canada-new-data-from-chs/index_files/figure-html/forced_vs_voluntary-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="2100">
<meta property="og:image:width" content="2400">
<meta name="twitter:title" content="Mountain Doodles - Forced Out in Canada: New Data from CHS">
<meta name="twitter:description" content="Taking a deeper look at forced moves using CHS microdata. And how it changed over time.">
<meta name="twitter:image" content="https://doodles.mountainmath.ca/posts/2021-03-29-forced-out-in-canada-new-data-from-chs/index_files/figure-html/forced_vs_voluntary-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="2100">
<meta name="twitter:image-width" content="2400">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountain_doodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Forced Out in Canada: New Data from CHS</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Forced Out in Canada: New Data from CHS</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountain_doodles/blob/main/posts/2021-03-29-forced-out-in-canada-new-data-from-chs/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          Taking a deeper look at forced moves using CHS microdata. And how it changed over time.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">affordability</div>
                <div class="quarto-category">rental</div>
                <div class="quarto-category">Vancouver</div>
                <div class="quarto-category">PUMF</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jens von Bergmann </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              MountainMath
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Nathan Lauster </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              UBC, Department of Sociology
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 29, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p style="text-align:center;">
<i>(Joint with Nathan Lauster and cross-posted at <a href="https://homefreesociology.com/2021/03/29/forced-out-in-canada-new-data-from-chs/" target="_blank">HomeFreeSociology</a>)</i>
</p>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TL;DR</h2>
<p>The new data release from CHS 2018 enables us to return to looking at mobility, with a special focus on forced moves. We estimate and compare the risk of forced moves for renters across Canada. We also provide some evidence for its sharp decline in BC in 2018, following protections put in place by the NDP. Finally, we compare risk of “forced move” to risk of “choice move” for renters. In BC, “choice moves” are low relative to the rest of Canada, illustrating how the high percent of moves that are forced across BC is in part a product of lack of rental options (given our low vacancy rates) and high rent penalties for moving.</p>
</section>
<section id="new-chs-data" class="level2">
<h2 class="anchored" data-anchor-id="new-chs-data">New CHS Data</h2>
<p>The 2018 Canadian Housing Survey (CHS) public use microdata file (PUMF) is finally out, time to dig deeper into the questions we explored when the <a href="https://doodles.mountainmath.ca/blog/2019/11/23/canadian-housing-survey-a-first-look/">first tables</a> <a href="https://homefreesociology.com/2019/11/24/why-do-people-move-new-data-mysteries-and-fundamental-rights/">came out</a> and the second batch on data on <a href="https://doodles.mountainmath.ca/blog/2020/10/02/chs-core-housing-need/">ethnicity and core housing need was released</a>. The first thing we get a nice look at is how recently people moved. Within the Census, this is binned into simple “within the last year” and “within the last five years” categories. Here we get finer grained data extending up to 10 years or more. While we don’t get people’s full moving histories, this is still pretty cool insofar as we can map timing of moves to different years. The survey was fielded from <a href="https://www23.statcan.gc.ca/imdb/p2SV.pl?Function=getSurvey&amp;Id=793713">November 2018 through March of 2019</a>, so we can start there and work backward to date moves.</p>
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" width="1200"></p>
<p>Looking at how recently people moved, the distribution of residential mobility is fairly even across regions, except that rural areas stand out as having lower residential mobility. Part of the reason is that mobility is confounded by tenure. Renters move a lot more often than owners, reflecting a combination of factors including, for instance, demographics (renters tend to be younger on average and more open to moving), transaction costs (selling property is more involved than switching landlords), and power (renters can be forced out more easily than owners). Sure enough, comparing across regions generally less than half of owners have moved in the last ten years, compared to more than three-quarters of renters.</p>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="1200"></p>
<p>When conditioning on tenure of the current dwelling we still see slightly lower residential mobility in rural areas, but it’s reduced. The variation that remains can likely be explained by a variety of factors, like net migration and rental <a href="https://doodles.mountainmath.ca/blog/2018/11/28/moving-penalty/">moving penalties</a>. Net migration has mechanical effects on estimates of the timing of mobility for metro areas, even though <a href="https://homefreesociology.com/2020/06/04/metro-flows/">most moves are local</a> (migrants are added as movers in places where they arrive and subtracted as movers from places where they depart, boosting mobility rates in the former while decreasing them in the latter). But places where rent control maintains much lower rent for long-term tenants than new tenants (e.g.&nbsp;Vancouver &amp; Toronto) tend to see renters staying in place longer, a pattern that only shows up when differentiating mobility by tenure.</p>
<p>We can tease this out further by looking backward to graph a set of “survival” functions by tenure, using years since last move to effectively look at what proportion of people remain in a given dwelling by how long they’ve lived in the dwelling. Here we’ll look at some of the larger metro areas across the country, with a special focus on BC.</p>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="1200"></p>
<p>As one would expect, owner mobility is much lower than renter mobility. The difference between regions is wider for renter mobility. For better comparison across regions we can flip the way we show the data and graph all regions on the same panel.</p>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="1200"></p>
<p>Renters tend to stay in place longest in Toronto, followed by Montreal and Vancouver. Renters in Calgary and Edmonton move around more often. As noted above, rental penalties and tenant protections may explain some of this variation. But to investigate further, it helps to know why people are moving. In particular, we want to know if they are moving by choice, or because they’ve been forced to do so.</p>
</section>
<section id="forced-moves" class="level2">
<h2 class="anchored" data-anchor-id="forced-moves">Forced Moves</h2>
<p>One of the (many) great features of the CHS is that it allows us to look at why people moved. Including if their move was voluntary or if people were “forced to move by a landlord, a bank or other financial institution or the government.” This allows us a closer look at power differentials as a factor in moving. In our <a href="https://doodles.mountainmath.ca/blog/2019/11/23/canadian-housing-survey-a-first-look/">previous</a> <a href="https://homefreesociology.com/2019/11/24/why-do-people-move-new-data-mysteries-and-fundamental-rights/">posts</a> we noted that the proportion of moves that were forced looked quite high in BC, a pattern that, with <a href="https://homefreesociology.com/2020/06/22/why-people-move-in-canada-the-usa-comparing-chs-ahs-cps-results/">some cautions</a>, can also be examined with reference to reason for move in <a href="https://homefreesociology.com/2020/06/22/why-people-move-in-canada-the-usa-comparing-chs-ahs-cps-results/">US datasets</a>. With the PUMF data we can explore in more detail who these people are that were forced to move, and what their circumstances were, as well as getting a finer geographic breakdown within BC.</p>
<p>To start out, let’s reproduce what we previously knew about forced moves. Unfortunately the CHS PUMF does not come with bootstrap weights which makes it hard to derive confidence estimates. It has also been altered from the original data to preserve user privacy, so estimates are expected to be a little different from the ones derived from the master file. So it’s a good idea to see how well the PUMF data reproduces the previously released data on forced moves.</p>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="1200"></p>
<p>Comparing to our original graph we notice some slight difference, but overall things look good. We already hypothesized that the tenure of the previous home would have a large impact on the frequency of forced moves, with renters being particularly impacted. The legal process of eviction is likely far more common than foreclosure. With the PUMF data we can check this.</p>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="1200"></p>
<p>Not surprisingly, we see that forced moves were far more common among those renting their previous home. But there’s interesting variation here. BC, in particular, continues to stand out, with consistently high proportions of those moving from a rental dwelling describing their move as forced. Though Metro Vancouver leads in this regard, the rest of BC looks pretty similar.</p>
<p>Those owning their last dwellings are far less likely to describe their previous moves as forced, but forced moves still show up. Foreclosures seem the most obvious explanation, but events like government expropriations and condominium (strata) wind-ups may also play a role in dislodging owners. We also get a peek at a new category, those living “rent-free” in their last residence! The extent to which forced moves affect this group seems to vary widely. But it’s not as large as the other groups, so we’ll turn our attention to forced moves for renters, where it matters most. First we’ll simply pull out those who rented their previous dwelling from movers above to examine what proportion described their last move as “forced.”</p>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="1200"></p>
<p>Now we can think a bit about the limitations of this measure. Above we’re only looking at movers who rented their previous dwelling. We’re also only looking at those who have moved within the previous five years, and looking only at their last move to ascertain what proportion of last moves included “forced move” as a listed reason for move. It’s a funny measure, without a clearly defined risk (it includes all movers within the past five years, but not all moves, and says nothing about those who stayed in place). What we’re probably more interested in is what the risk of being evicted looks like for all renters, in which case the above graph can become confounded by general levels of mobility.</p>
<p>To understand this better, let’s first look at overall mobility for renters in the past year, that is the share of renters that moved during the past year.</p>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="1200"></p>
<p>We see that one-year renter mobility is indeed very low in Vancouver, roughly on par with Hamilton and Toronto. If not very many people are moving, this could inflate the relative proportion of those being forced to move.</p>
<p>So let’s create an estimate of the risk of being forced to move! We’re going to start simple by attempting to estimate the risk of being forced out of a rental dwelling within the past year for everyone who began the year as a renter. So we take the total number of movers from rental housing within the past year who describe their move as being “forced,” and we divide by the total number of movers from rental housing within the past year and the total number of renters who have <em>not</em> moved within the past year. Here’s the resulting one-year risk of being forced from rental housing.</p>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" width="1200"></p>
<p>The one-year risk of being forced from rental housing looks a bit different that the proportion of movers listing “forced move” as a reason for move. First off, the estimated risk of experiencing a forced move for renters drops to somewhere between 0.2% and 2.0%. Second, the variation really shifts. While most of BC remains at the upper end in terms of risk of forced move, the Vancouver CMA drops to the middle of the pack, fitting between Edmonton and Ottawa, and way below Saskatoon.</p>
<p>Overall, this is a pretty nice, readily interpretable measure of risk of eviction!</p>
<p>But maybe we want to see what happens if we go further back in time, giving us more moves overall to work with, and more time at risk of being forced to move. Unfortunately, the further back we go, the trickier it is to establish our denominator of renters and link them to discrete moves. We could be missing some moves (as when people move twice or more in rapid succession, leaving us with only information about the most recent move). And we could be missing some renters (as when young people leave home to become renters, adding to our denominator, but not showing up as a renter prior to their last move). Glossing over people possibly moving multiple times, and possibly being forced to move multiple times, we can extend our above graph to include most recent move in the past 5 years where the last move was forced, taking all renters as denominators.</p>
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" width="1200"></p>
<p>With longer time spent at risk of being forced to move, the overall risk to renters increases over a five year period, now ranging from roughly 3% to over 10%. There are also some notable shifts in regional variation; in particular, Metro Vancouver rejoins the rest of BC at the highest risk of forced moves for renters. Looking back historically, this suggests evictions risks may have been higher in BC from 2013-2017 than they were 2017-2018. We’ll come back to exploring this. But first let’s use our longer time-lines to look at sub-populations of interest.</p>
</section>
<section id="demographics-on-forced-moves" class="level2">
<h2 class="anchored" data-anchor-id="demographics-on-forced-moves">Demographics on forced moves</h2>
<p>The CHS has also collected information on visible minority status of household members, which allows us to understand how this affects the risk of being forced to move. The PUMF data only breaks out a simple yes/no status on whether at least one household member belongs to a visible minority group, but give that the sample gets quite thin that’s probably the best that the PUMF can do.</p>
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" width="1200"></p>
<p>To avoid small samples we are only breaking this down for broad regions. At this level there seems to be no strong signal that visible minority households overall are more impacted by forced moves, with the exception of the Atlantic provinces. Of note, this does not mean that the same holds for all subgroups of visible minorities. There weren’t enough households with visible minority members in the Territories to show meaningful data, and we chose to not show groups with fewer than 200 renters.</p>
<p>This is also a good reminder that people of Indigenous identity aren’t classified as visible minorities in Canada, and we should take a separate look at how they are faring in terms of eviction risks.</p>
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" width="1200"></p>
<p>We again suppressed data with fewer than 200 renters, which only leaves the Territories and the Prairies, the latter exhibiting a worryingly heightened risk of being forced to move for households with household members of Indigenous identity.</p>
</section>
<section id="historical-and-comparative-risks-of-forced-moves-and-choice-moves" class="level2">
<h2 class="anchored" data-anchor-id="historical-and-comparative-risks-of-forced-moves-and-choice-moves">Historical and Comparative Risks of Forced Moves and Choice Moves</h2>
<p>Let’s return to comparing one-year risks to five-year risks. To better compare the one year and five year forced move risk, we can compute the 1-year equivalent risk for 5 year movers, assuming that the risk to be forced to move is independent of having been forced to move in the past and has not changed over time. Looking at the differences of the 1-year equivalent risk of forced move on the most recent move over the past five years to the in one year risk to be forced to move gives some way to compare risk from 2017-2018 to risks for the full period from 2013-2018 side-by-side.</p>
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" width="1200"></p>
<p>In effect, where the blue bar (one year risk) exceeds the orange bar (one-year equivalent of five year risk), we might be looking at evidence of recent historical change where risks of eviction have risen in the past year. The high risk of forced moves looks quite recent in Saskatoon, for instance. Similarly, in Manitoba, New Brunswick, and rural Nova Scotia the repeated one year risk is substantially higher than the risk of being forced to move on the last move and the last move happening during the past five years prior to 2018.</p>
<p>On the other hand, wherever the orange bar vastly exceeds the blue bar, eviction risks within the past year seem to have gone down dramatically. Vancouver looks like potentially the biggest effect in this direction, though it also shows up outside of CMAs in BC, ON, and QC.</p>
<p>It’s tempting to describe these as straightforward historical effects, and the pattern in Vancouver, for instance, might suggest that <a href="https://www2.gov.bc.ca/gov/content/housing-tenancy/residential-tenancies/changes-to-tenancy-laws">changes to the Rental Tenancy Act</a> providing more protections to renters and made effective in May of 2018 - about six months prior to our survey - might be showing up in the data. But it’s difficult to fully separate out these changes from other things going on in the rental market, or from potentially confounding selection effects (e.g.&nbsp;those evicted may face higher risk of subsequent moves, or may be especially prone to seek out more stable forms of housing in their next move). Still, we can refine this further by looking at the risk for forced moves (on the last move) over increasingly longer time frames, zooming in on BC and a handful of comparison regions and normalizing the risk as a 1-year equivalent, understanding the same caveats as in the previous graph apply.</p>
<p><img src="index_files/figure-html/forced-1-year-equivalent-1.png" width="1200"></p>
<p>This brings out more clearly how the risk of being forced to move dropped off sharply during the last year in Vancouver and the rest of BC, but stayed roughly flat in Toronto and Montreal, and increased in Saskatoon. This lends some further credence to the hypothesis that rental protections enacted in BC had an effect on forced moves. <a href="https://thetyee.ca/News/2018/04/19/Renters-Rights-Changes-Step-NDP/">Well done BC NDP!</a></p>
<p>Flipping the analysis around, it may also be interesting to zoom in on choice moves, which here we’ll simply consider as all moves not described as forced. Let’s plot choice moves with forced moves.</p>
<p><img src="index_files/figure-html/forced_vs_voluntary-1.png" width="1200"></p>
<p>The data confirm that the risk of choice mobility looks especially low in Vancouver and Toronto. This fits with the low vacancy rates and likely lack of adequate choices in these markets combined with the workings of rent control, often creating a <a href="https://doodles.mountainmath.ca/blog/2018/11/28/moving-penalty/">moving penalty</a> for renters that increases with length of tenure. And this answers the question we asked higher up why residential mobility is lower in Toronto, Montreal and Vancouver. The answer is that it’s mostly due to fewer voluntary moves.</p>
<p>It’s the combination of a low risk of Choice moves with a moderate or high risk of Forced moves that creates the effect we’ve demonstrated in past posts, whereby we see a dramatically higher proportion of moves showing up as forced in Vancouver and the rest of BC relative to the rest of Canada. This has important implications, insofar as reducing the proportion of moves that are forced will involve <em>both</em> insuring more adequate protections (which we’re starting to see in BC) <em>and</em> insuring higher vacancy rates so people have better choices available to them about where they might move.</p>
<!--For a rescaled side-by-side comparison we add another way to show the same data.-->
</section>
<section id="takeaways" class="level2">
<h2 class="anchored" data-anchor-id="takeaways">Takeaways</h2>
<p>Overall, we can clearly see expected patterns between tenure and mobility. We can also construct a new and useful estimate of the Risk of Forced Move for all renters. For subpopulations, we see some evidence of heightened Risk of Forced Moves for indigenous tenants in the Prairies. There’s also good evidence that declining Risks of Forced Moves might be the result of a policy shift to strengthen tenant protections in BC in 2018. Combinations of moderate to high Risk of Forced Move, with low Risk of Choice Move produce the troubling patterns we have past documented in terms of Vancouver and BC’s much elevated proportion of all moves described as Forced. This suggests increasing the rental vacancy rate is important to enabling more renters to Choose where they want to live, in addition to continuing to protect tenants’ protections against being displaced.</p>
<p>As usual, the code for this post is <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2021-03-29-forced-out-in-canada-new-data-from-chs.Rmarkdown">available on GitHub</a>, although people that want to run it will have to request a copy of the <a href="https://www150.statcan.gc.ca/n1/en/catalogue/46250001">CHS PUMF data from StatCan</a>. While PUMF data is now freely available, it still requires a special request to get the data.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2021,
  author = {von Bergmann, Jens and Lauster, Nathan},
  title = {Forced {Out} in {Canada:} {New} {Data} from {CHS}},
  date = {2021-03-29},
  url = {https://doodles.mountainmath.ca/posts/2021-03-29-forced-out-in-canada-new-data-from-chs},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von, and Nathan Lauster. 2021. <span>“Forced Out in
Canada: New Data from CHS.”</span> <em>MountanDoodles</em> (blog). March
29, 2021. <a href="https://doodles.mountainmath.ca/posts/2021-03-29-forced-out-in-canada-new-data-from-chs">https://doodles.mountainmath.ca/posts/2021-03-29-forced-out-in-canada-new-data-from-chs</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodles\.mountainmath\.ca");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mountainmath/mountain_doodles" data-repo-id="R_kgDOLuoDtA" data-category="Blog posts" data-category-id="DIC_kwDOLuoDtM4Cetfc" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark_dimmed">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>