<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="dcterms.date" content="2018-01-25">
<meta name="description" content="What we have learned from the “Supply Myth” debate.">

<title>Mountain Doodles - Empty Suites</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../../css/styles.css">
<meta property="og:title" content="Mountain Doodles - Empty Suites">
<meta property="og:description" content="What we have learned from the “Supply Myth” debate.">
<meta property="og:image" content="https://doodles.mountainmath.ca/posts/2018-01-25-empty-suites/index_files/figure-html/metro_van_unoccupied-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="2112">
<meta name="twitter:title" content="Mountain Doodles - Empty Suites">
<meta name="twitter:description" content="What we have learned from the “Supply Myth” debate.">
<meta name="twitter:image" content="https://doodles.mountainmath.ca/posts/2018-01-25-empty-suites/index_files/figure-html/metro_van_unoccupied-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="2112">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountain_doodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Empty Suites</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Empty Suites</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountain_doodles/blob/main/posts/2018-01-25-empty-suites/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          What we have learned from the “Supply Myth” debate.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">cancensus</div>
                <div class="quarto-category">CensusMapper</div>
                <div class="quarto-category">Empty Homes</div>
                <div class="quarto-category">Vancouver</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jens von Bergmann </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 25, 2018</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>One of the <a href="https://homefreesociology.wordpress.com/2017/11/29/notes-on-the-myth-of-housing-supply/">constructive outcome of the “Supply Myth” discussion</a> was the spotlight it shone on secondary suites. While we have already <a href="https://doodles.mountainmath.ca/blog/2017/12/11/some-thoughts-on-the-supply-myth/">touched on this topic</a>, it is wroth to fully flesh this out. With the perpetual empty home discussion in Vancouver one would have thought that the numbers by structural type of dwelling would have percolated through to the empty home hive mind.</p>
<blockquote class="twitter-tweet blockquote"><p lang="en" dir="ltr">According to the 2011 census, which structural type of dwelling had the highest rate of unoccupied dwelling units in Metro Vancouver?</p>— Jens von Bergmann (@vb_jens) <a href="https://twitter.com/vb_jens/status/956753530437562370?ref_src=twsrc%5Etfw">January 26, 2018</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>Turns out that even after years (decades?) of hand-wringing, we still know very little about empty homes.</p>
<section id="tldr" class="level1">
<h1>TL;DR</h1>
<blockquote class="blockquote">
<p>In Metro Vancouver, census duplex units (mostly suited single family homes), is the structural type with the highest rate of unoccupied units. Around 10,000 of Metro Vancouver’s 58,229 dwelling units not occupied by usual residents in 2011 were unoccupied secondary suites.</p>
</blockquote>
<p>Well, that’s not entirely true, “Other single-attached” has an even higher rate, but there are only 1,110 dwelling units of that type in all of Metro Vancouver so we decided to ignore that category.</p>
</section>
<section id="secondary-suites" class="level1">
<h1>Secondary Suites</h1>
<p>Secondary suites in “single family” homes are the Schrödiger’s Cat of dwelling units. They hover in the uncertain state between being part of the main unit, and a separate dwelling unit. This superposition is facilitated by them often having an external door as well as an internal door to the main unit. When it comes time to rent them out they tend to congregate to the “separate dwelling unit” state (as opposed to “several rooms in the house”), when filing the principal residence exemption tax form they miraculously appear to be all “part of the main unit”.</p>
<p>The City of Vancouver has tried to force clarity in the status by allowing at most one kitchen per dwelling unit. So if an suite has its own kitchen it’s a separate dwelling unit. For the census the enumerator makes the judgement call if a single family house has a suite or not, and thus if the structure is classified as “single detached” or “duplex”.</p>
<p>In style with their quantum nature, counts of suites different depending on data source and methods employed, making it difficult to put the finger on simple properties like the total count of them.</p>
</section>
<section id="terminology" class="level1">
<h1>Terminology</h1>
<p>There is a lot of terminology that gets used differently in different contexts. In order to drill down into the issues we are interested in it is important to clearly define the terminology we will be using.</p>
<section id="dwelling-types" class="level2">
<h2 class="anchored" data-anchor-id="dwelling-types">Dwelling Types</h2>
<p>For dwelling types, we will stick with census terminology. We will also make reference to “single family homes” as the housing form regulated through “single family zoning” bylaws.</p>
<p>The relation between single family homes and census classifications is complex and subject to much confusion in the public discussion. A single family home without a secondary suite is classified by the census as a “single detached house”, a single family home with one secondary suite is classified as a “duplex” and results in two “apartment or flat in a duplex” units. A single family home with more than one secondary suite is classified as an “apartment, fewer than 5 storeys”. A laneway home on a single family lot is classified as a separate single detached dwelling in the census.</p>
<p>Throughout we will use the term “duplex” as defined in the census. What is commonly referred to as “duplex”, a detached structure divided into two units with a vertical division (as opposed to a division that is horizontal or a mixture of horizontal and vertical) is classified as two “semi-detached” dwelling units.</p>
</section>
<section id="empty-dwellings" class="level2">
<h2 class="anchored" data-anchor-id="empty-dwellings">Empty Dwellings</h2>
<style>.figure-float-right{float: right;margin-left:10px;max-width:400px;}</style>
<figure class="figure-float-right figure">
<img src="https://www12.statcan.gc.ca/census-recensement/2011/ref/dict/figures/figure22-dict-eng.jpg" class="img-fluid figure-img">
<figcaption>
Dwelling Universe
</figcaption>
</figure>
<p>We will stick with census definitions of the occupancy status of private dwellings. The standard census releases report on the total number of dwelling units, as well as those “occupied by usual residents”. The latter is, by definition, equal to the number of households. The guiding principle behind this definition is that each person should only be counted once, as part of the household that is their primary residence. Dwelling units that are not “occupied by usual residents” can be either “unoccupied”, or “occupied by temporary or foreign residents”, which means by people that have their primary residence elsewhere in Canada or abroad. Examples of this are students that list their parent’s home as their “primary” residence while they “temporarily” reside elsewhere near their place of study. Or temporary workers that maintain a residence for a fixed time near their work.</p>
<p>Much of the public discussion has focused on dwelling units not “occupied by usual residents”, even through looking at “unoccupied” would have been better suited for the arguments made. This is probably due to data on unoccupied dwellings not being as readily available and general laziness of obtaining appropriate data.</p>
</section>
</section>
<section id="supply-myth" class="level1">
<h1>Supply Myth</h1>
<p>The “supply myth” was based on the observation that the rate of dwellings that weren’t occupied by “usual residents” jumped between the 2001 and 2006 censuses. This has been <a href="http://vancouversun.com/news/local-news/census-counts-25502-unoccupied-homes-in-vancouver-more-than-double-the-estimate-by-city-hall">previously observed by others</a>, but somehow never really caught all that much attention. This time around there seemed to be a larger public echo, so Nathan Lauster <a href="https://homefreesociology.wordpress.com/2017/11/29/notes-on-the-myth-of-housing-supply/">decided to dig deeper</a> into the effects of a change in census methods on this, and <a href="https://doodles.mountainmath.ca/blog/2017/12/11/some-thoughts-on-the-supply-myth/">I added my comments too</a>. The 2006 census started fishing much more aggressively for suites than previous censuses, which <a href="https://doodles.mountainmath.ca/blog/2017/12/11/some-thoughts-on-the-supply-myth/">can be observed</a> by rising numbers of “duplex” units and falling numbers of “single detached” homes between 2001 and 2006 in Vancouver.</p>
<p>The fact that the jump in units not occupied by usual residents across regions correlated with the discovery of suites, as well as that this jump is not visible in electricity consumption data, suggests that suites may be more likely to be classified as “empty”. This is further corroborated when breaking down the duplex units by tenure, with 2001 registering more tenant households than owner households in duplexes, with the reverse being true in 2006. Generally duplex units can have at most one owner household, more owner households than renter households points to “empty” suites.</p>
</section>
<section id="custom-tabulations" class="level1">
<h1>Custom Tabulations</h1>
<p>At this point we are hitting the useful limits of the regular census data release. Time for a custom tabulation that gives a direct answer to our question: how many duplex units are empty? Ordering custom tabulations goes beyond the scope of what I am willing to invest time in for an evening blog post, but this question has been bugging me. So I started to ask around to see if someone has the data I am looking for, which is when I remembered that <a href="http://www.urbanfutures.com/foreign-unoccupied-pdf/">Urban Futures pull just such a custom tabulation in the past</a>. And they were kind enough to share the data when asked.</p>
<p>The custom tabulation looks at the entire private dwelling stock and allows to categorize it by “occupancy status”, so occupied by usual residents, occupied by temporary or foreign residents and unoccupied, cross referenced by structural type of dwelling. The 2011 data breaks out all dwelling types, the 2016 data groups dwellings into single detached, apartments (&lt;5 and 5+ storeys combined), and all other dwelling types.</p>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">2011 Data</h2>
<p>The 2011 data is best suited to answer our question about empty suites.</p>
<p>Looking at the Metro Vancouver overall dwelling stock we see that some of the categories are very under-represented.</p>
<p><img src="index_files/figure-html/metro_van_unoccupied-1.png" width="1056"></p>
<p>When looking at this data we should be aware that some of the categories don’t contain many dwelling units, a problem that will only get worse when looking at sub-regions. When looking at unoccupied dwellings we are often interested in percentages at or below the 1% range. There are only 1,110 dwelling units in the “Other single-attached house” category at the Metro Vancouver level, so random rounding can lead to errors of 0.5% to 1% when breaking out the occupancy status. To strike a balance between accuracy and breadth of information we will suppress ratios with a denominator below 500 dwelling units.</p>
<p>Another caveat is that there are two important confounders when looking at vacancy rates of apartment buildings, the age of the building and the ratio of purpose-built rental units. New buildings <a href="https://doodles.mountainmath.ca/blog/2017/04/03/joyce-collingwood/">take time to occupy</a> and completions shortly before the census can skew the ratio of unoccupied units, especially in areas with a smaller base of apartments. A high ratio of purpose-built rental buildings skew the numbers in the other direction, purpose-built rentals have had consistently low vacancy rates. One could fold in CMHC data to back out the purpose-built rental units that have near zero vacancy rate to arrive at a rate for condos. We will leave this for another day or another person to do.</p>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="1056"></p>
<p>This graph shows that census duplex units (mostly single family homes with suites) have the highest frequency of being unoccupied in all regions, with the exception of Surrey and Richmond where high-rise apartment units are more likely to be unoccupied. In the Cities of Vancouver and North Vancouver mid/high rise apartments overtake duplex units if we add in units occupied by temporary or foreign residents.</p>
<p>We filtered out Electoral A and Bowen Island as they are somewhat different in nature and show them separately for completeness. <img src="index_files/figure-html/unnamed-chunk-4-1.png" width="1056"></p>
<p>The high number of unoccupied single family homes in Electoral A also stand out, this probably warrants a more detailed geographic look to distinguish between dwellings in UBC/UNA/UEL (almost all single detached in this region are part of the UEL) and the rest more remote areas of Electoral A that hold about 20% of the regions occupied single detached homes.</p>
<p>Without further analysis we can’t say much about the rate of unoccupied single detached homes in the UEL. Bowen Island also has a high rate of unoccupied single detached homes, as well as temporarily occupied ones, possibly due to the presence of vacation homes on the island.</p>
<p>It is also instructive to view the data in terms of absolute numbers to understand the impact of each of the dwelling categories.</p>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="1056"></p>
</section>
</section>
<section id="empty-suites" class="level1">
<h1>Empty Suites</h1>
<p>Or primary objective today is to understand the role of suites. So far we see that duplex units are getting classified as “unoccupied” at a surprisingly high rate. But we don’t know if that’s due to the whole building being unoccupied or one unit being lived in and the other (in most cased the suite) being classified as unoccupied.</p>
<p>We will explore three ways to answer this question.</p>
<section id="comparison-with-single-detached-houses" class="level2">
<h2 class="anchored" data-anchor-id="comparison-with-single-detached-houses">Comparison with Single Detached Houses</h2>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="864"></p>
<p>What we see is that the share of unoccupied duplex units consistently and significantly higher across all regions. In absence of a compelling argument that main units in suited single family homes should be unoccupied at a higher rate than unsuited single family homes, this points to a significant portion of suited single family homes having empty suites.</p>
<p>If we assume that the main unit in unsuited and suited homes have equal probability of being unoccupied, and that a partially vacant duplex overwhelmingly has the main unit occupied and the suite unoccupied, we can estimate the ratio and total number of main units and suites that are unoccupied, out of all duplex units.</p>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="864"></p>
<p>Reading the graph we should be aware that some of the empty suites are in duplexes with empty main units. If we believe it likely that in almost no cases the suite will be occupied when the main unit is unoccupied we can slice the data differently into duplex structures with both units unoccupied and partially occupied duplex units with main unit occupied but empty suite. As opposed to the previous treatment, we now base our graph on the toal number of structures (half the number of duplex units), not on the total number of duplex units.</p>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="864"></p>
</section>
</section>
<section id="timeline-comparison-with-electricity-usage-data" class="level1">
<h1>Timeline comparison with electricity usage data</h1>
<p>The City of Vancouver commissioned the <a href="http://vancouver.ca/files/cov/stability-in-vancouver-housing-unit-occupancy-empty-homes-report.pdf">Ecotagious report</a> as an alternative measure of unoccupied units in Vancouver and the region. The first period reported in the Ecotagious report starts August 2001, just a few months after the 2001 census, and ends July 2014. Over this time period Ecotagious found that the rate of empty homes in each broad structural type showed little variability and stayed roughly constant throughout. The Ecotagious report did not distinguish between partially occupied or fully occupied census duplex structures because suites don’t have individual meters. At the same time, the census reported a rise in units not occupied by usual residents, while the count of occupied single detached homes dropped and duplex units rose due to the census much more aggressively looking for secondary suites. We can count total number of single detached and duplex lots by taken an adjusted count, the sum of single detached and half the number of duplex units. We would expect to see a stable or modest increase in these lots in Metro Vancouver over those years, but we see a sharp drop in the adjusted count of units occupied by usual residents of similar size as the jump in units non occupied by usual residents that the census found.</p>
<p>As we have <a href="https://doodles.mountainmath.ca/blog/2017/12/11/some-thoughts-on-the-supply-myth/">explained in more detail before</a> this suggests that a good portion of the newly found units that are not occupied by usual residents are suites. The adjusted count of occupied single family and duplex units increased again between 2006 and 2011, suggesting a drop in the number of suites that are not occupied by usual residents. In the above estimates we did not consider temporarily occupied units, but they don’t make up a significant portion to alter these conclusions.</p>
</section>
<section id="counting-owner-and-tenant-households" class="level1">
<h1>Counting owner and tenant households</h1>
<p>Another way to estimate empty suites is by breaking down the occupied duplex units by tenure. StatCan has a cross-tabulation that further allows to sort out (the small number of) stratified units and only consider single-owner duplexes. In that situation we can have at most one owner household living there, and if there are more owner households than tenant households the difference between the two gives a lower bound on the number of empty suites.</p>
<p>Hidden in this logic are a number of assumptions, in particular</p>
<ul>
<li><p>It could be that the long form over-sampled owner households and that this was not caught in the subsequent post-processing of the data, leading to the census reporting higher number of owners households than there actually are. With our method that would lead to an over-estimate of our lower bound on “empty” suites.</p></li>
<li><p>It could be that in some cases, for example a multi-family setup that get recorded as two separate households, both households have equity in the house and thus both would be counted as owner households. Another scenario like this would be a trust agreement that would enable a quasi-stratification of a non-stratified duplex.</p></li>
<li><p>It could be that some stratified duplexes don’t get correctly marked as such by the household filling out the form, and thus stratified households that potentially house to owner households mess with our estimate.</p></li>
</ul>
<p>With these caveats we get that there were 118,155 total non-stratified occupied duplex units, 70,815 of which were owner households and 47,340 renter households. The method we outlined yields a lower bound of 23,475 suites that are not occupied by usual residents.</p>
<p>This clearly contradicts our results higher up with the census reporting 13,100 unoccupied duplex units, and 715 units occupied by foreign/temporary residents, which does not come close to add up to the 23,475 units we got by comparing owner and tenant households in non-stratified duplex units.</p>
<p>So clearly there is a problem with this method exploiting the owner/tenant split, although we are not sure what. Part of the issue could be NHS problems, as the tenure and condo status data is part of the NHS, but we run into the same problem if we apply this method to 2016 data. Maybe someone else can help clear this up.</p>
<p>Despite these problems, the fact that the census reports more owner households than tenant households for duplex units is consistent with our argument that it’s predominantly suites that are counted as unoccupied in census duplexes.</p>
</section>
<section id="data-1" class="level1">
<h1>2016 Data</h1>
<p>The custom tab I have does not split out duplex units for 2016 and combines low and mid/high rise apartments. But it is still worth taking a look at.</p>
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" width="1056"></p>
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" width="1056"></p>
<p>We see that the combined “Other” category that mostly consists of census duplex units again dominates when looking at the share of unoccupied units except in Richmond, Coquitlam and Port Coquitlam. But comparing the total number of apartment units in 2011 and 2016 we can infer that they had many new units with a relatively small base, so the high rate of unoccupied apartment units may be due to the new units not properly filling in yet.</p>
<p>We filtered out Electoral A again because it’s scale is so far off.</p>
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" width="1056"></p>
<p>Lastly the we add the total numbers for better comparison with 2011 and a sense of scale.</p>
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" width="1056"></p>
</section>
<section id="they-are-all-empty" class="level1">
<h1>They are all empty!</h1>
<p>One discussion that comes to mind in this context is that about the effectiveness of different dwelling types, sometimes phrased as questions of the type: Why build new dwellings of a certain type if they end up “all empty” anyway?</p>
<p>When comparing suited single family homes with unsuited ones it is evident that it is better to have suited homes as this will allow more people to live there, even if a higher portion of suites than expected end up unoccupied. The fact that suites are more likely to be empty than other types of dwelling units does reduce the effectiveness of this typology, but it is still more effective in housing people than unsuited homes. But that same argument does not seem to be broadly accepted when it comes to apartment units.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2018,
  author = {von Bergmann, Jens},
  title = {Empty {Suites}},
  date = {2018-01-25},
  url = {https://doodles.mountainmath.ca/posts/2018-01-25-empty-suites},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2018" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von. 2018. <span>“Empty Suites.”</span>
<em>MountanDoodles</em> (blog). January 25, 2018. <a href="https://doodles.mountainmath.ca/posts/2018-01-25-empty-suites">https://doodles.mountainmath.ca/posts/2018-01-25-empty-suites</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodles\.mountainmath\.ca");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mountainmath/mountain_doodles" data-repo-id="R_kgDOLuoDtA" data-category="Blog posts" data-category-id="DIC_kwDOLuoDtM4Cetfc" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark_dimmed">
</div> <!-- /content -->




<script src="https://platform.twitter.com/widgets.js"></script>
</body></html>