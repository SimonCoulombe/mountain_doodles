<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="dcterms.date" content="2021-02-21">
<meta name="description" content="With BC public health officials doubting mathematical modelling it might be time again for an explainer of exponential growth.">

<title>Mountain Doodles - On COVID and exponential growth</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../../css/styles.css">
<meta property="og:title" content="Mountain Doodles - On COVID and exponential growth">
<meta property="og:description" content="With BC public health officials doubting mathematical modelling it might be time again for an explainer of exponential growth.">
<meta property="og:image" content="https://doodles.mountainmath.ca/posts/2021-02-21-on-covid-and-exponential-growth/index_files/figure-html/bc-covid-history-log-model-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="1500">
<meta property="og:image:width" content="2100">
<meta name="twitter:title" content="Mountain Doodles - On COVID and exponential growth">
<meta name="twitter:description" content="With BC public health officials doubting mathematical modelling it might be time again for an explainer of exponential growth.">
<meta name="twitter:image" content="https://doodles.mountainmath.ca/posts/2021-02-21-on-covid-and-exponential-growth/index_files/figure-html/bc-covid-history-log-model-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="1500">
<meta name="twitter:image-width" content="2100">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountain_doodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">On COVID and exponential growth</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">On COVID and exponential growth</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountain_doodles/blob/main/posts/2021-02-21-on-covid-and-exponential-growth/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          With BC public health officials doubting mathematical modelling it might be time again for an explainer of exponential growth.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">covid-19</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jens von Bergmann </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 21, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>The recent dismissal of PHAC modelling by the head of the BCCDC, coupled with some reactions we have seen on Twitter, have led us realize how hard it is for most people to understand exponential growth. Part of the fault lies with most modellers generally assume too much math literacy in others. In particular, we assume that public health officials or relevant policy makers can understand the models. Even though we have seen time and time again that this assumption is very tenuous. But more importantly, their inability to understand the models will not help them derive at the desirable responses and will not be able to explain to the general public.</p>
<p>So how can we explain those models better? I don’t have a good answer, but I have some ideas which I want to try out in this post.</p>
<section id="how-did-we-get-to-where-we-are" class="level2">
<h2 class="anchored" data-anchor-id="how-did-we-get-to-where-we-are">How did we get to where we are?</h2>
<p>A good starting point is to look back in time and understand how we got to our current state. Here is the graph I like to show for this, it does some <a href="">mild cleaning of daily counts to extract a trend line</a>.</p>
<p><img src="index_files/figure-html/bc-covid-history-1.png" width="1050"></p>
<p>This graph shows major and minor changes in public health measures, coloured by whether they loosen (green) or tighten (red) restrictions. Because of the lag between transmissions and cases getting reported, the graph is showing cases by the date the lab result came back, there will be a lag between a change in public health measures and when we see the effect in the case counts. We should expect that lag to be somewhere between 7 and 14 days.</p>
<p>This graph does a good job at showing the dramatic rise in cases in November, but it does not explain well how we got there. Our mind tends to interpret graphs like this as linear. We see a slope that is steepening and we want to say that COVID is spreading faster. But that’s not true. The growth rate of COVID, sometimes expressed in terms of the reproduction number R, has been fairly constant since the beginning of July, only taking an intermittent dip in September.</p>
<p>To visualize this we can go to a (semi-) log plot.</p>
<p>In the beginning period our testing wasn’t very good, so it does not make much sense to look at case counts before May, when changes in cases were also heavily impacted by changes in testing and not just changes in transmissions.</p>
<p><img src="index_files/figure-html/bc-covid-history-log-model-1.png" width="1050"></p>
<p>In this graph we have segmented the time since the end of March into 6 phases where we have seen fairly constant growth (or decline) of cases, and we draw the corresponding thick purple lines that fit these stages well. The way we divide things up into phases of constant growth is a bit ad-hoc. We could have chosen slightly different change times, but results are similar. The cause why growth rates flattened in September is not clear for me, the other changes line up well with major policy interventions. The slopes of these lines are the fitted growth rates during these time intervals.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Start</th>
<th style="text-align: left;">End</th>
<th style="text-align: left;">Growth rate</th>
<th style="text-align: right;">R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2020-04-25</td>
<td style="text-align: left;">2020-05-25</td>
<td style="text-align: left;">-4.9%</td>
<td style="text-align: right;">0.73</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020-05-25</td>
<td style="text-align: left;">2020-07-01</td>
<td style="text-align: left;">0.7%</td>
<td style="text-align: right;">1.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020-07-01</td>
<td style="text-align: left;">2020-08-20</td>
<td style="text-align: left;">3.9%</td>
<td style="text-align: right;">1.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020-08-20</td>
<td style="text-align: left;">2020-10-07</td>
<td style="text-align: left;">0.8%</td>
<td style="text-align: right;">1.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020-10-07</td>
<td style="text-align: left;">2020-11-17</td>
<td style="text-align: left;">4.7%</td>
<td style="text-align: right;">1.36</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020-11-17</td>
<td style="text-align: left;">2021-02-18</td>
<td style="text-align: left;">-0.7%</td>
<td style="text-align: right;">0.96</td>
</tr>
</tbody>
</table>
<p>We also added estimates of the effective reproduction number (the average number of transmissions each case causes) using the assumption that the generation interval is <code>\(\tau=6.5\)</code> days, that is <code>\(R=e^{r\cdot \tau}\)</code> in our simple exponential growth model. We prefer to work with growth rates as this is the intrinsic quantity that captures viral growth. The reproduction number has an intuitive interpretation but is model dependent, so will vary depending on the type of model used to describe the growth. For example, a more realistic model using a distribution of generation intervals will end up with reproduction numbers that are scaled closer to 1.</p>
<p>An interesting exercise is to take the same graph with the fitted lines and show this on a linear scale.</p>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="1050"></p>
<p>When looking at it this way we might be misled to think that the July/August growth rate was much less than the October/November growth rate, when in reality they were similar. We might think that our current rate of decline is greater than the one we saw at the end of the spring wave in May, when in fact the current decline is much softer. Both of these graphs have value, but they speak to different aspects of the pandemic.</p>
<p>As an aside, the basic observation that our pandemic is very well described by periods of constant growth can be leveraged to create predictions. Unless we change our public heath measures, cases will likely follow the same growth rate.</p>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="1050"></p>
<p>The current trajectory suggests that we will reach 100 cases around September 1st. However, projecting things out this far is probably not useful for several reasons. This assumes constant growth, meaning no changes in policy nor voluntary changes in behaviour over this time frame. However, we generally would expect a weakening of compliance with public health measures over time, and thus a flattening of the decline. At the same time, vaccinations are ramping up slowly, and as the share of the vaccinated population increases we will start to see impacts on transmissions. In fact, we are already seeing impacts on the 90+ and 80-89 year old age groups, their rates of cases have decreased dramatically over the past month.</p>
<p><img src="index_files/figure-html/bc_age_groups-1.png" width="1050"></p>
<p>While vaccinations are good news, in the short term they won’t do much to overall case growth. While we can see the decline in older age groups when splitting them out, there is no discernible effect visible in overall case numbers. It will take a much higher rate of vaccinations to make a clear dint in the above graph.</p>
<p>This shows how fitting exponential curves to case growth runs into limits. It does a good job of explaining high-level behaviour of the virus, which is what we are after here. Better models will refine this and tease out higher level effects. Vaccinations is one of them, waning adherence to public health measures may be another.</p>
<p>And now, we have a third effect that we are watching out for. Variants of Concern, or VOCs. Mutations of our original strain of increased fitness. Either because they are more easily transmissible like B.1.1.7, or because they escape some immunity like is believed to be the case for B.1.351. Both of these strains are now in circulation in BC, and they break our simplistic exponential model in more serious ways than pandemic fatigue or vaccinations do.</p>
</section>
<section id="variants-of-concern" class="level2">
<h2 class="anchored" data-anchor-id="variants-of-concern">Variants of Concern</h2>
<p>We focus on B.1.1.7, the variant first observed in the U.K. because we have very good data on it’s fitness advantage. While there are some uncertainties, it is generally believed to have an advantage that grants it a 1.5 times higher reproduction number. We need to translate this into how that affects our exponential growth rate, which is surprisingly tricky to do for reasons that go beyond the scope of this post. As mentioned above, the reproduction number <code>\(R\)</code> is model-dependent, and using the naive estimate of <code>\(r=\ln(R)/\tau\)</code>, where <code>\(\tau\)</code> is the mean generation interval, <a href="https://royalsocietypublishing.org/doi/10.1098/rspb.2006.3754">will under-estimate the growth rate</a>. Fortunately, Dean Karlen recently estimated the daily growth rate advantage of B.1.1.7 in the UK directly from the data, and it comes out to be somewhere between 0.08 and 0.1. Based on this, we assume a (continuous) growth rate advantage of 0.086 for this post, which roughly corresponds to a daily growth rate of 0.09 in the middle of Dean’s range.</p>
<p>Going to our table above, that means that under current conditions in BC the B.1.1.7 strain has a growth rate of 0.079. That is higher than what we have seen this fall for regular COVID when we had looser restrictions. (Remember the the time when you could still have small gatherings with friends?) The difference in growth rates between regular COVID and VOC, in particular B.1.1.7, is so large that we can’t model this by fitting exponential growth any more. We need to treat this as two separate pandemics that occur concurrently. With regular COVID acting as a smoke screen for the more dangerous VOC.</p>
<p>To gather some intuition we take our current BC growth rate and level of regular COVID and seed a small B.1.1.7 VOC with initially 5 cases. Is this a good initial guess? We don’t know, but it’s something to go with and sharpen our intuition.</p>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="1050"></p>
<p>We see the decline of regular COVID in our current environment, it’s exactly the “predicted” curve from above that we get from fitting and exponential decline to case development since the end of November. It’s what we expect to see if everything stays the same. In this environment we seeded a B.1.1.7 variant at a level of 5 daily cases two weeks ago.</p>
<p>Combining these two different pandemics we get the total number of cases we observe. The B.1.1.7 cases remain hidden in the background of regular COVID cases for quite a while, only in April is the upward trend of the combined cases.</p>
<p>To better understand why this is best thought of as two different pandemics, let’s take a look at this using our log scale.</p>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="1050"></p>
<p>On each own, regular COVID and B.1.1.7 cases look like lines on the log plot. This is of course by design, that’s the fundamental process of the virus and we modelled it that way. The sum of the two however does not follow this pattern. This might seem overly theoretical, but this also has played out in England.</p>
<p>Features to deal with things like this are built into more complicated models. Not just models that incorporate new variants, in general models have differnet compartments where they vary the transmission rates between age groups, groups of people with different levels of adherence to public health orders (or groups exceeding public health expectations), with complex interactions between these groups. And some models go even further and vary these parameters at the individual person level, like the models we have <a href="https://doodles.mountainmath.ca/blog/2020/09/08/covid-school-modelling/">used before to look at the effect of differnt interventions at schools</a>.</p>
<p>However, projecting things this far out is mostly a theoretical exercise, we will almost certainly see a strong public health reaction at some point down the road.</p>
</section>
<section id="how-about-vaccines" class="level2">
<h2 class="anchored" data-anchor-id="how-about-vaccines">How about vaccines?</h2>
<p>When projecting out into April we may have to start taking vaccination progress into consideration. In theory it is fairly straightforward to do this within the framework of our simplified exponential growth model, if we were vaccinating randomly we can simply model vaccination by reducing the growth rate by <code>\(\ln(1-s_i)/\tau\)</code>, where <code>\(s_i\)</code> is the share of the population that’s immune and <code>\(\tau\)</code> is the generation interval. Here immunity means that they won’t pass on the virus. We know the mRNA vaccines are around 95% effective in preventing severe outcomes, and there are some indication that they will also prevent transmission. This gets further complicated because we don’t really know how good the immunity, especially for transmission, is after only getting one shot.</p>
<p>To ballpark the rough effect of vaccines we can ask what percentage of the population needs to be vaccinated so that B.1.1.7 growth rate would be zero (or R for B.1.1.7 would be 1), assuming we don’t have any public health measures and vaccines are 100% effective at blocking transmissions. That’s just given by <code>\(1-\frac1R\)</code> which comes out to 40%. We are quite far from that, even during the given long time window. Moreover, our vaccine schedule is going down by age, which will have a net effect on transmissions that is worse than vaccinating randomly. How to optimize the vaccination rollout to also reduce transmissions, indirectly reducing severe outcomes by reducing spread, is an interesting and ongoing topic of research.</p>
</section>
<section id="the-problem-of-projecting-from-low-numbers" class="level2">
<h2 class="anchored" data-anchor-id="the-problem-of-projecting-from-low-numbers">The problem of projecting from low numbers</h2>
<p>There is one more point to talk about. The whole exponential growth approximation works well when case numbers are high. But when case numbers are low, as we have right now for B.1.1.7, things get complicated. COVID is highly over-dispersed, and we should assume the something similar is true for B.1.1.7. What that means in practice is that most people don’t pass on the virus, but a few pass it on to many to make up for it.</p>
<p>In practice, this means that having occasional cases does not mean B.1.1.7 will become established. There is a decent chance it will die out. But the more introductions we have, the more likely one of them will kick-start into a superspreader event and take hold for good. We have just seen this in Newfoundland and Labrador, where they are trying really hard to beat that outbreak back into the ground. But Newfoundland and Labrador have the advantage that they have almost no regular COVID, so they go hard against any COVID they see. We don’t have that luxury, we can’t go and automatically trace all contacts of contacts to beat down a new strain, our background COVID means we simply don’t have the resources for this.</p>
<p>What does this mean for our curves? It means that our initial 5 cases could die back down to zero. Or jump up to 40 within a couple of days. This kind of low likelihood but large effect situation is hard to handle. Should we assume we may have already 40 daily cases established right now? In that case, our curve looks a lot scarier. It’s probably more likely we have 5 to 10 at this point, but what should we plan for? The worst case scenario? The best case scenario? It depends on our risk tolerance. The other problem is that we don’t have inter-provincial quarantine and we don’t have good international travel quarantine, we have already seen how leaky it was with the first B.1.1.7 cases we saw in the news. That means we will have continuous seeding of VOC, and more chances for them to take off.</p>
<p>To model this properly we would need much better information. Unfortunately the BCCDC does not share much useful information to inform that. We only get cumulative counts of VAC. No sample collection dates, so we don’t know where on our timeline we should place them. We don’t have denominators, how many cases got sequences or what the flow of cases through N501Y screening looks like, so we don’t know how representative the ones we found are. The newest cases that have been announces are from episode onset week 5, so they are two weeks old now. Today there have been some school related B.1.1.7 exposures announced, one of them looks quite recent whereas the other ones are quite old. Data from WGS lags quite a bit, and we don’t get data on N501Y screening in BC at all. Ontario published daily updates on both. In short, it’s a mess in BC and we have next to no useful information how we should seed the model.</p>
<p>For good measure, let’s look what scenarios look like where we assume 3 through 10 daily cases (on average) as of two weeks ago (the rough lag that we seem to have for detecting variants). This also gives an indication what would happen if we had an early superspreader event to significantly boost VOCs. We would have to go to more advanced models to better model the probability band of outcomes that incorporate the overdispersed nature of COVID, for now looking at different choices of how to see B.1.1.7 cases will have to do as a rough proxy of potential outcomes.</p>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="1050"></p>
<p>Of course there are a lot of other uncertainties. There are some indications that our current growth rate might not be negative any more. It’s too early to say for sure, but the tail end of our case trend diverges from our model fit. If we assume we are currently at <code>\(R=1\)</code>, then our growth estimates would look quite a bit worse.</p>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="1050"></p>
<p>If we think that we currently are in a growth regimen, then things would be worse again. On the other hand, without larger changes in public health measures, the changes in growth are mostly due to people slipping in their compliance, which may well reverse as variants of concern become established.</p>
<p>The difference in the last two graphs reminds us that growth rates really matter. And how dialling down the growth rate even a little can have large effects two months down the road.</p>
</section>
<section id="bottom-line" class="level2">
<h2 class="anchored" data-anchor-id="bottom-line">Bottom line</h2>
<p>The big takeaway from this post is our pandemic is well described by sustained periods of constant exponential growth, with changes in growth rate usually initiated by changes in public health measures. The post also demonstrates that we should treat the emergence of new variants as a new pandemic that forms a “hidden wave” obscured by our regular COVID. Our background COVID makes it impossible to pinpoint new variants in a timely fashion, so we can’t effectively fight the new variants without fighting all COVID.</p>
<p>The model we used, simple exponential growth, loses some of the detail that more advanced models bring to this. On the upside it’s easy to understand and it (hopefully) brings a clearer understanding to what drives these more advanced models.</p>
<p>The last point is these models make it clear that we will have to intervene to reduce the growth of the new variants. Current public health measures simply aren’t anywhere near enough to contain it. The question is when to intervene. Waiting until new variants become established will require much stronger interventions later. We have seen how easy it was for the virus to grow in the fall, and how hard it is now to reverse some of this.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2021,
  author = {von Bergmann, Jens},
  title = {On {COVID} and Exponential Growth},
  date = {2021-02-21},
  url = {https://doodles.mountainmath.ca/posts/2021-02-21-on-covid-and-exponential-growth},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von. 2021. <span>“On COVID and Exponential
Growth.”</span> <em>MountanDoodles</em> (blog). February 21, 2021. <a href="https://doodles.mountainmath.ca/posts/2021-02-21-on-covid-and-exponential-growth">https://doodles.mountainmath.ca/posts/2021-02-21-on-covid-and-exponential-growth</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodles\.mountainmath\.ca");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mountainmath/mountain_doodles" data-repo-id="R_kgDOLuoDtA" data-category="Blog posts" data-category-id="DIC_kwDOLuoDtM4Cetfc" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark_dimmed">
</div> <!-- /content -->




</body></html>