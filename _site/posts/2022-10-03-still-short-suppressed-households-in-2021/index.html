<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="author" content="Nathan Lauster">
<meta name="dcterms.date" content="2022-10-03">
<meta name="description" content="Checking in on household suppression in Canada using 2021 data.">

<title>Mountain Doodles - Still Short: Suppressed Households in 2021</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../../css/styles.css">
<meta property="og:title" content="Mountain Doodles - Still Short: Suppressed Households in 2021">
<meta property="og:description" content="Checking in on household suppression in Canada using 2021 data.">
<meta property="og:image" content="https://doodles.mountainmath.ca/posts/2022-10-03-still-short-suppressed-households-in-2021/index_files/figure-html/shortfall-metros-shares-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="1800">
<meta property="og:image:width" content="2400">
<meta name="twitter:title" content="Mountain Doodles - Still Short: Suppressed Households in 2021">
<meta name="twitter:description" content="Checking in on household suppression in Canada using 2021 data.">
<meta name="twitter:image" content="https://doodles.mountainmath.ca/posts/2022-10-03-still-short-suppressed-households-in-2021/index_files/figure-html/shortfall-metros-shares-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="1800">
<meta name="twitter:image-width" content="2400">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountain_doodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Still Short: Suppressed Households in 2021</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Still Short: Suppressed Households in 2021</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountain_doodles/blob/main/posts/2022-10-03-still-short-suppressed-households-in-2021/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          Checking in on household suppression in Canada using 2021 data.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">affordability</div>
                <div class="quarto-category">cansim</div>
                <div class="quarto-category">cmhc</div>
                <div class="quarto-category">Vancouver</div>
                <div class="quarto-category">Toronto</div>
                <div class="quarto-category">rental</div>
                <div class="quarto-category">PUMF</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jens von Bergmann </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              MountainMath
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Nathan Lauster </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              UBC, Department of Sociology
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 3, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p style="text-align:center;">
<i>(Joint with Nathan Lauster and cross-posted at <a href="https://homefreesociology.com/2022/10/03/still-short-suppressed-households-in-2021/" target="_blank">HomeFreeSociology</a>)</i>
</p>
<p>In <a href="https://doodles.mountainmath.ca/blog/2022/05/06/estimating-suppressed-household-formation/">May we estimated suppressed household formation across Canada</a> using what we called the Montréal Method, finding strong evidence for suppression across many parts of Canada. As a reminder, we designed the Montréal Method to estimate housing shortfalls related to constraints upon current residents who might wish to form independent households but are forced to share by local housing markets. Now that we’ve got 2021 Census data out, it’s time to update our estimates. Given the data available, currently we can only estimate metro area effects of our previous <em>Model 1</em> (crude household maintainer rates) and <em>Model 2</em> (age-adjusted household maintainer rates). But that’s a start, and we’re also now enabled to extend the long timelines for Toronto, Montréal and Vancouver from our previous post to include 2021. Overall, current suppression of households alone suggests a shortfall of over 400,000 dwellings in Metro Toronto, and 130,000-200,000 across Metro Vancouver.</p>
<section id="comparing-2021-to-2016" class="level2">
<h2 class="anchored" data-anchor-id="comparing-2021-to-2016">Comparing 2021 to 2016</h2>
<p>To begin, we look at age-adjusted household maintainer rates across the 20 most populous metro areas in 2016 and 2021, ordered by how much they changed.</p>
<p><img src="index_files/figure-html/age-adjusted-metros-overview-1.png" width="1200"></p>
<p>The picture we see shows some areas with increases in age-adjusted household maintainer rates, especially in Québec, but most show reductions, especially in in the Greater Toronto Area, implying it’s gotten harder to set up an independent household there.</p>
<p>Age-adjusted rates can mask how household maintainer rates are shifting across age groups, but looking at Canada overall the picture is quite consistent with reductions in household maintainer rates through almost all age groups.</p>
<p><img src="index_files/figure-html/age-speciic-canada-overview-1.png" width="1200"></p>
<p>Reductions in maintaining an independent household are particularly pronounced in the 25 to 34 year old age groups, but we also see marked declines in the 70+ age range. Let’s break this out by metro area geography to pick up any differences.</p>
<p><img src="index_files/figure-html/age-speciic-metros-1.png" width="1200"></p>
<p>Metro variation is marked! Toronto shows decreasing household maintainer rates for ages below the late 50s, and increases above that. Québec shows increases in household maintainer rates generally across the board. Vancouver shows decreases for ages 35 through 50, whereas Hamilton, Oshawa, Victoria, and Halifax show decreases for almost all but the oldest age group. We also want to note the very different levels of age-specific household maintainer rates, with Québec and Montréal showing higher rates in all age groups than most of their peers, and Toronto having lower rates than most.</p>
</section>
<section id="caveats" class="level2">
<h2 class="anchored" data-anchor-id="caveats">2021 caveats</h2>
<p>It’s important to keep in mind that 2021 wasn’t a usual census year. People’s locations in May of 2021, in particular, were heavily impacted by the first year of the COVID-19 epidemic and its whiplash effects on things like local employment, on-campus university enrollments, and the movements of elders into long-term care. How all these trends might impact household maintainer rates still remains quite speculative. In some cases, trends might’ve even cancelled one another out. For example young adults moving back in with their parents during COVID might’ve reduced household maintainer rates even as young adults formerly living as roommates might’ve split up into separate apartments as part of social distancing efforts, boosting household maintainer rates within the same age range.</p>
<p>Deaths from COVID could also influence maintainer rates directly, particularly for the older adults most vulnerable to the virus. That said, some of the largest impacts were contained within long-term care homes, and thus outside of the population within private households we’re looking at here.</p>
</section>
<section id="timelines" class="level2">
<h2 class="anchored" data-anchor-id="timelines">Timelines</h2>
<p>Let’s pull out our three biggest Metro areas for longer timelines on age-specific household maintainer rates.</p>
<p><img src="index_files/figure-html/age-specific-main-metro-timeline-1.png" width="1200"></p>
<p>The strongest observable patterns, as <a href="https://homefreesociology.com/2022/05/06/estimating-suppressed-household-formation/">we noted previously</a>, concern the dramatic historical declines in household maintainership for young adults in Toronto and Vancouver. By contrast young adults saw much greater stability in Montréal, where declines in household maintainership only began to appear quite recently. Adding in the 2021 data indicates that Montréal’s household maintainer rates for young adults have recovered a little from these declines.</p>
<p>Was Montréal’s recovery in independence for young adults about the return of <a href="https://homefreesociology.com/2022/09/28/where-did-all-the-cheap-rents-go/">cheaper rents</a>? To dig into this a little more we look at rent quartiles of purpose-built rental housing in Montreal, adjusted by CPI and a selection of income measures.</p>
<p><img src="index_files/figure-html/montreal-adjusted-rent-quartiles-1.png" width="1200"></p>
<p>When adjusted for inflation or income, rents look like they were increasing or stable prior to the pandemic. But rents dropped across all measures by November of 2020, the last Rental Market Survey prior to the 2021 Census. Of note, income-adjusted estimates of rent for the 2020 data point should be viewed with caution due to impacts of COVID and related supports on incomes. Nevertheless, the data broadly supports the idea that lower rents by 2021 may have boosted household maintainer rates for young adults in Montréal.</p>
<p>To better directly compare metro areas for each age group, We can flip the age-specific household maintainer rate graph by colouring by metro area and faceting by year.</p>
<p><img src="index_files/figure-html/age-specific-main-metro-timeline-flipped-1.png" width="1200"></p>
<p>This highlights how over time Vancouver and especially Toronto, starting with younger age groups and then moving up the age ranks, have experienced dropping household maintainer rates relative to Montréal.</p>
<p>We’re especially interested in Montréal in part for its potential to serve as a counterfactual for what we might expect household formation to look like in an unconstrained housing market in Canada. But as discussed above, Montréal may not be a clean counter-factual for a non-squeezed housing market any more. Despite what looks like a recent recovery in household formation for young adults, household maintainership remains down relative to previous decades, with signs of dropping household formation in the younger age groups in the last several censuses prior to 2021. So here we add Québec City as a second counter-factual, just to give an alternative scenario for a place where households appear to form quite easily.</p>
<p>While Québec City provides us a second counterfactual to consider, there are factors other than age that might impact household formation, and our <em>Model 3</em> of our previous post tries to get at that, loosely labelling this factor as “culture”. What generally gets captured under “culture” is confounded by other important factors, chiefly income. And there is a real danger of attributing lower household formation rates of certain groups to “culture” when in reality it’s just systemic barriers leading to lower incomes that are partially or chiefly responsible for historic differential household formation rates across “culture”. We can’t run our <em>Model 3</em> yet given the limited data available for 2021, but we want to point out that Québec City is culturally very homogeneous which may skew the results to the extent that “culture” plays a role in household formation. Montréal is much more culturally diverse and similar to other large Canadian metro areas, and in that sense we view the Montréal scenario as a more robust counter-factual despite recent signs of slowing household formation in younger age groups. So view the Québec scenario with appropriate caution!</p>
<p>For our new estimates, We start out by asking by how many households each metro area would have to grow to achieve the same (age-specific) household maintainer rates as Montréal or Québec.</p>
<p><img src="index_files/figure-html/shortfall-metros-shares-1.png" width="1200"></p>
<p>Using either Montréal or Québec as the standard, we see that our selected metro areas would all have to increase their dwelling stock dramatically to make space for households to be able to form in line with our counter-factual scenarios. The estimated shortage is particularly pronounced if we take Québec City as the counter-factual. Toronto tops the list with a housing shortfall of around 20% of it’s existing dwelling stock.</p>
<p>Importantly, this shortfall estimate doesn’t account for migration. For example, this shortfall only accounts for the population that already lives in Toronto. If Toronto were to add housing it would likely pull in people that have been pushed out of the metro area to neighbouring areas like Oshawa or Hamilton, easing pressures there but in turn dampening the effect of the added housing in Toronto on boosting household maintainership rates.</p>
<p>Lastly, we can translate this into hard numbers of how many concealed households we have in each metro area. Put slightly differently, we can ask how many more housing units we would need to allow the existing population to form households at the same rates as in our counter-factual metro areas of Montréal or Québec.</p>
<p><img src="index_files/figure-html/shortfall-metros-totals-1.png" width="1200"></p>
<p>This puts a rough estimate on the number of suppressed households, or alternatively the number of additional dwellings needed to bring household formation rates up to counter-factual levels. The number for Metro Toronto is staggering. Between the 1970s, when Toronto had similar household maintainer rates as Montréal, and 2021, Metro Toronto has accumulated a shortage of over 400k homes, and that’s still not accounting for migration effects or moving vacancies.</p>
<p>For Metro Vancouver this pegs the number of suppressed households at somewhere between 130k and 200k, depending on the counter-factual scenario. Again, not accounting for migration or moving vacancies. That corresponds to between 6 and 10 years worth of recent completions, not accounting for demolitions, just to remove the current shortfall, while holding current population constant (narrator voice: <a href="https://www.canada.ca/en/immigration-refugees-citizenship/news/notices/supplementary-immigration-levels-2022-2024.html">it will not be held constant</a>).</p>
</section>
<section id="comparison-numbers" class="level2">
<h2 class="anchored" data-anchor-id="comparison-numbers">Comparison Numbers</h2>
<p>The <a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/898373/Sofa_surfing_fact_sheet.pdf">English Housing Survey measures ‘concealed households’ directly</a>, something that would be great to have in Canada too as part of the <a href="https://www23.statcan.gc.ca/imdb/p2SV.pl?Function=getSurvey&amp;SDDS=5269">Canadian Housing Survey</a>. In England the share of ‘concealed households’ came out at 7% in their 2018-2019 survey. Our <em>Model 2</em> comes out with between 7% and 13% of concealed households for Canada overall, depending on the counter-factual scenario. Having a direct measurement to benchmark these estimates against would be extremely helpful.</p>
<p>Another useful comparison is to see how these estimates stack up against CMHC supply shortfall estimates. The CMHC estimates were done very differently from our Montréal Method. CMHC relied on prices to fit a (modified) <a href="https://www.sciencedirect.com/science/article/abs/pii/S0094119084710011">DiPasquale-Wheaton model</a> to data from Canadian provinces and asked what it would take to get prices to specified levels. The CMHC report did not break out the “current” (2019) shortfall, but only the projected 2030 shortfall under a business-as-usual scenario. But the presentation on this work at this year’s CEA conference did break out the 2019 “current” shortfall, which can provide a useful benchmark for us.</p>
<p><img src="index_files/figure-html/cmhc-shortfall-comparison-1.png" width="1200"></p>
<p>The CMHC housing shortfall estimates for Ontario are roughly consistent with our more aggressive Québec counter-factual scenario. But for the other provinces they differ significantly; they are lower for Alberta and higher in Quebec and British Columbia than our suppressed household estimates.</p>
<p>One reason for this discrepancy is migration, which, to first order, is implicitly included in the CMHC model but is completely missing from our demographics-based estimates. In particular, it is <a href="https://www.cbc.ca/news/canada/calgary/poll-canadians-comfortable-living-1.6302361">very plausible</a> that in-migration into British Columbia from other parts of Canada would increase significantly if prices were lower. And a good portion of this increase might come from Alberta, easing the need for more housing there. On the other hand, single-region models like the one employed by CMHC might be double-counting demand when people get priced out of a region and buy or rent elsewhere. Some econometric models building on DiPasquale-Wheaton, like the <a href="https://academic.oup.com/oxrep/article-abstract/24/1/79/481193">models developed by Geoffry Meen</a>, avoid this by modelling migration effects explicitly.</p>
<p>Apart from not accounting for migration pressures, our household suppressing estimates only look at households and not at how many dwelling units are needed. The number of dwelling units would always have to be larger than the number of households to account for moving vacancies, as well as increase the rental vacancy rate to a healthy level to allow freer household formation that is not constrained by landlord bargaining power.</p>
</section>
<section id="takeaway" class="level2">
<h2 class="anchored" data-anchor-id="takeaway">Takeaway</h2>
<p>Housing discussions often get caught up in overly simplistic mental models of how housing works. Here we start to explore just one process involving how housing works for distributing people into households. Thinking through the process enables us to estimate household suppression. This formulates one aspect of the consequences of housing scarcity in terms of demographics, and how it interferes with life trajectories.</p>
<p>Often calls for building more housing are justified or discredited by pointing to past population growth and population growth projections. But this misses the central endogeneity problem. The number of dwelling units constitute a hard cap on the number of households that can form. When housing is scarce, both population growth and household formation slow down. A <a href="https://doodles.mountainmath.ca/blog/2020/05/25/projections-and-self-fulfilling-prophecies/">housing provision model that ignores suppressed household formation and migration becomes a self-fulfilling prophecy</a>, and <a href="https://doodles.mountainmath.ca/blog/2022/04/26/planning-for-scarcity/">systematically enshrines housing scarcity</a>.</p>
<p>While prices and rents are the best indicator of housing scarcity, there are those who doubt that prices and rents are related to scarcity, despite <a href="https://doodles.mountainmath.ca/blog/2022/02/18/vacancy-rates-and-rent-change-2021-update/">ample evidence to the contrary</a>. This points toward the value of exhibiting the effects of housing scarcity directly on demographics and people’s life trajectories, without making any reference to prices. Moreover, many people seem to have higher sympathy for the welfare of existing residents as opposed to newcomers, and might be more willing to understand the detrimental effects of housing scarcity when phrased in terms of the existing population, rather than more abstractly thought prices and rents, or migration pressures. We have made a similar attempt to highlight the <a href="https://doodles.mountainmath.ca/blog/2020/08/27/keeping-the-leavers/">people leaving the region</a> instead of looking at net population flows.</p>
<p>At the individual level, the decisions of individuals to form or not form households, or to move into or out of a region, are generally driven by prices and rents. And the ability and willingness to pay determines the outcome. When added up, these individual decisions set the market price and rent of housing. Prices are information aggregators, and the shortcut to all of this is to simply look at prices and rents as the main indicator of housing scarcity, which is what <a href="https://www.cmhc-schl.gc.ca/en/blog/2022/canadas-housing-supply-shortage-restoring-affordability-2030">econometric models like the ones in the recent CMHC report on Canada’s Housing Supply Shortage</a> do. So maybe, with this additional demographic context, we can pay more attention to those econometric models and build more housing. We can do this both for the population that’s already here so young people can form households and families, and also to make room for the people that left or that did not come, and for those intending to come in the future, those not wanting to leave in the future, and those wanting and <a href="https://bcsth.ca/">needing</a> to form new households in the future.</p>
<p>As usual, the code for this post is <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2022-10-03-still-short-suppressed-households-in-2021/index.Rmarkdown">available on GitHub</a>.</p>
<details>
<summary>
Reproducibility receipt
</summary>
<pre><code>## [1] "2022-10-03 15:42:31 PDT"</code></pre>
<pre><code>## Local:    master /Users/jens/Documents/R/mountaindoodles
## Remote:   master @ origin (https://github.com/mountainMath/doodles.git)
## Head:     [47fc9cc] 2022-10-01: fix author/title mixup</code></pre>
<pre><code>## R version 4.2.1 (2022-06-23)
## Platform: aarch64-apple-darwin20 (64-bit)
## Running under: macOS Monterey 12.6
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] mountainmathHelpers_0.1.4 statcanXtabs_0.1.2       
##  [3] forcats_0.5.1             stringr_1.4.1            
##  [5] dplyr_1.0.9               purrr_0.3.4              
##  [7] readr_2.1.2               tidyr_1.2.0              
##  [9] tibble_3.1.8              ggplot2_3.3.6            
## [11] tidyverse_1.3.2           cancensus_0.5.3          
## [13] cansim_0.3.12            
## 
## loaded via a namespace (and not attached):
##  [1] lubridate_1.8.0     assertthat_0.2.1    digest_0.6.29      
##  [4] utf8_1.2.2          R6_2.5.1            cellranger_1.1.0   
##  [7] backports_1.4.1     reprex_2.0.1        evaluate_0.15      
## [10] httr_1.4.4          blogdown_1.10       pillar_1.8.1       
## [13] rlang_1.0.5         googlesheets4_1.0.0 readxl_1.4.0       
## [16] rstudioapi_0.14     jquerylib_0.1.4     sanzo_0.1.0        
## [19] rmarkdown_2.14      googledrive_2.0.0   munsell_0.5.0      
## [22] broom_1.0.0         compiler_4.2.1      modelr_0.1.8       
## [25] xfun_0.33           pkgconfig_2.0.3     htmltools_0.5.3    
## [28] tidyselect_1.1.2    bookdown_0.27       fansi_1.0.3        
## [31] crayon_1.5.1        tzdb_0.3.0          dbplyr_2.2.1       
## [34] withr_2.5.0         grid_4.2.1          jsonlite_1.8.0     
## [37] gtable_0.3.1        lifecycle_1.0.2     DBI_1.1.3          
## [40] git2r_0.30.1        magrittr_2.0.3      scales_1.2.1       
## [43] cli_3.4.0           stringi_1.7.8       cachem_1.0.6       
## [46] fs_1.5.2            xml2_1.3.3          bslib_0.4.0        
## [49] ellipsis_0.3.2      generics_0.1.3      vctrs_0.4.1        
## [52] tools_4.2.1         glue_1.6.2          hms_1.1.2          
## [55] fastmap_1.1.0       yaml_2.3.5          colorspace_2.0-3   
## [58] gargle_1.2.0        rvest_1.0.3         knitr_1.39         
## [61] haven_2.5.0         sass_0.4.2</code></pre>
</details>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2022,
  author = {von Bergmann, Jens and Lauster, Nathan},
  title = {Still {Short:} {Suppressed} {Households} in 2021},
  date = {2022-10-03},
  url = {https://doodles.mountainmath.ca/posts/2022-10-03-still-short-suppressed-households-in-2021},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2022" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von, and Nathan Lauster. 2022. <span>“Still Short:
Suppressed Households in 2021.”</span> <em>MountanDoodles</em> (blog).
October 3, 2022. <a href="https://doodles.mountainmath.ca/posts/2022-10-03-still-short-suppressed-households-in-2021">https://doodles.mountainmath.ca/posts/2022-10-03-still-short-suppressed-households-in-2021</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodles\.mountainmath\.ca");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mountainmath/mountain_doodles" data-repo-id="R_kgDOLuoDtA" data-category="Blog posts" data-category-id="DIC_kwDOLuoDtM4Cetfc" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark_dimmed">
</div> <!-- /content -->




</body></html>