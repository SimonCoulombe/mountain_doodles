<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jens von Bergmann">
<meta name="author" content="Nathan Lauster">
<meta name="dcterms.date" content="2022-02-14">
<meta name="description" content="The census ‘unoccupied by usual residents’ metric is often in the news and one of the most frequentliy misrepresnted parts of census data. A quick primer on what does does and does not say.">

<title>Mountain Doodles - Unoccupied Canada</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/plain" cookie-consent="tracking">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-54516567-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Mountain Doodles - Unoccupied Canada">
<meta property="og:description" content="The census ‘unoccupied by usual residents’ metric is often in the news and one of the most frequentliy misrepresnted parts of census data. A quick primer on what does does and does not say.">
<meta property="og:image" content="https://doodles.mountainmath.ca/posts/2022-02-14-unoccupied-canada/index_files/figure-html/census-eht-svt-share-1.png">
<meta property="og:site_name" content="Mountain Doodles">
<meta property="og:image:height" content="1800">
<meta property="og:image:width" content="2400">
<meta name="twitter:title" content="Mountain Doodles - Unoccupied Canada">
<meta name="twitter:description" content="The census ‘unoccupied by usual residents’ metric is often in the news and one of the most frequentliy misrepresnted parts of census data. A quick primer on what does does and does not say.">
<meta name="twitter:image" content="https://doodles.mountainmath.ca/posts/2022-02-14-unoccupied-canada/index_files/figure-html/census-eht-svt-share-1.png">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:image-height" content="1800">
<meta name="twitter:image-width" content="2400">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../mm_stamp_small.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mountain Doodles</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html"> 
<span class="menu-text">Archive</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mountainMath/mountain_doodles"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/vb_jens" aria-current="page"> <i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/vb-jens/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jens.mountainmath.ca"> <i class="bi bi-envelope-at-fill" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img" aria-label="RSS">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Unoccupied Canada</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Unoccupied Canada</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/mountainMath/mountain_doodles/blob/main/posts/2022-02-14-unoccupied-canada/index.markdown"><i class="bi"></i></button></div></div>
                  <div>
        <div class="description">
          The census ‘unoccupied by usual residents’ metric is often in the news and one of the most frequentliy misrepresnted parts of census data. A quick primer on what does does and does not say.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">cancensus</div>
                <div class="quarto-category">Empty Homes</div>
                <div class="quarto-category">Vancouver</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jens von Bergmann </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              MountainMath
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Nathan Lauster </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              UBC, Department of Sociology
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 14, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p><strong>Too much data, too little time</strong></p>
</div></div>
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../profile.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mountainMath" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/vb_jens" title="" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/vb-jens/" title="" class="quarto-navigation-tool px-1" aria-label="LinkedIn"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:jens.mountainmath.ca" title="" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope-at-fill"></i></a>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Other Canadian data focused blogs:</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://homefreesociology.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HomeFreeSociology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dshkol.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dmitry Shkolnik’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.simoncoulombe.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simon Coulombe’s blog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://financesofthenation.ca/category/commentary/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finances of the Nation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://deny.substack.com" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deny’s Substack</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://higheredstrategy.com/author/alex/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alex Usher’s blog</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<p>Mountain Doodles is an insomnia driven side project, born out of random questions, trying to give partial answers through data. During daytime at <a href="https://mountainmath.ca">MountainMath</a>.</p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p style="text-align:center;">
<i>(Joint with Nathan Lauster and cross-posted at <a href="https://homefreesociology.com/2022/02/15/unoccupied-canada/" target="_blank">HomeFreeSociology</a>)</i>
</p>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TLDR</h2>
<p>Canadian Census data on <a href="https://censusmapper.ca/maps/3055">“Dwellings Unoccupied by Usual Residents”</a> are frequently misunderstood. Now that data from 2021 are out, we provide a timely explainer and draw upon a variety of resources, including comparisons with US data, Empty Homes Tax data, and zooming in on census geographies, to help people interpret what we can see.</p>
</section>
<section id="canada-unoccupied" class="level2">
<h2 class="anchored" data-anchor-id="canada-unoccupied">Canada Unoccupied</h2>
<p>Given that <a href="https://www.cbc.ca/news/politics/trudeau-premiers-cabinet-1.6350734">ongoing occupations</a> are so much in the news, let’s turn the channel to talk about those parts of Canada that are unoccupied!</p>
<p>We have new census data with population, dwelling and household counts. This gives us a <a href="https://doodles.mountainmath.ca/blog/2022/02/09/canada-s-2021-census-part-1/">first view on how neighbourhoods in Canada have changed</a>. For better or worse, one metric that can be derived from these three census variables is “dwellings not occupied by usual residents,” otherwise known as the difference between dwelling units and households.</p>
<p>This metric is frequently misunderstood and we have devoted a lot of digital ink attempting to clear things up. With new data out we are already seeing <a href="https://www.theglobeandmail.com/business/article-census-data-shows-torontos-housing-units-growing-faster-than/">bad takes based on this metric in the news</a>. And it only gets worse when looking at social media commentary.</p>
</section>
<section id="explainer" class="level2">
<h2 class="anchored" data-anchor-id="explainer">Explainer</h2>
<p>What does “not occupied by usual residents mean”? In Canada this metric can be decomposed into two components: 1) dwellings that were unoccupied on census day, and 2) dwellings that were occupied, but by people who have their usual residence elsewhere. This second category includes, for instance, people working and living temporarily in a different city and students that return to their parent’s place at the end of the semester. Out of these two components, actually unoccupied dwellings make up the vast majority of unoccupied by usual resident dwellings, but in some regions, for example college towns, temporarily occupied dwellings can make up half of such dwellings. By way of illustration, for the censuses 2001 through 2016 we have a <a href="https://censusmapper.ca/maps/2491">cross-tabulation on CensusMapper</a> that shows just the unoccupied dwellings, which can additionally be sliced by structural type of dwelling.</p>
<p>So what’s going on with unoccupied dwellings? Social media and many (poorly done) news reports would have us believe these are indicative of some form of “toxic demand” or empty “safety deposit boxes in the sky.” But is this the case?</p>
<p>There are multiple sources of data that can help shed light on the nature of dwellings counted as unoccupied in the census. First, we can put Canadian rates of units not occupied by usual residents in context with US cities, where the ACS collects information on the reason why a dwelling unit may be unoccupied. Second, we can look at a cross tabulation of document type (detailing if the dwelling is occupied by usual residents, temporarily present persons, or unoccupied) and structural type. Third, we can look at relevant administrative data, including the City of Vancouver’s Empty Homes Tax and BC’s Speculation &amp; Vacancy Tax. Finally, we can zoom in and look in more detail at the data newly released from the 2021 Census results.</p>
<section id="comparison-to-us-acs-data" class="level3">
<h3 class="anchored" data-anchor-id="comparison-to-us-acs-data">Comparison to US ACS data</h3>
<p><img src="../../posts/2020-01-27-mythical-oversupply/index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid"></p>
<p>In this infographic we match data from the last Census (2016) to ACS data from the same year. The closest to “toxic demand” or “empty safe deposit boxes in the sky” in the ACS data would appear to be dwellings showing up in green for “seasonal, recreational or occasional use.” These are the sort generally welcomed by vacation destinations like Miami. By contrast, other big cities, like Detroit, see what looks more like a “toxic lack of demand” in “other,” likely abandoned dwellings (showing up in brown), though “other” is a broad term encompassing many possible reasons for vacant dwellings (e.g.&nbsp;recent death of owner). The rest of the vacancies showing up in US data tend to be temporary and transactional (related to sales and rentals). We don’t get this same breakdown in the Canadian data, but we expect the underlying patterns to be similar, suggesting a baseline of vacancies associated with normal transactions; not unoccupied long term, but merely on Census day. Larger variation in occasional and other uses which may reflect longer-term vacancies is layered on top.</p>
</section>
<section id="document-type-by-structural-type" class="level3">
<h3 class="anchored" data-anchor-id="document-type-by-structural-type">Document type by structural type</h3>
<p>Refined data from the 2016 Census (not yet available in 2021) also enables us to split out unoccupied units by structural type of dwelling. Let’s take a look at what this looks like for three Canadian cities: the City of Vancouver, City of Toronto, and City of Ottawa.</p>
<p><img src="../../posts/2020-12-07-what-to-expect-from-an-empty-homes-tax/index_files/figure-html/ott-tor-unoccupied-1.png" class="img-fluid"></p>
<p>We note that in all three cities, the dwelling type most likely to register as unoccupied is an apartment in a “duplex.” Duplex is the designation the Census gives to buildings when a basement apartment is added to a single-family detached house, turning both the upper and lower unit created into “apartments in a duplex.” The census puts in an effort to find these <a href="https://homefreesociology.com/2021/06/09/basement-confidential-vancouvers-informal-housing-stock/">slippery and often informal kinds of housing</a>. But it’s tricky to do well and keep up with these flexible units. When a homeowner reabsorbs the suite into the main unit or chooses not to rent it out for whatever reason, the suite registers as unoccupied in the census. Accordingly, the distribution of housing stock matters for occupancy rates. Cities with <a href="https://homefreesociology.com/2021/06/09/basement-confidential-vancouvers-informal-housing-stock/">lots of secondary suites</a> mixed into their dwelling stock tend to register with higher rates of unoccupied homes.</p>
</section>
</section>
<section id="administrative-data" class="level2">
<h2 class="anchored" data-anchor-id="administrative-data">Administrative Data</h2>
<p>Let’s turn to administrative data from the City of Vancouver’s <a href="https://vancouver.ca/files/cov/vancouver-2021-empty-homes-tax-annual-report.pdf">Empty Homes Tax</a> (EHT) and BC’s <a href="https://homefreesociology.com/2021/11/22/three-years-of-speculation-and-vacancy-tax-data/">Speculation and Vacancy Tax</a> (SVT). While the most recent data from these taxes extend only to 2020, they provide a bridge, of sorts, between the 2016 Census and the 2021 Census, and also establish estimates of the prevalence of problematic long-term vacancies, as defined by the taxes for these years. Of note, the taxes were put in place in 2017 (EHT) and 2018 (SVT) amid the perception that problematic long-term vacancies were widespread, in part extending from <a href="https://www.cbc.ca/news/canada/british-columbia/number-of-empty-homes-in-vancouver-hits-record-high-1.4175999">misinterpretations of Census data</a>.</p>
<p>Below we plot the percentage of Private Dwellings Unoccupied by Usual Residents from the 2016 and 2021 Census against the percentage of Taxable Properties Containing Dwellings taxed as “Empty” in the publicly reported EHT and SVT data. For EHT, we also note properties declared exempt from taxation but not occupied by an owner or renter. These properties represent possible long-term empty dwellings (as distinct from shorter term empty dwellings that would also be caught by the Census).</p>
<p><img src="index_files/figure-html/census-eht-svt-share-1.png" width="1200"> The percentage of dwellings showing up as plausibly vacant in the Empty Homes Tax data is far below the percentage showing up as Unoccupied by Usual Residents in the Census data. This likely reflects a combination of factors, including the Census referring specifically to occupation on Census day, and hence picking up dwellings that were just temporarily vacant. Indeed, most of the dwellings picked up in the EHT data as plausibly vacant are still exempt from taxation. The largest reason for exemption is that the properties changed hands during the tax year, emphasizing the role of regular transactions in driving short-term vacancies.</p>
<p>Properties actually taxed as problematic vacancies are quite rare in the City of Vancouver, declining from just over 1% to just under 1% between 2017 and 2020. Between the Census years spanning that period, the percent of dwellings declared Unoccupied by Usual Residents declined from just over 8% to 7%. Can we suggest that around 1-in-8 dwellings determined to be unoccupied by usual residents on Census day reflect problematic long-term empty dwellings (a.k.a. “toxic demand”)? Tempting, but not quite. For one, our denominators for percentage figures from Census (private dwellings) and tax data (taxable properties) aren’t quite the same. Mostly this reflects the prevalence of single properties containing multiple dwellings, including our “duplexes” discussed above, but also most purpose-built rental apartment buildings. To re-examine the issue, let’s just get rid of denominators and look at raw numbers of dwellings deemed unoccupied by usual residents or deemed empty and taxed as such.</p>
<p><img src="index_files/figure-html/census-eht-svt-counts-1.png" width="1200"></p>
<p>Looking just at raw numbers, it looks like instead of 1-in-8 unoccupied hit with a tax, we get closer to 1-in-12 when the Empty Homes Tax first when into effect in 2017 (matched to 2016 Census), dropping to more like 1-in-15 by 2020 (matched to 2021 Census). For the Speculation and Vacancy Tax, the figures are even lower, declining to one property taxed in 2020 for every twenty-eight dwellings showing up as unoccupied by usual resident in 2021. (It appears to us that the difference between SVT taxed and EHT taxed is largely explained by different reporting standards emphasizing only properties declared as empty for SVT data vs.&nbsp;properties declared, determined, or deemed to be vacant in the EHT data.)</p>
<p>It’s difficult to say what the rate of Dwellings Unoccupied by Usual Residents would look like in the City of Vancouver absent the EHT and SVT. It’s a counterfactual, requiring some thought and many assumptions to work out properly. For instance, we should keep in mind that the 2021 census happened during COVID times, with possible short as well as long term effect of COVID further muddying the waters. But we can say that at this point it appears very little of what shows up as Dwellings Unoccupied by Usual Residents in the Census translates into problematically empty dwellings as defined by the Empty Homes and Speculation &amp; Vacancy Taxes.</p>
<p>Does this mean the Empty Homes Tax is useless? Probably not. And it’s notable that Census data and EHT data agree on a decline in unoccupied by usual resident and vacant dwellings. Returning to the ACS data, it’s apparent that inter-city variation is largest in uses like temporary residences that drive EHT or SVT taxed empties. Once taxes are put in place on long-term vacancies, it likely reduces the proportion of properties used for temporary residence. This, in turn, likely reduces the ratio of properties taxed as problematically empty relative to properties showing up as Unoccupied by Usual Residents in the Census. But as in the Vancouver data, we can see that the overall effect is probably limited. This, quite simply, is because in most cities the vast majority of dwellings showing up as Unoccupied by Usual Residents in the Census are not actually long-term or problematically vacant.</p>
</section>
<section id="zooming-in-on-vancouver" class="level2">
<h2 class="anchored" data-anchor-id="zooming-in-on-vancouver">Zooming in on Vancouver</h2>
<p>Finally, let’s turn to the geographic distribution of Dwellings Unoccupied by Usual Residents, plotting the new 2021 data for the City of Vancouver at the Census Tract level.</p>
<p><img src="index_files/figure-html/census-unoccpued-ct-1.png" width="1200"></p>
<p>We see the rate of Dwellings Not Occupied by Usual Residents varies throughout the city, but some areas jump out. And <a href="https://doodles.mountainmath.ca/blog/2017/04/03/joyce-collingwood/">just like when the 2016 numbers come out</a> some hapless commentator will inevitably zoom in on the bright areas and complain about empty homes.</p>
<p>One census tract, Census Tract 9330049.05 south of 2nd Ave between Cambie and Main, stands out with 27% of dwellings not occupied by usual residents. Let’s take a closer look and try and get ahead of silly arguments like commentators claiming that <a href="https://www.theglobeandmail.com/real-estate/vancouver/bcs-empty-home-problem-moving-beyond-just-vancouver/article34130746/">“speculation is one of our prime suspects”</a> or running headlines decrying this as a case of <a href="https://vancouversun.com/business/local-business/three-transit-oriented-communities-in-metro-rival-coal-harbour-for-empty-or-underused-housing">empty or underused housing</a>.</p>
<section id="enhance" class="level3">
<h3 class="anchored" data-anchor-id="enhance">Enhance</h3>
<p>Tract level household and dwelling counts are summed up from dissemination areas, so let’s switch our map resolution to that finer-grained level census geography.</p>
<p><img src="index_files/figure-html/census-unoccpued-da-1.png" width="1200"></p>
<p>That only added moderate detail, splitting the census tract into two dissemination areas, the larger of the two now sporting a share of 35% dwellings not occupied by usual residents, adding up to 253 “unoccupied” dwellings. Let’s zoom in even more to locate where the census found those “empty” homes.</p>
</section>
<section id="enhance-more" class="level3">
<h3 class="anchored" data-anchor-id="enhance-more">Enhance more</h3>
<p>Dissemination blocks are the finest level of geography for which the census releases this data. So let’s utilize blocks to take an even closer look at our tract of interest and add block counts of dwellings unoccupied by usual residents.</p>
<p><img src="index_files/figure-html/census-unoccpued-db-1.png" width="1200"></p>
<p>Blocks enable us to pinpoint how the higher level geography numbers were derived and where problematic buildings may be located. Three of the areas show up as 100% unoccupied, but two of them only have a single dwelling unit. These may be live-work spaces in this mostly industrial area. But one block shows up as having 38 dwelling units. And while the block at the corner of Main and 2nd has a lower share of units not occupied by usual residents, the total count comes out at 178. Let’s take a closer look at those two blocks.</p>
</section>
<section id="main-and-2nd" class="level3">
<h3 class="anchored" data-anchor-id="main-and-2nd">Main and 2nd</h3>
<p>The building at the southwest corner of Main and 2nd was newly constructed around census day. The census counted 233 dwelling units on this block with no other apparent housing on it, with 178 dwelling units not occupied by usual residents. It’s likely the case that residents simply hadn’t yet moved in to this building that completed quite near to Census day. The effect here is similar to what we witnessed for newly constructed areas in 2016 <a href="https://doodles.mountainmath.ca/blog/2017/04/03/joyce-collingwood/">where an outcry was raised over vacancies picked up by the census data release</a>.</p>
<p><img src="images/main_2nd.png" class="img-fluid"></p>
<p>While we know the building is new, we can also perform a quick check with CMHC completions data to see how many units got completed close to census day in 2021. One complication is that CMHC data for 2021 was still reported on 2016 boundaries, and the census tract in question came from 2016 census tract 9330049.01 which was split into four separate tracts in 2021. Doing a quick check at the census tract level from January through June 2016 on census tract 9330049.01 reveals that indeed 263 apartment units completed in April 2021, most of which are likely the ones in the building in question.</p>
</section>
<section id="yukon-and-5th" class="level3">
<h3 class="anchored" data-anchor-id="yukon-and-5th">Yukon and 5th</h3>
<p>There are 38 dwelling units with nobody living in them at the block with the <a href="https://www.linkvan.ca/facilities/269">Yukon Shelter</a> and no other apparent housing units. The shelter <a href="https://www.linkvan.ca/facilities/269">states that it is for people in “emergency and transitional situations”</a>, which is why people living there would not be classified as usual residents. This is an example where all these units are very likely lived in as shelter or transitional housing units, just not by people classified as usual residents.</p>
<p><img src="images/yukon_shelter.png" class="img-fluid"></p>
</section>
</section>
<section id="the-bigger-picture" class="level2">
<h2 class="anchored" data-anchor-id="the-bigger-picture">The bigger picture</h2>
<p>With these examples under our belt we can start to appreciate some of the complexities of this metric. When the Census counts Dwellings Unoccupied by Usual Residents, it’s a by-product of their primary aim, which is simply to find out where everyone in Canada is living on Census Day. Dwellings are tabulated to provide a frame for finding people. As such, the Census doesn’t care that much about overshooting its count of dwellings (as we see with secondary suites in duplexes). What it cares about is finding people and linking them back to a single residence (which explains how we get dwellings occupied by people who aren’t usual residents). We suggest that Dwellings Unoccupied by Usual Residents can still be an interesting metric, but only when treated with appropriate caution.</p>
<p>So our final takeaway is that when you see commentators throwing out figures on Dwellings Unoccupied by Usual Residents without appropriate cautions, or as a straightforward indicator of Empty Homes, keep in mind that it’s an indicator of something else entirely. It’s an indicator they don’t know much about housing.</p>
<p>As usual, the code for this post, including the code to scrape the data out of the PDFs, is <a href="https://github.com/mountainMath/doodles/blob/master/content/posts/2022-02-14-unoccupied-canada/index.Rmarkdown">available on GitHub</a> for anyone to reproduce or adapt.</p>
<details>
<summary>
Reproducibility receipt
</summary>
<pre><code>## [1] "2022-03-29 18:09:01 PDT"</code></pre>
<pre><code>## Local:    master /Users/jens/Documents/R/mountaindoodles
## Remote:   master @ origin (https://github.com/mountainMath/doodles.git)
## Head:     [b35bffa] 2022-02-19: rent change vs vacanct rates post</code></pre>
<pre><code>## R version 4.1.2 (2021-11-01)
## Platform: aarch64-apple-darwin20 (64-bit)
## Running under: macOS Monterey 12.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_CA.UTF-8/en_CA.UTF-8/en_CA.UTF-8/C/en_CA.UTF-8/en_CA.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] mountainmathHelpers_0.1.3 cmhc_0.1.0               
##  [3] tongfen_0.3.5             cancensus_0.5.0          
##  [5] sf_1.0-7                  forcats_0.5.1            
##  [7] stringr_1.4.0             dplyr_1.0.8              
##  [9] purrr_0.3.4               readr_2.1.2              
## [11] tidyr_1.2.0               tibble_3.1.6             
## [13] ggplot2_3.3.5             tidyverse_1.3.1          
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.8.3       lubridate_1.8.0    class_7.3-20       assertthat_0.2.1  
##  [5] digest_0.6.29      utf8_1.2.2         R6_2.5.1           cellranger_1.1.0  
##  [9] backports_1.4.1    reprex_2.0.1       evaluate_0.15      e1071_1.7-9       
## [13] httr_1.4.2         blogdown_1.8       pillar_1.7.0       rlang_1.0.2       
## [17] readxl_1.3.1       rstudioapi_0.13    jquerylib_0.1.4    rmarkdown_2.13    
## [21] munsell_0.5.0      proxy_0.4-26       broom_0.7.12       compiler_4.1.2    
## [25] modelr_0.1.8       xfun_0.30          pkgconfig_2.0.3    htmltools_0.5.2   
## [29] tidyselect_1.1.2   bookdown_0.25      fansi_1.0.3        crayon_1.5.1      
## [33] tzdb_0.2.0         dbplyr_2.1.1       withr_2.5.0        grid_4.1.2        
## [37] jsonlite_1.8.0     gtable_0.3.0       lifecycle_1.0.1    DBI_1.1.2         
## [41] git2r_0.30.1       magrittr_2.0.2     units_0.8-0        scales_1.1.1      
## [45] KernSmooth_2.23-20 cli_3.2.0          stringi_1.7.6      fs_1.5.2          
## [49] xml2_1.3.3         bslib_0.3.1        ellipsis_0.3.2     generics_0.1.2    
## [53] vctrs_0.3.8        tools_4.1.2        glue_1.6.2         hms_1.1.1         
## [57] fastmap_1.1.0      yaml_2.3.5         colorspace_2.0-3   classInt_0.4-3    
## [61] rvest_1.0.2        knitr_1.38         haven_2.4.3        sass_0.4.1</code></pre>


</details></section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{von bergmann2022,
  author = {von Bergmann, Jens and Lauster, Nathan},
  title = {Unoccupied {Canada}},
  date = {2022-02-14},
  url = {https://doodles.mountainmath.ca/posts/2022-02-14-unoccupied-canada},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-von bergmann2022" class="csl-entry quarto-appendix-citeas" role="listitem">
Bergmann, Jens von, and Nathan Lauster. 2022. <span>“Unoccupied
Canada.”</span> <em>MountanDoodles</em> (blog). February 14, 2022. <a href="https://doodles.mountainmath.ca/posts/2022-02-14-unoccupied-canada">https://doodles.mountainmath.ca/posts/2022-02-14-unoccupied-canada</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/doodles\.mountainmath\.ca");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="mountainmath/mountain_doodles" data-repo-id="R_kgDOLuoDtA" data-category="Blog posts" data-category-id="DIC_kwDOLuoDtM4Cetfc" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark_dimmed">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>